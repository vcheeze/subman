import{c as ss}from"./createLucideIcon-DEV_LwaW.js";import{j as gr,x as wr,r as Wt}from"./main-Bph0N3Xt.js";import{c as is}from"./index-B4uYwTLQ.js";/**
 * @license lucide-react v0.518.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const as=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],kf=ss("circle-alert",as),cs=is("relative grid w-full grid-cols-[0_1fr] items-start gap-y-0.5 rounded-lg border px-4 py-3 text-sm has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] has-[>svg]:gap-x-3 [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current",{variants:{variant:{default:"bg-card text-card-foreground",destructive:"bg-card text-destructive *:data-[slot=alert-description]:text-destructive/90 [&>svg]:text-current"}},defaultVariants:{variant:"default"}});function Tf({className:e,variant:t,...r}){return gr.jsx("div",{className:wr(cs({variant:t}),e),"data-slot":"alert",role:"alert",...r})}function Sf({className:e,...t}){return gr.jsx("div",{className:wr("col-start-2 line-clamp-1 min-h-4 font-medium tracking-tight",e),"data-slot":"alert-title",...t})}function If({className:e,...t}){return gr.jsx("div",{className:wr("col-start-2 grid justify-items-start gap-1 text-muted-foreground text-sm [&_p]:leading-relaxed",e),"data-slot":"alert-description",...t})}const Un=globalThis.crypto,Le=Un.subtle,us=e=>Un.getRandomValues(e);var ds={OK:200,CREATED:201,ACCEPTED:202,NO_CONTENT:204,MULTIPLE_CHOICES:300,MOVED_PERMANENTLY:301,FOUND:302,SEE_OTHER:303,NOT_MODIFIED:304,TEMPORARY_REDIRECT:307,BAD_REQUEST:400,UNAUTHORIZED:401,PAYMENT_REQUIRED:402,FORBIDDEN:403,NOT_FOUND:404,METHOD_NOT_ALLOWED:405,NOT_ACCEPTABLE:406,PROXY_AUTHENTICATION_REQUIRED:407,REQUEST_TIMEOUT:408,CONFLICT:409,GONE:410,LENGTH_REQUIRED:411,PRECONDITION_FAILED:412,PAYLOAD_TOO_LARGE:413,URI_TOO_LONG:414,UNSUPPORTED_MEDIA_TYPE:415,RANGE_NOT_SATISFIABLE:416,EXPECTATION_FAILED:417,"I'M_A_TEAPOT":418,MISDIRECTED_REQUEST:421,UNPROCESSABLE_ENTITY:422,LOCKED:423,FAILED_DEPENDENCY:424,TOO_EARLY:425,UPGRADE_REQUIRED:426,PRECONDITION_REQUIRED:428,TOO_MANY_REQUESTS:429,REQUEST_HEADER_FIELDS_TOO_LARGE:431,UNAVAILABLE_FOR_LEGAL_REASONS:451,INTERNAL_SERVER_ERROR:500,NOT_IMPLEMENTED:501,BAD_GATEWAY:502,SERVICE_UNAVAILABLE:503,GATEWAY_TIMEOUT:504,HTTP_VERSION_NOT_SUPPORTED:505,VARIANT_ALSO_NEGOTIATES:506,INSUFFICIENT_STORAGE:507,LOOP_DETECTED:508,NOT_EXTENDED:510,NETWORK_AUTHENTICATION_REQUIRED:511},b=class extends Error{constructor(e="INTERNAL_SERVER_ERROR",t=void 0,r={},n=typeof e=="number"?e:ds[e]){var o;super(t==null?void 0:t.message),this.status=e,this.body=t,this.headers=r,this.statusCode=n,this.name="APIError",this.status=e,this.headers=r,this.statusCode=n,this.body=t?{code:(o=t==null?void 0:t.message)==null?void 0:o.toUpperCase().replace(/ /g,"_").replace(/[^A-Z0-9_]/g,""),...t}:void 0,this.stack=""}};function On(e){return e instanceof b||(e==null?void 0:e.name)==="APIError"}function ls(e){try{return e.includes("%")?decodeURIComponent(e):e}catch{return e}}function fs(e){if(e===void 0)return!1;const t=typeof e;return t==="string"||t==="number"||t==="boolean"||t===null?!0:t!=="object"?!1:Array.isArray(e)?!0:e.buffer?!1:e.constructor&&e.constructor.name==="Object"||typeof e.toJSON=="function"}function Xt(e,t){if(e instanceof Response)return(t==null?void 0:t.headers)instanceof Headers&&t.headers.forEach((o,s)=>{e.headers.set(s,o)}),e;if((e==null?void 0:e._flag)==="json"){const o=e.routerResponse;return o instanceof Response?o:Xt(e.body,{headers:e.headers,status:e.status})}if(On(e))return Xt(e.body,{status:e.statusCode,statusText:e.status.toString(),headers:(t==null?void 0:t.headers)||e.headers});let r=e,n=new Headers(t==null?void 0:t.headers);return e?typeof e=="string"?(r=e,n.set("Content-Type","text/plain")):e instanceof ArrayBuffer||ArrayBuffer.isView(e)?(r=e,n.set("Content-Type","application/octet-stream")):e instanceof Blob?(r=e,n.set("Content-Type",e.type||"application/octet-stream")):e instanceof FormData?r=e:e instanceof URLSearchParams?(r=e,n.set("Content-Type","application/x-www-form-urlencoded")):e instanceof ReadableStream?(r=e,n.set("Content-Type","application/octet-stream")):fs(e)&&(r=JSON.stringify(e,(o,s)=>typeof s=="bigint"?s.toString():s),n.set("Content-Type","application/json")):(e===null&&(r=JSON.stringify(null)),n.set("content-type","application/json")),new Response(r,{...t,headers:n})}async function hs(e,t={}){let r={body:t.body,query:t.query};if(e.body){const n=await e.body["~standard"].validate(t.body);if(n.issues)return{data:null,error:$r(n.issues,"body")};r.body=n.value}if(e.query){const n=await e.query["~standard"].validate(t.query);if(n.issues)return{data:null,error:$r(n.issues,"query")};r.query=n.value}return e.requireHeaders&&!t.headers?{data:null,error:{message:"Headers is required"}}:e.requireRequest&&!t.request?{data:null,error:{message:"Request is required"}}:{data:r,error:null}}function $r(e,t){for(const r of e)r.message;return{message:`Invalid ${t} parameters`}}var yr={name:"HMAC",hash:"SHA-256"},Dn=async e=>{const t=typeof e=="string"?new TextEncoder().encode(e):e;return await Le.importKey("raw",t,yr,!1,["sign","verify"])},ps=async(e,t,r)=>{try{const n=atob(e),o=new Uint8Array(n.length);for(let s=0,i=n.length;s<i;s++)o[s]=n.charCodeAt(s);return await Le.verify(yr,r,o,new TextEncoder().encode(t))}catch{return!1}},ms=async(e,t)=>{const r=await Dn(t),n=await Le.sign(yr.name,r,new TextEncoder().encode(e));return btoa(String.fromCharCode(...new Uint8Array(n)))},gs=async(e,t)=>{const r=await ms(e,t);return e=`${e}.${r}`,e=encodeURIComponent(e),e},Lr=(e,t)=>{let r=e;if(t)if(t==="secure")r="__Secure-"+e;else if(t==="host")r="__Host-"+e;else return;return r};function ws(e){if(typeof e!="string")throw new TypeError("argument str must be a string");const t=new Map;let r=0;for(;r<e.length;){const n=e.indexOf("=",r);if(n===-1)break;let o=e.indexOf(";",r);if(o===-1)o=e.length;else if(o<n){r=e.lastIndexOf(";",n-1)+1;continue}const s=e.slice(r,n).trim();if(!t.has(s)){let i=e.slice(n+1,o).trim();i.codePointAt(0)===34&&(i=i.slice(1,-1)),t.set(s,ls(i))}r=o+1}return t}var Pn=(e,t,r={})=>{let n;if((r==null?void 0:r.prefix)==="secure"?n=`${`__Secure-${e}`}=${t}`:(r==null?void 0:r.prefix)==="host"?n=`${`__Host-${e}`}=${t}`:n=`${e}=${t}`,e.startsWith("__Secure-")&&!r.secure&&(r.secure=!0),e.startsWith("__Host-")&&(r.secure||(r.secure=!0),r.path!=="/"&&(r.path="/"),r.domain&&(r.domain=void 0)),r&&typeof r.maxAge=="number"&&r.maxAge>=0){if(r.maxAge>3456e4)throw new Error("Cookies Max-Age SHOULD NOT be greater than 400 days (34560000 seconds) in duration.");n+=`; Max-Age=${Math.floor(r.maxAge)}`}if(r.domain&&r.prefix!=="host"&&(n+=`; Domain=${r.domain}`),r.path&&(n+=`; Path=${r.path}`),r.expires){if(r.expires.getTime()-Date.now()>3456e7)throw new Error("Cookies Expires SHOULD NOT be greater than 400 days (34560000 seconds) in the future.");n+=`; Expires=${r.expires.toUTCString()}`}return r.httpOnly&&(n+="; HttpOnly"),r.secure&&(n+="; Secure"),r.sameSite&&(n+=`; SameSite=${r.sameSite.charAt(0).toUpperCase()+r.sameSite.slice(1)}`),r.partitioned&&(r.secure||(r.secure=!0),n+="; Partitioned"),n},ys=(e,t,r)=>(t=encodeURIComponent(t),Pn(e,t,r)),_s=async(e,t,r,n)=>(t=await gs(t,r),Pn(e,t,n)),$n=async(e,{options:t,path:r})=>{const n=new Headers,{data:o,error:s}=await hs(t,e);if(s)throw new b(400,{message:s.message,code:"VALIDATION_ERROR"});const i="headers"in e?e.headers instanceof Headers?e.headers:new Headers(e.headers):"request"in e&&e.request instanceof Request?e.request.headers:null,a=i==null?void 0:i.get("cookie"),c=a?ws(a):void 0,u={...e,body:o.body,query:o.query,path:e.path||r,context:"context"in e&&e.context?e.context:{},returned:void 0,headers:e==null?void 0:e.headers,request:e==null?void 0:e.request,params:"params"in e?e.params:void 0,method:e.method,setHeader:(d,l)=>{n.set(d,l)},getHeader:d=>i?i.get(d):null,getCookie:(d,l)=>{const f=Lr(d,l);return f&&(c==null?void 0:c.get(f))||null},getSignedCookie:async(d,l,f)=>{const h=Lr(d,f);if(!h)return null;const p=c==null?void 0:c.get(h);if(!p)return null;const y=p.lastIndexOf(".");if(y<1)return null;const g=p.substring(0,y),A=p.substring(y+1);if(A.length!==44||!A.endsWith("="))return null;const v=await Dn(l);return await ps(A,g,v)?g:!1},setCookie:(d,l,f)=>{const h=ys(d,l,f);return n.append("set-cookie",h),h},setSignedCookie:async(d,l,f,h)=>{const p=await _s(d,l,f,h);return n.append("set-cookie",p),p},redirect:d=>(n.set("location",d),new b("FOUND",void 0,n)),error:(d,l,f)=>new b(d,l,f),json:(d,l)=>e.asResponse?{body:(l==null?void 0:l.body)||d,routerResponse:l,_flag:"json"}:d,responseHeaders:n};for(const d of t.use||[]){const l=await d({...u,returnHeaders:!0,asResponse:!1});l.response&&Object.assign(u.context,l.response),l.headers&&l.headers.forEach((f,h)=>{u.responseHeaders.set(h,f)})}return u};function Ge(e,t){const r=async n=>{const o=n,s=typeof e=="function"?e:t,a=await $n(o,{options:typeof e=="function"?{}:e,path:"/"});if(!s)throw new Error("handler must be defined");const c=await s(a),u=a.responseHeaders;return o.returnHeaders?{headers:u,response:c}:c};return r.options=typeof e=="function"?{}:e,r}Ge.create=e=>{function t(r,n){if(typeof r=="function")return Ge({use:e==null?void 0:e.use},r);if(!n)throw new Error("Middleware handler is required");return Ge({...r,method:"*",use:[...(e==null?void 0:e.use)||[],...r.use||[]]},n)}return t};var er=(e,t,r)=>{const n=async(...o)=>{const s=o[0]||{},i=await $n(s,{options:t,path:e}),a=await r(i).catch(async u=>{if(On(u)){const d=t.onAPIError;if(d&&await d(u),s.asResponse)return u}throw u}),c=i.responseHeaders;return s.asResponse?Xt(a,{headers:c}):s.returnHeaders?{headers:c,response:a}:a};return n.options=t,n.path=e,n};er.create=e=>(t,r,n)=>er(t,{...r,use:[...(r==null?void 0:r.use)||[],...(e==null?void 0:e.use)||[]]},n);var ct;(function(e){e.assertEqual=o=>o;function t(o){}e.assertIs=t;function r(o){throw new Error}e.assertNever=r,e.arrayToEnum=o=>{const s={};for(const i of o)s[i]=i;return s},e.getValidEnumValues=o=>{const s=e.objectKeys(o).filter(a=>typeof o[o[a]]!="number"),i={};for(const a of s)i[a]=o[a];return e.objectValues(i)},e.objectValues=o=>e.objectKeys(o).map(function(s){return o[s]}),e.objectKeys=typeof Object.keys=="function"?o=>Object.keys(o):o=>{const s=[];for(const i in o)Object.prototype.hasOwnProperty.call(o,i)&&s.push(i);return s},e.find=(o,s)=>{for(const i of o)if(s(i))return i},e.isInteger=typeof Number.isInteger=="function"?o=>Number.isInteger(o):o=>typeof o=="number"&&isFinite(o)&&Math.floor(o)===o;function n(o,s=" | "){return o.map(i=>typeof i=="string"?`'${i}'`:i).join(s)}e.joinValues=n,e.jsonStringifyReplacer=(o,s)=>typeof s=="bigint"?s.toString():s})(ct||(ct={}));var Nr;(function(e){e.mergeShapes=(t,r)=>({...t,...r})})(Nr||(Nr={}));ct.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]);ct.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);var xr=class Ln extends Error{get errors(){return this.issues}constructor(t){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};const r=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,r):this.__proto__=r,this.name="ZodError",this.issues=t}format(t){const r=t||function(s){return s.message},n={_errors:[]},o=s=>{for(const i of s.issues)if(i.code==="invalid_union")i.unionErrors.map(o);else if(i.code==="invalid_return_type")o(i.returnTypeError);else if(i.code==="invalid_arguments")o(i.argumentsError);else if(i.path.length===0)n._errors.push(r(i));else{let a=n,c=0;for(;c<i.path.length;){const u=i.path[c];c===i.path.length-1?(a[u]=a[u]||{_errors:[]},a[u]._errors.push(r(i))):a[u]=a[u]||{_errors:[]},a=a[u],c++}}};return o(this),n}static assert(t){if(!(t instanceof Ln))throw new Error(`Not a ZodError: ${t}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,ct.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(t=r=>r.message){const r={},n=[];for(const o of this.issues)o.path.length>0?(r[o.path[0]]=r[o.path[0]]||[],r[o.path[0]].push(t(o))):n.push(t(o));return{formErrors:n,fieldErrors:r}}get formErrors(){return this.flatten()}};xr.create=e=>new xr(e);var Cr;(function(e){e.errToObj=t=>typeof t=="string"?{message:t}:t||{},e.toString=t=>typeof t=="string"?t:t==null?void 0:t.message})(Cr||(Cr={}));var zr;(function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"})(zr||(zr={}));function m(e,t,r){function n(a,c){var u;Object.defineProperty(a,"_zod",{value:a._zod??{},enumerable:!1}),(u=a._zod).traits??(u.traits=new Set),a._zod.traits.add(e),t(a,c);for(const d in i.prototype)d in a||Object.defineProperty(a,d,{value:i.prototype[d].bind(a)});a._zod.constr=i,a._zod.def=c}const o=(r==null?void 0:r.Parent)??Object;class s extends o{}Object.defineProperty(s,"name",{value:e});function i(a){var c;const u=r!=null&&r.Parent?new s:this;n(u,a),(c=u._zod).deferred??(c.deferred=[]);for(const d of u._zod.deferred)d();return u}return Object.defineProperty(i,"init",{value:n}),Object.defineProperty(i,Symbol.hasInstance,{value:a=>{var c,u;return r!=null&&r.Parent&&a instanceof r.Parent?!0:(u=(c=a==null?void 0:a._zod)==null?void 0:c.traits)==null?void 0:u.has(e)}}),Object.defineProperty(i,"name",{value:e}),i}class ut extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}const Nn={};function Ue(e){return Nn}function bs(e){const t=Object.values(e).filter(n=>typeof n=="number");return Object.entries(e).filter(([n,o])=>t.indexOf(+n)===-1).map(([n,o])=>o)}function tr(e,t){return typeof t=="bigint"?t.toString():t}function xn(e){return{get value(){{const t=e();return Object.defineProperty(this,"value",{value:t}),t}}}}function _r(e){return e==null}function br(e){const t=e.startsWith("^")?1:0,r=e.endsWith("$")?e.length-1:e.length;return e.slice(t,r)}function vs(e,t){const r=(e.toString().split(".")[1]||"").length,n=(t.toString().split(".")[1]||"").length,o=r>n?r:n,s=Number.parseInt(e.toFixed(o).replace(".","")),i=Number.parseInt(t.toFixed(o).replace(".",""));return s%i/10**o}function H(e,t,r){Object.defineProperty(e,t,{get(){{const n=r();return e[t]=n,n}},set(n){Object.defineProperty(e,t,{value:n})},configurable:!0})}function xe(e,t,r){Object.defineProperty(e,t,{value:r,writable:!0,enumerable:!0,configurable:!0})}function tt(...e){const t={};for(const r of e){const n=Object.getOwnPropertyDescriptors(r);Object.assign(t,n)}return Object.defineProperties({},t)}function Zr(e){return JSON.stringify(e)}const Cn="captureStackTrace"in Error?Error.captureStackTrace:(...e)=>{};function rr(e){return typeof e=="object"&&e!==null&&!Array.isArray(e)}const Es=xn(()=>{var e;if(typeof navigator<"u"&&((e=navigator==null?void 0:navigator.userAgent)!=null&&e.includes("Cloudflare")))return!1;try{const t=Function;return new t(""),!0}catch{return!1}});function Ot(e){if(rr(e)===!1)return!1;const t=e.constructor;if(t===void 0)return!0;const r=t.prototype;return!(rr(r)===!1||Object.prototype.hasOwnProperty.call(r,"isPrototypeOf")===!1)}const As=new Set(["string","number","symbol"]);function Vt(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Ce(e,t,r){const n=new e._zod.constr(t??e._zod.def);return(!t||r!=null&&r.parent)&&(n._zod.parent=e),n}function R(e){const t=e;if(!t)return{};if(typeof t=="string")return{error:()=>t};if((t==null?void 0:t.message)!==void 0){if((t==null?void 0:t.error)!==void 0)throw new Error("Cannot specify both `message` and `error` params");t.error=t.message}return delete t.message,typeof t.error=="string"?{...t,error:()=>t.error}:t}function ks(e){return Object.keys(e).filter(t=>e[t]._zod.optin==="optional"&&e[t]._zod.optout==="optional")}const Ts={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-2147483648,2147483647],uint32:[0,4294967295],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]};function Ss(e,t){const r=e._zod.def,n=tt(e._zod.def,{get shape(){const o={};for(const s in t){if(!(s in r.shape))throw new Error(`Unrecognized key: "${s}"`);t[s]&&(o[s]=r.shape[s])}return xe(this,"shape",o),o},checks:[]});return Ce(e,n)}function Is(e,t){const r=e._zod.def,n=tt(e._zod.def,{get shape(){const o={...e._zod.def.shape};for(const s in t){if(!(s in r.shape))throw new Error(`Unrecognized key: "${s}"`);t[s]&&delete o[s]}return xe(this,"shape",o),o},checks:[]});return Ce(e,n)}function Rs(e,t){if(!Ot(t))throw new Error("Invalid input to extend: expected a plain object");const r=tt(e._zod.def,{get shape(){const n={...e._zod.def.shape,...t};return xe(this,"shape",n),n},checks:[]});return Ce(e,r)}function Us(e,t){const r=tt(e._zod.def,{get shape(){const n={...e._zod.def.shape,...t._zod.def.shape};return xe(this,"shape",n),n},get catchall(){return t._zod.def.catchall},checks:[]});return Ce(e,r)}function Os(e,t,r){const n=tt(t._zod.def,{get shape(){const o=t._zod.def.shape,s={...o};if(r)for(const i in r){if(!(i in o))throw new Error(`Unrecognized key: "${i}"`);r[i]&&(s[i]=e?new e({type:"optional",innerType:o[i]}):o[i])}else for(const i in o)s[i]=e?new e({type:"optional",innerType:o[i]}):o[i];return xe(this,"shape",s),s},checks:[]});return Ce(t,n)}function Ds(e,t,r){const n=tt(t._zod.def,{get shape(){const o=t._zod.def.shape,s={...o};if(r)for(const i in r){if(!(i in s))throw new Error(`Unrecognized key: "${i}"`);r[i]&&(s[i]=new e({type:"nonoptional",innerType:o[i]}))}else for(const i in o)s[i]=new e({type:"nonoptional",innerType:o[i]});return xe(this,"shape",s),s},checks:[]});return Ce(t,n)}function it(e,t=0){var r;for(let n=t;n<e.issues.length;n++)if(((r=e.issues[n])==null?void 0:r.continue)!==!0)return!0;return!1}function Fe(e,t){return t.map(r=>{var n;return(n=r).path??(n.path=[]),r.path.unshift(e),r})}function mt(e){return typeof e=="string"?e:e==null?void 0:e.message}function Oe(e,t,r){var o,s,i,a,c,u;const n={...e,path:e.path??[]};if(!e.message){const d=mt((i=(s=(o=e.inst)==null?void 0:o._zod.def)==null?void 0:s.error)==null?void 0:i.call(s,e))??mt((a=t==null?void 0:t.error)==null?void 0:a.call(t,e))??mt((c=r.customError)==null?void 0:c.call(r,e))??mt((u=r.localeError)==null?void 0:u.call(r,e))??"Invalid input";n.message=d}return delete n.inst,delete n.continue,t!=null&&t.reportInput||delete n.input,n}function vr(e){return Array.isArray(e)?"array":typeof e=="string"?"string":"unknown"}function dt(...e){const[t,r,n]=e;return typeof t=="string"?{message:t,code:"custom",input:r,inst:n}:{...t}}const zn=(e,t)=>{e.name="$ZodError",Object.defineProperty(e,"_zod",{value:e._zod,enumerable:!1}),Object.defineProperty(e,"issues",{value:t,enumerable:!1}),e.message=JSON.stringify(t,tr,2),Object.defineProperty(e,"toString",{value:()=>e.message,enumerable:!1})},Zn=m("$ZodError",zn),Vn=m("$ZodError",zn,{Parent:Error});function Ps(e,t=r=>r.message){const r={},n=[];for(const o of e.issues)o.path.length>0?(r[o.path[0]]=r[o.path[0]]||[],r[o.path[0]].push(t(o))):n.push(t(o));return{formErrors:n,fieldErrors:r}}function $s(e,t){const r=t||function(s){return s.message},n={_errors:[]},o=s=>{for(const i of s.issues)if(i.code==="invalid_union"&&i.errors.length)i.errors.map(a=>o({issues:a}));else if(i.code==="invalid_key")o({issues:i.issues});else if(i.code==="invalid_element")o({issues:i.issues});else if(i.path.length===0)n._errors.push(r(i));else{let a=n,c=0;for(;c<i.path.length;){const u=i.path[c];c===i.path.length-1?(a[u]=a[u]||{_errors:[]},a[u]._errors.push(r(i))):a[u]=a[u]||{_errors:[]},a=a[u],c++}}};return o(e),n}const Ls=e=>(t,r,n,o)=>{const s=n?Object.assign(n,{async:!1}):{async:!1},i=t._zod.run({value:r,issues:[]},s);if(i instanceof Promise)throw new ut;if(i.issues.length){const a=new((o==null?void 0:o.Err)??e)(i.issues.map(c=>Oe(c,s,Ue())));throw Cn(a,o==null?void 0:o.callee),a}return i.value},Ns=e=>async(t,r,n,o)=>{const s=n?Object.assign(n,{async:!0}):{async:!0};let i=t._zod.run({value:r,issues:[]},s);if(i instanceof Promise&&(i=await i),i.issues.length){const a=new((o==null?void 0:o.Err)??e)(i.issues.map(c=>Oe(c,s,Ue())));throw Cn(a,o==null?void 0:o.callee),a}return i.value},jn=e=>(t,r,n)=>{const o=n?{...n,async:!1}:{async:!1},s=t._zod.run({value:r,issues:[]},o);if(s instanceof Promise)throw new ut;return s.issues.length?{success:!1,error:new(e??Zn)(s.issues.map(i=>Oe(i,o,Ue())))}:{success:!0,data:s.value}},xs=jn(Vn),Bn=e=>async(t,r,n)=>{const o=n?Object.assign(n,{async:!0}):{async:!0};let s=t._zod.run({value:r,issues:[]},o);return s instanceof Promise&&(s=await s),s.issues.length?{success:!1,error:new e(s.issues.map(i=>Oe(i,o,Ue())))}:{success:!0,data:s.value}},Cs=Bn(Vn),zs=/^[cC][^\s-]{8,}$/,Zs=/^[0-9a-z]+$/,Vs=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,js=/^[0-9a-vA-V]{20}$/,Bs=/^[A-Za-z0-9]{27}$/,qs=/^[a-zA-Z0-9_-]{21}$/,Ms=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/,Ws=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,Vr=e=>e?new RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${e}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`):/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000)$/,Hs=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/,Ks="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";function Js(){return new RegExp(Ks,"u")}const Fs=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Gs=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})$/,Qs=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,Ys=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Xs=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,qn=/^[A-Za-z0-9_-]*$/,ei=/^([a-zA-Z0-9-]+\.)*[a-zA-Z0-9-]+$/,ti=/^\+(?:[0-9]){6,14}[0-9]$/,Mn="(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))",ri=new RegExp(`^${Mn}$`);function Wn(e){const t="(?:[01]\\d|2[0-3]):[0-5]\\d";return typeof e.precision=="number"?e.precision===-1?`${t}`:e.precision===0?`${t}:[0-5]\\d`:`${t}:[0-5]\\d\\.\\d{${e.precision}}`:`${t}(?::[0-5]\\d(?:\\.\\d+)?)?`}function ni(e){return new RegExp(`^${Wn(e)}$`)}function oi(e){const t=Wn({precision:e.precision}),r=["Z"];e.local&&r.push(""),e.offset&&r.push("([+-]\\d{2}:\\d{2})");const n=`${t}(?:${r.join("|")})`;return new RegExp(`^${Mn}T(?:${n})$`)}const si=e=>{const t=e?`[\\s\\S]{${(e==null?void 0:e.minimum)??0},${(e==null?void 0:e.maximum)??""}}`:"[\\s\\S]*";return new RegExp(`^${t}$`)},ii=/^\d+$/,ai=/^-?\d+(?:\.\d+)?/i,ci=/true|false/i,ui=/^[^A-Z]*$/,di=/^[^a-z]*$/,ae=m("$ZodCheck",(e,t)=>{var r;e._zod??(e._zod={}),e._zod.def=t,(r=e._zod).onattach??(r.onattach=[])}),Hn={number:"number",bigint:"bigint",object:"date"},Kn=m("$ZodCheckLessThan",(e,t)=>{ae.init(e,t);const r=Hn[typeof t.value];e._zod.onattach.push(n=>{const o=n._zod.bag,s=(t.inclusive?o.maximum:o.exclusiveMaximum)??Number.POSITIVE_INFINITY;t.value<s&&(t.inclusive?o.maximum=t.value:o.exclusiveMaximum=t.value)}),e._zod.check=n=>{(t.inclusive?n.value<=t.value:n.value<t.value)||n.issues.push({origin:r,code:"too_big",maximum:t.value,input:n.value,inclusive:t.inclusive,inst:e,continue:!t.abort})}}),Jn=m("$ZodCheckGreaterThan",(e,t)=>{ae.init(e,t);const r=Hn[typeof t.value];e._zod.onattach.push(n=>{const o=n._zod.bag,s=(t.inclusive?o.minimum:o.exclusiveMinimum)??Number.NEGATIVE_INFINITY;t.value>s&&(t.inclusive?o.minimum=t.value:o.exclusiveMinimum=t.value)}),e._zod.check=n=>{(t.inclusive?n.value>=t.value:n.value>t.value)||n.issues.push({origin:r,code:"too_small",minimum:t.value,input:n.value,inclusive:t.inclusive,inst:e,continue:!t.abort})}}),li=m("$ZodCheckMultipleOf",(e,t)=>{ae.init(e,t),e._zod.onattach.push(r=>{var n;(n=r._zod.bag).multipleOf??(n.multipleOf=t.value)}),e._zod.check=r=>{if(typeof r.value!=typeof t.value)throw new Error("Cannot mix number and bigint in multiple_of check.");(typeof r.value=="bigint"?r.value%t.value===BigInt(0):vs(r.value,t.value)===0)||r.issues.push({origin:typeof r.value,code:"not_multiple_of",divisor:t.value,input:r.value,inst:e,continue:!t.abort})}}),fi=m("$ZodCheckNumberFormat",(e,t)=>{var i;ae.init(e,t),t.format=t.format||"float64";const r=(i=t.format)==null?void 0:i.includes("int"),n=r?"int":"number",[o,s]=Ts[t.format];e._zod.onattach.push(a=>{const c=a._zod.bag;c.format=t.format,c.minimum=o,c.maximum=s,r&&(c.pattern=ii)}),e._zod.check=a=>{const c=a.value;if(r){if(!Number.isInteger(c)){a.issues.push({expected:n,format:t.format,code:"invalid_type",input:c,inst:e});return}if(!Number.isSafeInteger(c)){c>0?a.issues.push({input:c,code:"too_big",maximum:Number.MAX_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:e,origin:n,continue:!t.abort}):a.issues.push({input:c,code:"too_small",minimum:Number.MIN_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:e,origin:n,continue:!t.abort});return}}c<o&&a.issues.push({origin:"number",input:c,code:"too_small",minimum:o,inclusive:!0,inst:e,continue:!t.abort}),c>s&&a.issues.push({origin:"number",input:c,code:"too_big",maximum:s,inst:e})}}),hi=m("$ZodCheckMaxLength",(e,t)=>{var r;ae.init(e,t),(r=e._zod.def).when??(r.when=n=>{const o=n.value;return!_r(o)&&o.length!==void 0}),e._zod.onattach.push(n=>{const o=n._zod.bag.maximum??Number.POSITIVE_INFINITY;t.maximum<o&&(n._zod.bag.maximum=t.maximum)}),e._zod.check=n=>{const o=n.value;if(o.length<=t.maximum)return;const i=vr(o);n.issues.push({origin:i,code:"too_big",maximum:t.maximum,inclusive:!0,input:o,inst:e,continue:!t.abort})}}),pi=m("$ZodCheckMinLength",(e,t)=>{var r;ae.init(e,t),(r=e._zod.def).when??(r.when=n=>{const o=n.value;return!_r(o)&&o.length!==void 0}),e._zod.onattach.push(n=>{const o=n._zod.bag.minimum??Number.NEGATIVE_INFINITY;t.minimum>o&&(n._zod.bag.minimum=t.minimum)}),e._zod.check=n=>{const o=n.value;if(o.length>=t.minimum)return;const i=vr(o);n.issues.push({origin:i,code:"too_small",minimum:t.minimum,inclusive:!0,input:o,inst:e,continue:!t.abort})}}),mi=m("$ZodCheckLengthEquals",(e,t)=>{var r;ae.init(e,t),(r=e._zod.def).when??(r.when=n=>{const o=n.value;return!_r(o)&&o.length!==void 0}),e._zod.onattach.push(n=>{const o=n._zod.bag;o.minimum=t.length,o.maximum=t.length,o.length=t.length}),e._zod.check=n=>{const o=n.value,s=o.length;if(s===t.length)return;const i=vr(o),a=s>t.length;n.issues.push({origin:i,...a?{code:"too_big",maximum:t.length}:{code:"too_small",minimum:t.length},inclusive:!0,exact:!0,input:n.value,inst:e,continue:!t.abort})}}),jt=m("$ZodCheckStringFormat",(e,t)=>{var r,n;ae.init(e,t),e._zod.onattach.push(o=>{const s=o._zod.bag;s.format=t.format,t.pattern&&(s.patterns??(s.patterns=new Set),s.patterns.add(t.pattern))}),t.pattern?(r=e._zod).check??(r.check=o=>{t.pattern.lastIndex=0,!t.pattern.test(o.value)&&o.issues.push({origin:"string",code:"invalid_format",format:t.format,input:o.value,...t.pattern?{pattern:t.pattern.toString()}:{},inst:e,continue:!t.abort})}):(n=e._zod).check??(n.check=()=>{})}),gi=m("$ZodCheckRegex",(e,t)=>{jt.init(e,t),e._zod.check=r=>{t.pattern.lastIndex=0,!t.pattern.test(r.value)&&r.issues.push({origin:"string",code:"invalid_format",format:"regex",input:r.value,pattern:t.pattern.toString(),inst:e,continue:!t.abort})}}),wi=m("$ZodCheckLowerCase",(e,t)=>{t.pattern??(t.pattern=ui),jt.init(e,t)}),yi=m("$ZodCheckUpperCase",(e,t)=>{t.pattern??(t.pattern=di),jt.init(e,t)}),_i=m("$ZodCheckIncludes",(e,t)=>{ae.init(e,t);const r=Vt(t.includes),n=new RegExp(typeof t.position=="number"?`^.{${t.position}}${r}`:r);t.pattern=n,e._zod.onattach.push(o=>{const s=o._zod.bag;s.patterns??(s.patterns=new Set),s.patterns.add(n)}),e._zod.check=o=>{o.value.includes(t.includes,t.position)||o.issues.push({origin:"string",code:"invalid_format",format:"includes",includes:t.includes,input:o.value,inst:e,continue:!t.abort})}}),bi=m("$ZodCheckStartsWith",(e,t)=>{ae.init(e,t);const r=new RegExp(`^${Vt(t.prefix)}.*`);t.pattern??(t.pattern=r),e._zod.onattach.push(n=>{const o=n._zod.bag;o.patterns??(o.patterns=new Set),o.patterns.add(r)}),e._zod.check=n=>{n.value.startsWith(t.prefix)||n.issues.push({origin:"string",code:"invalid_format",format:"starts_with",prefix:t.prefix,input:n.value,inst:e,continue:!t.abort})}}),vi=m("$ZodCheckEndsWith",(e,t)=>{ae.init(e,t);const r=new RegExp(`.*${Vt(t.suffix)}$`);t.pattern??(t.pattern=r),e._zod.onattach.push(n=>{const o=n._zod.bag;o.patterns??(o.patterns=new Set),o.patterns.add(r)}),e._zod.check=n=>{n.value.endsWith(t.suffix)||n.issues.push({origin:"string",code:"invalid_format",format:"ends_with",suffix:t.suffix,input:n.value,inst:e,continue:!t.abort})}}),Ei=m("$ZodCheckOverwrite",(e,t)=>{ae.init(e,t),e._zod.check=r=>{r.value=t.tx(r.value)}});class Ai{constructor(t=[]){this.content=[],this.indent=0,this&&(this.args=t)}indented(t){this.indent+=1,t(this),this.indent-=1}write(t){if(typeof t=="function"){t(this,{execution:"sync"}),t(this,{execution:"async"});return}const n=t.split(`
`).filter(i=>i),o=Math.min(...n.map(i=>i.length-i.trimStart().length)),s=n.map(i=>i.slice(o)).map(i=>" ".repeat(this.indent*2)+i);for(const i of s)this.content.push(i)}compile(){const t=Function,r=this==null?void 0:this.args,o=[...((this==null?void 0:this.content)??[""]).map(s=>`  ${s}`)];return new t(...r,o.join(`
`))}}const ki={major:4,minor:0,patch:10},F=m("$ZodType",(e,t)=>{var o;var r;e??(e={}),e._zod.def=t,e._zod.bag=e._zod.bag||{},e._zod.version=ki;const n=[...e._zod.def.checks??[]];e._zod.traits.has("$ZodCheck")&&n.unshift(e);for(const s of n)for(const i of s._zod.onattach)i(e);if(n.length===0)(r=e._zod).deferred??(r.deferred=[]),(o=e._zod.deferred)==null||o.push(()=>{e._zod.run=e._zod.parse});else{const s=(i,a,c)=>{let u=it(i),d;for(const l of a){if(l._zod.def.when){if(!l._zod.def.when(i))continue}else if(u)continue;const f=i.issues.length,h=l._zod.check(i);if(h instanceof Promise&&(c==null?void 0:c.async)===!1)throw new ut;if(d||h instanceof Promise)d=(d??Promise.resolve()).then(async()=>{await h,i.issues.length!==f&&(u||(u=it(i,f)))});else{if(i.issues.length===f)continue;u||(u=it(i,f))}}return d?d.then(()=>i):i};e._zod.run=(i,a)=>{const c=e._zod.parse(i,a);if(c instanceof Promise){if(a.async===!1)throw new ut;return c.then(u=>s(u,n,a))}return s(c,n,a)}}e["~standard"]={validate:s=>{var i;try{const a=xs(e,s);return a.success?{value:a.data}:{issues:(i=a.error)==null?void 0:i.issues}}catch{return Cs(e,s).then(c=>{var u;return c.success?{value:c.data}:{issues:(u=c.error)==null?void 0:u.issues}})}},vendor:"zod",version:1}}),Er=m("$ZodString",(e,t)=>{var r;F.init(e,t),e._zod.pattern=[...((r=e==null?void 0:e._zod.bag)==null?void 0:r.patterns)??[]].pop()??si(e._zod.bag),e._zod.parse=(n,o)=>{if(t.coerce)try{n.value=String(n.value)}catch{}return typeof n.value=="string"||n.issues.push({expected:"string",code:"invalid_type",input:n.value,inst:e}),n}}),G=m("$ZodStringFormat",(e,t)=>{jt.init(e,t),Er.init(e,t)}),Ti=m("$ZodGUID",(e,t)=>{t.pattern??(t.pattern=Ws),G.init(e,t)}),Si=m("$ZodUUID",(e,t)=>{if(t.version){const n={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[t.version];if(n===void 0)throw new Error(`Invalid UUID version: "${t.version}"`);t.pattern??(t.pattern=Vr(n))}else t.pattern??(t.pattern=Vr());G.init(e,t)}),Ii=m("$ZodEmail",(e,t)=>{t.pattern??(t.pattern=Hs),G.init(e,t)}),Ri=m("$ZodURL",(e,t)=>{G.init(e,t),e._zod.check=r=>{try{const n=r.value.trim(),o=new URL(n);t.hostname&&(t.hostname.lastIndex=0,t.hostname.test(o.hostname)||r.issues.push({code:"invalid_format",format:"url",note:"Invalid hostname",pattern:ei.source,input:r.value,inst:e,continue:!t.abort})),t.protocol&&(t.protocol.lastIndex=0,t.protocol.test(o.protocol.endsWith(":")?o.protocol.slice(0,-1):o.protocol)||r.issues.push({code:"invalid_format",format:"url",note:"Invalid protocol",pattern:t.protocol.source,input:r.value,inst:e,continue:!t.abort})),t.normalize?r.value=o.href:r.value=n;return}catch{r.issues.push({code:"invalid_format",format:"url",input:r.value,inst:e,continue:!t.abort})}}}),Ui=m("$ZodEmoji",(e,t)=>{t.pattern??(t.pattern=Js()),G.init(e,t)}),Oi=m("$ZodNanoID",(e,t)=>{t.pattern??(t.pattern=qs),G.init(e,t)}),Di=m("$ZodCUID",(e,t)=>{t.pattern??(t.pattern=zs),G.init(e,t)}),Pi=m("$ZodCUID2",(e,t)=>{t.pattern??(t.pattern=Zs),G.init(e,t)}),$i=m("$ZodULID",(e,t)=>{t.pattern??(t.pattern=Vs),G.init(e,t)}),Li=m("$ZodXID",(e,t)=>{t.pattern??(t.pattern=js),G.init(e,t)}),Ni=m("$ZodKSUID",(e,t)=>{t.pattern??(t.pattern=Bs),G.init(e,t)}),xi=m("$ZodISODateTime",(e,t)=>{t.pattern??(t.pattern=oi(t)),G.init(e,t)}),Ci=m("$ZodISODate",(e,t)=>{t.pattern??(t.pattern=ri),G.init(e,t)}),zi=m("$ZodISOTime",(e,t)=>{t.pattern??(t.pattern=ni(t)),G.init(e,t)}),Zi=m("$ZodISODuration",(e,t)=>{t.pattern??(t.pattern=Ms),G.init(e,t)}),Vi=m("$ZodIPv4",(e,t)=>{t.pattern??(t.pattern=Fs),G.init(e,t),e._zod.onattach.push(r=>{const n=r._zod.bag;n.format="ipv4"})}),ji=m("$ZodIPv6",(e,t)=>{t.pattern??(t.pattern=Gs),G.init(e,t),e._zod.onattach.push(r=>{const n=r._zod.bag;n.format="ipv6"}),e._zod.check=r=>{try{new URL(`http://[${r.value}]`)}catch{r.issues.push({code:"invalid_format",format:"ipv6",input:r.value,inst:e,continue:!t.abort})}}}),Bi=m("$ZodCIDRv4",(e,t)=>{t.pattern??(t.pattern=Qs),G.init(e,t)}),qi=m("$ZodCIDRv6",(e,t)=>{t.pattern??(t.pattern=Ys),G.init(e,t),e._zod.check=r=>{const[n,o]=r.value.split("/");try{if(!o)throw new Error;const s=Number(o);if(`${s}`!==o)throw new Error;if(s<0||s>128)throw new Error;new URL(`http://[${n}]`)}catch{r.issues.push({code:"invalid_format",format:"cidrv6",input:r.value,inst:e,continue:!t.abort})}}});function Fn(e){if(e==="")return!0;if(e.length%4!==0)return!1;try{return atob(e),!0}catch{return!1}}const Mi=m("$ZodBase64",(e,t)=>{t.pattern??(t.pattern=Xs),G.init(e,t),e._zod.onattach.push(r=>{r._zod.bag.contentEncoding="base64"}),e._zod.check=r=>{Fn(r.value)||r.issues.push({code:"invalid_format",format:"base64",input:r.value,inst:e,continue:!t.abort})}});function Wi(e){if(!qn.test(e))return!1;const t=e.replace(/[-_]/g,n=>n==="-"?"+":"/"),r=t.padEnd(Math.ceil(t.length/4)*4,"=");return Fn(r)}const Hi=m("$ZodBase64URL",(e,t)=>{t.pattern??(t.pattern=qn),G.init(e,t),e._zod.onattach.push(r=>{r._zod.bag.contentEncoding="base64url"}),e._zod.check=r=>{Wi(r.value)||r.issues.push({code:"invalid_format",format:"base64url",input:r.value,inst:e,continue:!t.abort})}}),Ki=m("$ZodE164",(e,t)=>{t.pattern??(t.pattern=ti),G.init(e,t)});function Ji(e,t=null){try{const r=e.split(".");if(r.length!==3)return!1;const[n]=r;if(!n)return!1;const o=JSON.parse(atob(n));return!("typ"in o&&(o==null?void 0:o.typ)!=="JWT"||!o.alg||t&&(!("alg"in o)||o.alg!==t))}catch{return!1}}const Fi=m("$ZodJWT",(e,t)=>{G.init(e,t),e._zod.check=r=>{Ji(r.value,t.alg)||r.issues.push({code:"invalid_format",format:"jwt",input:r.value,inst:e,continue:!t.abort})}}),Gn=m("$ZodNumber",(e,t)=>{F.init(e,t),e._zod.pattern=e._zod.bag.pattern??ai,e._zod.parse=(r,n)=>{if(t.coerce)try{r.value=Number(r.value)}catch{}const o=r.value;if(typeof o=="number"&&!Number.isNaN(o)&&Number.isFinite(o))return r;const s=typeof o=="number"?Number.isNaN(o)?"NaN":Number.isFinite(o)?void 0:"Infinity":void 0;return r.issues.push({expected:"number",code:"invalid_type",input:o,inst:e,...s?{received:s}:{}}),r}}),Gi=m("$ZodNumber",(e,t)=>{fi.init(e,t),Gn.init(e,t)}),Qi=m("$ZodBoolean",(e,t)=>{F.init(e,t),e._zod.pattern=ci,e._zod.parse=(r,n)=>{if(t.coerce)try{r.value=!!r.value}catch{}const o=r.value;return typeof o=="boolean"||r.issues.push({expected:"boolean",code:"invalid_type",input:o,inst:e}),r}}),Yi=m("$ZodUnknown",(e,t)=>{F.init(e,t),e._zod.parse=r=>r}),Xi=m("$ZodNever",(e,t)=>{F.init(e,t),e._zod.parse=(r,n)=>(r.issues.push({expected:"never",code:"invalid_type",input:r.value,inst:e}),r)}),ea=m("$ZodDate",(e,t)=>{F.init(e,t),e._zod.parse=(r,n)=>{if(t.coerce)try{r.value=new Date(r.value)}catch{}const o=r.value,s=o instanceof Date;return s&&!Number.isNaN(o.getTime())||r.issues.push({expected:"date",code:"invalid_type",input:o,...s?{received:"Invalid Date"}:{},inst:e}),r}});function jr(e,t,r){e.issues.length&&t.issues.push(...Fe(r,e.issues)),t.value[r]=e.value}const ta=m("$ZodArray",(e,t)=>{F.init(e,t),e._zod.parse=(r,n)=>{const o=r.value;if(!Array.isArray(o))return r.issues.push({expected:"array",code:"invalid_type",input:o,inst:e}),r;r.value=Array(o.length);const s=[];for(let i=0;i<o.length;i++){const a=o[i],c=t.element._zod.run({value:a,issues:[]},n);c instanceof Promise?s.push(c.then(u=>jr(u,r,i))):jr(c,r,i)}return s.length?Promise.all(s).then(()=>r):r}});function gt(e,t,r,n){e.issues.length&&t.issues.push(...Fe(r,e.issues)),e.value===void 0?r in n&&(t.value[r]=void 0):t.value[r]=e.value}const ra=m("$ZodObject",(e,t)=>{F.init(e,t);const r=xn(()=>{const l=Object.keys(t.shape);for(const h of l)if(!(t.shape[h]instanceof F))throw new Error(`Invalid element at key "${h}": expected a Zod schema`);const f=ks(t.shape);return{shape:t.shape,keys:l,keySet:new Set(l),numKeys:l.length,optionalKeys:new Set(f)}});H(e._zod,"propValues",()=>{const l=t.shape,f={};for(const h in l){const p=l[h]._zod;if(p.values){f[h]??(f[h]=new Set);for(const y of p.values)f[h].add(y)}}return f});const n=l=>{const f=new Ai(["shape","payload","ctx"]),h=r.value,p=v=>{const E=Zr(v);return`shape[${E}]._zod.run({ value: input[${E}], issues: [] }, ctx)`};f.write("const input = payload.value;");const y=Object.create(null);let g=0;for(const v of h.keys)y[v]=`key_${g++}`;f.write("const newResult = {}");for(const v of h.keys){const E=y[v],_=Zr(v);f.write(`const ${E} = ${p(v)};`),f.write(`
        if (${E}.issues.length) {
          payload.issues = payload.issues.concat(${E}.issues.map(iss => ({
            ...iss,
            path: iss.path ? [${_}, ...iss.path] : [${_}]
          })));
        }
        
        if (${E}.value === undefined) {
          if (${_} in input) {
            newResult[${_}] = undefined;
          }
        } else {
          newResult[${_}] = ${E}.value;
        }
      `)}f.write("payload.value = newResult;"),f.write("return payload;");const A=f.compile();return(v,E)=>A(l,v,E)};let o;const s=rr,i=!Nn.jitless,c=i&&Es.value,u=t.catchall;let d;e._zod.parse=(l,f)=>{d??(d=r.value);const h=l.value;if(!s(h))return l.issues.push({expected:"object",code:"invalid_type",input:h,inst:e}),l;const p=[];if(i&&c&&(f==null?void 0:f.async)===!1&&f.jitless!==!0)o||(o=n(t.shape)),l=o(l,f);else{l.value={};const E=d.shape;for(const _ of d.keys){const k=E[_]._zod.run({value:h[_],issues:[]},f);k instanceof Promise?p.push(k.then(V=>gt(V,l,_,h))):gt(k,l,_,h)}}if(!u)return p.length?Promise.all(p).then(()=>l):l;const y=[],g=d.keySet,A=u._zod,v=A.def.type;for(const E of Object.keys(h)){if(g.has(E))continue;if(v==="never"){y.push(E);continue}const _=A.run({value:h[E],issues:[]},f);_ instanceof Promise?p.push(_.then(U=>gt(U,l,E,h))):gt(_,l,E,h)}return y.length&&l.issues.push({code:"unrecognized_keys",keys:y,input:h,inst:e}),p.length?Promise.all(p).then(()=>l):l}});function Br(e,t,r,n){for(const s of e)if(s.issues.length===0)return t.value=s.value,t;const o=e.filter(s=>!it(s));return o.length===1?(t.value=o[0].value,o[0]):(t.issues.push({code:"invalid_union",input:t.value,inst:r,errors:e.map(s=>s.issues.map(i=>Oe(i,n,Ue())))}),t)}const na=m("$ZodUnion",(e,t)=>{F.init(e,t),H(e._zod,"optin",()=>t.options.some(r=>r._zod.optin==="optional")?"optional":void 0),H(e._zod,"optout",()=>t.options.some(r=>r._zod.optout==="optional")?"optional":void 0),H(e._zod,"values",()=>{if(t.options.every(r=>r._zod.values))return new Set(t.options.flatMap(r=>Array.from(r._zod.values)))}),H(e._zod,"pattern",()=>{if(t.options.every(r=>r._zod.pattern)){const r=t.options.map(n=>n._zod.pattern);return new RegExp(`^(${r.map(n=>br(n.source)).join("|")})$`)}}),e._zod.parse=(r,n)=>{let o=!1;const s=[];for(const i of t.options){const a=i._zod.run({value:r.value,issues:[]},n);if(a instanceof Promise)s.push(a),o=!0;else{if(a.issues.length===0)return a;s.push(a)}}return o?Promise.all(s).then(i=>Br(i,r,e,n)):Br(s,r,e,n)}}),oa=m("$ZodIntersection",(e,t)=>{F.init(e,t),e._zod.parse=(r,n)=>{const o=r.value,s=t.left._zod.run({value:o,issues:[]},n),i=t.right._zod.run({value:o,issues:[]},n);return s instanceof Promise||i instanceof Promise?Promise.all([s,i]).then(([c,u])=>qr(r,c,u)):qr(r,s,i)}});function nr(e,t){if(e===t)return{valid:!0,data:e};if(e instanceof Date&&t instanceof Date&&+e==+t)return{valid:!0,data:e};if(Ot(e)&&Ot(t)){const r=Object.keys(t),n=Object.keys(e).filter(s=>r.indexOf(s)!==-1),o={...e,...t};for(const s of n){const i=nr(e[s],t[s]);if(!i.valid)return{valid:!1,mergeErrorPath:[s,...i.mergeErrorPath]};o[s]=i.data}return{valid:!0,data:o}}if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return{valid:!1,mergeErrorPath:[]};const r=[];for(let n=0;n<e.length;n++){const o=e[n],s=t[n],i=nr(o,s);if(!i.valid)return{valid:!1,mergeErrorPath:[n,...i.mergeErrorPath]};r.push(i.data)}return{valid:!0,data:r}}return{valid:!1,mergeErrorPath:[]}}function qr(e,t,r){if(t.issues.length&&e.issues.push(...t.issues),r.issues.length&&e.issues.push(...r.issues),it(e))return e;const n=nr(t.value,r.value);if(!n.valid)throw new Error(`Unmergable intersection. Error path: ${JSON.stringify(n.mergeErrorPath)}`);return e.value=n.data,e}const sa=m("$ZodRecord",(e,t)=>{F.init(e,t),e._zod.parse=(r,n)=>{const o=r.value;if(!Ot(o))return r.issues.push({expected:"record",code:"invalid_type",input:o,inst:e}),r;const s=[];if(t.keyType._zod.values){const i=t.keyType._zod.values;r.value={};for(const c of i)if(typeof c=="string"||typeof c=="number"||typeof c=="symbol"){const u=t.valueType._zod.run({value:o[c],issues:[]},n);u instanceof Promise?s.push(u.then(d=>{d.issues.length&&r.issues.push(...Fe(c,d.issues)),r.value[c]=d.value})):(u.issues.length&&r.issues.push(...Fe(c,u.issues)),r.value[c]=u.value)}let a;for(const c in o)i.has(c)||(a=a??[],a.push(c));a&&a.length>0&&r.issues.push({code:"unrecognized_keys",input:o,inst:e,keys:a})}else{r.value={};for(const i of Reflect.ownKeys(o)){if(i==="__proto__")continue;const a=t.keyType._zod.run({value:i,issues:[]},n);if(a instanceof Promise)throw new Error("Async schemas not supported in object keys currently");if(a.issues.length){r.issues.push({origin:"record",code:"invalid_key",issues:a.issues.map(u=>Oe(u,n,Ue())),input:i,path:[i],inst:e}),r.value[a.value]=a.value;continue}const c=t.valueType._zod.run({value:o[i],issues:[]},n);c instanceof Promise?s.push(c.then(u=>{u.issues.length&&r.issues.push(...Fe(i,u.issues)),r.value[a.value]=u.value})):(c.issues.length&&r.issues.push(...Fe(i,c.issues)),r.value[a.value]=c.value)}}return s.length?Promise.all(s).then(()=>r):r}}),ia=m("$ZodEnum",(e,t)=>{F.init(e,t);const r=bs(t.entries),n=new Set(r);e._zod.values=n,e._zod.pattern=new RegExp(`^(${r.filter(o=>As.has(typeof o)).map(o=>typeof o=="string"?Vt(o):o.toString()).join("|")})$`),e._zod.parse=(o,s)=>{const i=o.value;return n.has(i)||o.issues.push({code:"invalid_value",values:r,input:i,inst:e}),o}}),aa=m("$ZodTransform",(e,t)=>{F.init(e,t),e._zod.parse=(r,n)=>{const o=t.transform(r.value,r);if(n.async)return(o instanceof Promise?o:Promise.resolve(o)).then(i=>(r.value=i,r));if(o instanceof Promise)throw new ut;return r.value=o,r}}),ca=m("$ZodOptional",(e,t)=>{F.init(e,t),e._zod.optin="optional",e._zod.optout="optional",H(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,void 0]):void 0),H(e._zod,"pattern",()=>{const r=t.innerType._zod.pattern;return r?new RegExp(`^(${br(r.source)})?$`):void 0}),e._zod.parse=(r,n)=>t.innerType._zod.optin==="optional"?t.innerType._zod.run(r,n):r.value===void 0?r:t.innerType._zod.run(r,n)}),ua=m("$ZodNullable",(e,t)=>{F.init(e,t),H(e._zod,"optin",()=>t.innerType._zod.optin),H(e._zod,"optout",()=>t.innerType._zod.optout),H(e._zod,"pattern",()=>{const r=t.innerType._zod.pattern;return r?new RegExp(`^(${br(r.source)}|null)$`):void 0}),H(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,null]):void 0),e._zod.parse=(r,n)=>r.value===null?r:t.innerType._zod.run(r,n)}),da=m("$ZodDefault",(e,t)=>{F.init(e,t),e._zod.optin="optional",H(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(r,n)=>{if(r.value===void 0)return r.value=t.defaultValue,r;const o=t.innerType._zod.run(r,n);return o instanceof Promise?o.then(s=>Mr(s,t)):Mr(o,t)}});function Mr(e,t){return e.value===void 0&&(e.value=t.defaultValue),e}const la=m("$ZodPrefault",(e,t)=>{F.init(e,t),e._zod.optin="optional",H(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(r,n)=>(r.value===void 0&&(r.value=t.defaultValue),t.innerType._zod.run(r,n))}),fa=m("$ZodNonOptional",(e,t)=>{F.init(e,t),H(e._zod,"values",()=>{const r=t.innerType._zod.values;return r?new Set([...r].filter(n=>n!==void 0)):void 0}),e._zod.parse=(r,n)=>{const o=t.innerType._zod.run(r,n);return o instanceof Promise?o.then(s=>Wr(s,e)):Wr(o,e)}});function Wr(e,t){return!e.issues.length&&e.value===void 0&&e.issues.push({code:"invalid_type",expected:"nonoptional",input:e.value,inst:t}),e}const ha=m("$ZodCatch",(e,t)=>{F.init(e,t),H(e._zod,"optin",()=>t.innerType._zod.optin),H(e._zod,"optout",()=>t.innerType._zod.optout),H(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(r,n)=>{const o=t.innerType._zod.run(r,n);return o instanceof Promise?o.then(s=>(r.value=s.value,s.issues.length&&(r.value=t.catchValue({...r,error:{issues:s.issues.map(i=>Oe(i,n,Ue()))},input:r.value}),r.issues=[]),r)):(r.value=o.value,o.issues.length&&(r.value=t.catchValue({...r,error:{issues:o.issues.map(s=>Oe(s,n,Ue()))},input:r.value}),r.issues=[]),r)}}),pa=m("$ZodPipe",(e,t)=>{F.init(e,t),H(e._zod,"values",()=>t.in._zod.values),H(e._zod,"optin",()=>t.in._zod.optin),H(e._zod,"optout",()=>t.out._zod.optout),H(e._zod,"propValues",()=>t.in._zod.propValues),e._zod.parse=(r,n)=>{const o=t.in._zod.run(r,n);return o instanceof Promise?o.then(s=>Hr(s,t,n)):Hr(o,t,n)}});function Hr(e,t,r){return e.issues.length?e:t.out._zod.run({value:e.value,issues:e.issues},r)}const ma=m("$ZodReadonly",(e,t)=>{F.init(e,t),H(e._zod,"propValues",()=>t.innerType._zod.propValues),H(e._zod,"values",()=>t.innerType._zod.values),H(e._zod,"optin",()=>t.innerType._zod.optin),H(e._zod,"optout",()=>t.innerType._zod.optout),e._zod.parse=(r,n)=>{const o=t.innerType._zod.run(r,n);return o instanceof Promise?o.then(Kr):Kr(o)}});function Kr(e){return e.value=Object.freeze(e.value),e}const ga=m("$ZodCustom",(e,t)=>{ae.init(e,t),F.init(e,t),e._zod.parse=(r,n)=>r,e._zod.check=r=>{const n=r.value,o=t.fn(n);if(o instanceof Promise)return o.then(s=>Jr(s,r,n,e));Jr(o,r,n,e)}});function Jr(e,t,r,n){if(!e){const o={code:"custom",input:r,inst:n,path:[...n._zod.def.path??[]],continue:!n._zod.def.abort};n._zod.def.params&&(o.params=n._zod.def.params),t.issues.push(dt(o))}}class wa{constructor(){this._map=new Map,this._idmap=new Map}add(t,...r){const n=r[0];if(this._map.set(t,n),n&&typeof n=="object"&&"id"in n){if(this._idmap.has(n.id))throw new Error(`ID ${n.id} already exists in the registry`);this._idmap.set(n.id,t)}return this}clear(){return this._map=new Map,this._idmap=new Map,this}remove(t){const r=this._map.get(t);return r&&typeof r=="object"&&"id"in r&&this._idmap.delete(r.id),this._map.delete(t),this}get(t){const r=t._zod.parent;if(r){const n={...this.get(r)??{}};delete n.id;const o={...n,...this._map.get(t)};return Object.keys(o).length?o:void 0}return this._map.get(t)}has(t){return this._map.has(t)}}function ya(){return new wa}const wt=ya();function _a(e,t){return new e({type:"string",...R(t)})}function ba(e,t){return new e({type:"string",coerce:!0,...R(t)})}function Qn(e,t){return new e({type:"string",format:"email",check:"string_format",abort:!1,...R(t)})}function Fr(e,t){return new e({type:"string",format:"guid",check:"string_format",abort:!1,...R(t)})}function va(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,...R(t)})}function Ea(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v4",...R(t)})}function Aa(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v6",...R(t)})}function ka(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v7",...R(t)})}function Ta(e,t){return new e({type:"string",format:"url",check:"string_format",abort:!1,...R(t)})}function Sa(e,t){return new e({type:"string",format:"emoji",check:"string_format",abort:!1,...R(t)})}function Ia(e,t){return new e({type:"string",format:"nanoid",check:"string_format",abort:!1,...R(t)})}function Ra(e,t){return new e({type:"string",format:"cuid",check:"string_format",abort:!1,...R(t)})}function Ua(e,t){return new e({type:"string",format:"cuid2",check:"string_format",abort:!1,...R(t)})}function Oa(e,t){return new e({type:"string",format:"ulid",check:"string_format",abort:!1,...R(t)})}function Da(e,t){return new e({type:"string",format:"xid",check:"string_format",abort:!1,...R(t)})}function Pa(e,t){return new e({type:"string",format:"ksuid",check:"string_format",abort:!1,...R(t)})}function $a(e,t){return new e({type:"string",format:"ipv4",check:"string_format",abort:!1,...R(t)})}function La(e,t){return new e({type:"string",format:"ipv6",check:"string_format",abort:!1,...R(t)})}function Na(e,t){return new e({type:"string",format:"cidrv4",check:"string_format",abort:!1,...R(t)})}function xa(e,t){return new e({type:"string",format:"cidrv6",check:"string_format",abort:!1,...R(t)})}function Ca(e,t){return new e({type:"string",format:"base64",check:"string_format",abort:!1,...R(t)})}function za(e,t){return new e({type:"string",format:"base64url",check:"string_format",abort:!1,...R(t)})}function Za(e,t){return new e({type:"string",format:"e164",check:"string_format",abort:!1,...R(t)})}function Va(e,t){return new e({type:"string",format:"jwt",check:"string_format",abort:!1,...R(t)})}function ja(e,t){return new e({type:"string",format:"datetime",check:"string_format",offset:!1,local:!1,precision:null,...R(t)})}function Ba(e,t){return new e({type:"string",format:"date",check:"string_format",...R(t)})}function qa(e,t){return new e({type:"string",format:"time",check:"string_format",precision:null,...R(t)})}function Ma(e,t){return new e({type:"string",format:"duration",check:"string_format",...R(t)})}function Wa(e,t){return new e({type:"number",checks:[],...R(t)})}function Ha(e,t){return new e({type:"number",check:"number_format",abort:!1,format:"safeint",...R(t)})}function Ka(e,t){return new e({type:"boolean",...R(t)})}function Ja(e,t){return new e({type:"boolean",coerce:!0,...R(t)})}function Fa(e){return new e({type:"unknown"})}function Ga(e,t){return new e({type:"never",...R(t)})}function Qa(e,t){return new e({type:"date",...R(t)})}function Gr(e,t){return new Kn({check:"less_than",...R(t),value:e,inclusive:!1})}function Tt(e,t){return new Kn({check:"less_than",...R(t),value:e,inclusive:!0})}function Qr(e,t){return new Jn({check:"greater_than",...R(t),value:e,inclusive:!1})}function St(e,t){return new Jn({check:"greater_than",...R(t),value:e,inclusive:!0})}function Yr(e,t){return new li({check:"multiple_of",...R(t),value:e})}function Yn(e,t){return new hi({check:"max_length",...R(t),maximum:e})}function Dt(e,t){return new pi({check:"min_length",...R(t),minimum:e})}function Xn(e,t){return new mi({check:"length_equals",...R(t),length:e})}function Ya(e,t){return new gi({check:"string_format",format:"regex",...R(t),pattern:e})}function Xa(e){return new wi({check:"string_format",format:"lowercase",...R(e)})}function ec(e){return new yi({check:"string_format",format:"uppercase",...R(e)})}function tc(e,t){return new _i({check:"string_format",format:"includes",...R(t),includes:e})}function rc(e,t){return new bi({check:"string_format",format:"starts_with",...R(t),prefix:e})}function nc(e,t){return new vi({check:"string_format",format:"ends_with",...R(t),suffix:e})}function ht(e){return new Ei({check:"overwrite",tx:e})}function oc(e){return ht(t=>t.normalize(e))}function sc(){return ht(e=>e.trim())}function ic(){return ht(e=>e.toLowerCase())}function ac(){return ht(e=>e.toUpperCase())}function cc(e,t,r){return new e({type:"array",element:t,...R(r)})}function uc(e,t,r){return new e({type:"custom",check:"custom",fn:t,...R(r)})}const dc=m("ZodISODateTime",(e,t)=>{xi.init(e,t),Y.init(e,t)});function lc(e){return ja(dc,e)}const fc=m("ZodISODate",(e,t)=>{Ci.init(e,t),Y.init(e,t)});function hc(e){return Ba(fc,e)}const pc=m("ZodISOTime",(e,t)=>{zi.init(e,t),Y.init(e,t)});function mc(e){return qa(pc,e)}const gc=m("ZodISODuration",(e,t)=>{Zi.init(e,t),Y.init(e,t)});function wc(e){return Ma(gc,e)}const yc=(e,t)=>{Zn.init(e,t),e.name="ZodError",Object.defineProperties(e,{format:{value:r=>$s(e,r)},flatten:{value:r=>Ps(e,r)},addIssue:{value:r=>{e.issues.push(r),e.message=JSON.stringify(e.issues,tr,2)}},addIssues:{value:r=>{e.issues.push(...r),e.message=JSON.stringify(e.issues,tr,2)}},isEmpty:{get(){return e.issues.length===0}}})},Bt=m("ZodError",yc,{Parent:Error}),_c=Ls(Bt),bc=Ns(Bt),vc=jn(Bt),Ec=Bn(Bt),X=m("ZodType",(e,t)=>(F.init(e,t),e.def=t,Object.defineProperty(e,"_def",{value:t}),e.check=(...r)=>e.clone({...t,checks:[...t.checks??[],...r.map(n=>typeof n=="function"?{_zod:{check:n,def:{check:"custom"},onattach:[]}}:n)]}),e.clone=(r,n)=>Ce(e,r,n),e.brand=()=>e,e.register=(r,n)=>(r.add(e,n),e),e.parse=(r,n)=>_c(e,r,n,{callee:e.parse}),e.safeParse=(r,n)=>vc(e,r,n),e.parseAsync=async(r,n)=>bc(e,r,n,{callee:e.parseAsync}),e.safeParseAsync=async(r,n)=>Ec(e,r,n),e.spa=e.safeParseAsync,e.refine=(r,n)=>e.check(fu(r,n)),e.superRefine=r=>e.check(hu(r)),e.overwrite=r=>e.check(ht(r)),e.optional=()=>Pt(e),e.nullable=()=>tn(e),e.nullish=()=>Pt(tn(e)),e.nonoptional=r=>ou(e,r),e.array=()=>lt(e),e.or=r=>io([e,r]),e.and=r=>Jc(e,r),e.transform=r=>rn(e,Yc(r)),e.default=r=>tu(e,r),e.prefault=r=>nu(e,r),e.catch=r=>iu(e,r),e.pipe=r=>rn(e,r),e.readonly=()=>uu(e),e.describe=r=>{const n=e.clone();return wt.add(n,{description:r}),n},Object.defineProperty(e,"description",{get(){var r;return(r=wt.get(e))==null?void 0:r.description},configurable:!0}),e.meta=(...r)=>{if(r.length===0)return wt.get(e);const n=e.clone();return wt.add(n,r[0]),n},e.isOptional=()=>e.safeParse(void 0).success,e.isNullable=()=>e.safeParse(null).success,e)),eo=m("_ZodString",(e,t)=>{Er.init(e,t),X.init(e,t);const r=e._zod.bag;e.format=r.format??null,e.minLength=r.minimum??null,e.maxLength=r.maximum??null,e.regex=(...n)=>e.check(Ya(...n)),e.includes=(...n)=>e.check(tc(...n)),e.startsWith=(...n)=>e.check(rc(...n)),e.endsWith=(...n)=>e.check(nc(...n)),e.min=(...n)=>e.check(Dt(...n)),e.max=(...n)=>e.check(Yn(...n)),e.length=(...n)=>e.check(Xn(...n)),e.nonempty=(...n)=>e.check(Dt(1,...n)),e.lowercase=n=>e.check(Xa(n)),e.uppercase=n=>e.check(ec(n)),e.trim=()=>e.check(sc()),e.normalize=(...n)=>e.check(oc(...n)),e.toLowerCase=()=>e.check(ic()),e.toUpperCase=()=>e.check(ac())}),to=m("ZodString",(e,t)=>{Er.init(e,t),eo.init(e,t),e.email=r=>e.check(Qn(ro,r)),e.url=r=>e.check(Ta(Ac,r)),e.jwt=r=>e.check(Va(zc,r)),e.emoji=r=>e.check(Sa(kc,r)),e.guid=r=>e.check(Fr(Xr,r)),e.uuid=r=>e.check(va(yt,r)),e.uuidv4=r=>e.check(Ea(yt,r)),e.uuidv6=r=>e.check(Aa(yt,r)),e.uuidv7=r=>e.check(ka(yt,r)),e.nanoid=r=>e.check(Ia(Tc,r)),e.guid=r=>e.check(Fr(Xr,r)),e.cuid=r=>e.check(Ra(Sc,r)),e.cuid2=r=>e.check(Ua(Ic,r)),e.ulid=r=>e.check(Oa(Rc,r)),e.base64=r=>e.check(Ca(Nc,r)),e.base64url=r=>e.check(za(xc,r)),e.xid=r=>e.check(Da(Uc,r)),e.ksuid=r=>e.check(Pa(Oc,r)),e.ipv4=r=>e.check($a(Dc,r)),e.ipv6=r=>e.check(La(Pc,r)),e.cidrv4=r=>e.check(Na($c,r)),e.cidrv6=r=>e.check(xa(Lc,r)),e.e164=r=>e.check(Za(Cc,r)),e.datetime=r=>e.check(lc(r)),e.date=r=>e.check(hc(r)),e.time=r=>e.check(mc(r)),e.duration=r=>e.check(wc(r))});function w(e){return _a(to,e)}const Y=m("ZodStringFormat",(e,t)=>{G.init(e,t),eo.init(e,t)}),ro=m("ZodEmail",(e,t)=>{Ii.init(e,t),Y.init(e,t)});function Ar(e){return Qn(ro,e)}const Xr=m("ZodGUID",(e,t)=>{Ti.init(e,t),Y.init(e,t)}),yt=m("ZodUUID",(e,t)=>{Si.init(e,t),Y.init(e,t)}),Ac=m("ZodURL",(e,t)=>{Ri.init(e,t),Y.init(e,t)}),kc=m("ZodEmoji",(e,t)=>{Ui.init(e,t),Y.init(e,t)}),Tc=m("ZodNanoID",(e,t)=>{Oi.init(e,t),Y.init(e,t)}),Sc=m("ZodCUID",(e,t)=>{Di.init(e,t),Y.init(e,t)}),Ic=m("ZodCUID2",(e,t)=>{Pi.init(e,t),Y.init(e,t)}),Rc=m("ZodULID",(e,t)=>{$i.init(e,t),Y.init(e,t)}),Uc=m("ZodXID",(e,t)=>{Li.init(e,t),Y.init(e,t)}),Oc=m("ZodKSUID",(e,t)=>{Ni.init(e,t),Y.init(e,t)}),Dc=m("ZodIPv4",(e,t)=>{Vi.init(e,t),Y.init(e,t)}),Pc=m("ZodIPv6",(e,t)=>{ji.init(e,t),Y.init(e,t)}),$c=m("ZodCIDRv4",(e,t)=>{Bi.init(e,t),Y.init(e,t)}),Lc=m("ZodCIDRv6",(e,t)=>{qi.init(e,t),Y.init(e,t)}),Nc=m("ZodBase64",(e,t)=>{Mi.init(e,t),Y.init(e,t)}),xc=m("ZodBase64URL",(e,t)=>{Hi.init(e,t),Y.init(e,t)}),Cc=m("ZodE164",(e,t)=>{Ki.init(e,t),Y.init(e,t)}),zc=m("ZodJWT",(e,t)=>{Fi.init(e,t),Y.init(e,t)}),no=m("ZodNumber",(e,t)=>{Gn.init(e,t),X.init(e,t),e.gt=(n,o)=>e.check(Qr(n,o)),e.gte=(n,o)=>e.check(St(n,o)),e.min=(n,o)=>e.check(St(n,o)),e.lt=(n,o)=>e.check(Gr(n,o)),e.lte=(n,o)=>e.check(Tt(n,o)),e.max=(n,o)=>e.check(Tt(n,o)),e.int=n=>e.check(en(n)),e.safe=n=>e.check(en(n)),e.positive=n=>e.check(Qr(0,n)),e.nonnegative=n=>e.check(St(0,n)),e.negative=n=>e.check(Gr(0,n)),e.nonpositive=n=>e.check(Tt(0,n)),e.multipleOf=(n,o)=>e.check(Yr(n,o)),e.step=(n,o)=>e.check(Yr(n,o)),e.finite=()=>e;const r=e._zod.bag;e.minValue=Math.max(r.minimum??Number.NEGATIVE_INFINITY,r.exclusiveMinimum??Number.NEGATIVE_INFINITY)??null,e.maxValue=Math.min(r.maximum??Number.POSITIVE_INFINITY,r.exclusiveMaximum??Number.POSITIVE_INFINITY)??null,e.isInt=(r.format??"").includes("int")||Number.isSafeInteger(r.multipleOf??.5),e.isFinite=!0,e.format=r.format??null});function oo(e){return Wa(no,e)}const Zc=m("ZodNumberFormat",(e,t)=>{Gi.init(e,t),no.init(e,t)});function en(e){return Ha(Zc,e)}const so=m("ZodBoolean",(e,t)=>{Qi.init(e,t),X.init(e,t)});function Ne(e){return Ka(so,e)}const Vc=m("ZodUnknown",(e,t)=>{Yi.init(e,t),X.init(e,t)});function or(){return Fa(Vc)}const jc=m("ZodNever",(e,t)=>{Xi.init(e,t),X.init(e,t)});function Bc(e){return Ga(jc,e)}const qc=m("ZodDate",(e,t)=>{ea.init(e,t),X.init(e,t),e.min=(n,o)=>e.check(St(n,o)),e.max=(n,o)=>e.check(Tt(n,o));const r=e._zod.bag;e.minDate=r.minimum?new Date(r.minimum):null,e.maxDate=r.maximum?new Date(r.maximum):null});function re(e){return Qa(qc,e)}const Mc=m("ZodArray",(e,t)=>{ta.init(e,t),X.init(e,t),e.element=t.element,e.min=(r,n)=>e.check(Dt(r,n)),e.nonempty=r=>e.check(Dt(1,r)),e.max=(r,n)=>e.check(Yn(r,n)),e.length=(r,n)=>e.check(Xn(r,n)),e.unwrap=()=>e.element});function lt(e,t){return cc(Mc,e,t)}const Wc=m("ZodObject",(e,t)=>{ra.init(e,t),X.init(e,t),H(e,"shape",()=>t.shape),e.keyof=()=>ft(Object.keys(e._zod.def.shape)),e.catchall=r=>e.clone({...e._zod.def,catchall:r}),e.passthrough=()=>e.clone({...e._zod.def,catchall:or()}),e.loose=()=>e.clone({...e._zod.def,catchall:or()}),e.strict=()=>e.clone({...e._zod.def,catchall:Bc()}),e.strip=()=>e.clone({...e._zod.def,catchall:void 0}),e.extend=r=>Rs(e,r),e.merge=r=>Us(e,r),e.pick=r=>Ss(e,r),e.omit=r=>Is(e,r),e.partial=(...r)=>Os(ao,e,r[0]),e.required=(...r)=>Ds(co,e,r[0])});function x(e,t){const r={type:"object",get shape(){return xe(this,"shape",{...e}),this.shape},...R(t)};return new Wc(r)}const Hc=m("ZodUnion",(e,t)=>{na.init(e,t),X.init(e,t),e.options=t.options});function io(e,t){return new Hc({type:"union",options:e,...R(t)})}const Kc=m("ZodIntersection",(e,t)=>{oa.init(e,t),X.init(e,t)});function Jc(e,t){return new Kc({type:"intersection",left:e,right:t})}const Fc=m("ZodRecord",(e,t)=>{sa.init(e,t),X.init(e,t),e.keyType=t.keyType,e.valueType=t.valueType});function Gc(e,t,r){return new Fc({type:"record",keyType:e,valueType:t,...R(r)})}const sr=m("ZodEnum",(e,t)=>{ia.init(e,t),X.init(e,t),e.enum=t.entries,e.options=Object.values(t.entries);const r=new Set(Object.keys(t.entries));e.extract=(n,o)=>{const s={};for(const i of n)if(r.has(i))s[i]=t.entries[i];else throw new Error(`Key ${i} not found in enum`);return new sr({...t,checks:[],...R(o),entries:s})},e.exclude=(n,o)=>{const s={...t.entries};for(const i of n)if(r.has(i))delete s[i];else throw new Error(`Key ${i} not found in enum`);return new sr({...t,checks:[],...R(o),entries:s})}});function ft(e,t){const r=Array.isArray(e)?Object.fromEntries(e.map(n=>[n,n])):e;return new sr({type:"enum",entries:r,...R(t)})}const Qc=m("ZodTransform",(e,t)=>{aa.init(e,t),X.init(e,t),e._zod.parse=(r,n)=>{r.addIssue=s=>{if(typeof s=="string")r.issues.push(dt(s,r.value,t));else{const i=s;i.fatal&&(i.continue=!1),i.code??(i.code="custom"),i.input??(i.input=r.value),i.inst??(i.inst=e),r.issues.push(dt(i))}};const o=t.transform(r.value,r);return o instanceof Promise?o.then(s=>(r.value=s,r)):(r.value=o,r)}});function Yc(e){return new Qc({type:"transform",transform:e})}const ao=m("ZodOptional",(e,t)=>{ca.init(e,t),X.init(e,t),e.unwrap=()=>e._zod.def.innerType});function Pt(e){return new ao({type:"optional",innerType:e})}const Xc=m("ZodNullable",(e,t)=>{ua.init(e,t),X.init(e,t),e.unwrap=()=>e._zod.def.innerType});function tn(e){return new Xc({type:"nullable",innerType:e})}const eu=m("ZodDefault",(e,t)=>{da.init(e,t),X.init(e,t),e.unwrap=()=>e._zod.def.innerType,e.removeDefault=e.unwrap});function tu(e,t){return new eu({type:"default",innerType:e,get defaultValue(){return typeof t=="function"?t():t}})}const ru=m("ZodPrefault",(e,t)=>{la.init(e,t),X.init(e,t),e.unwrap=()=>e._zod.def.innerType});function nu(e,t){return new ru({type:"prefault",innerType:e,get defaultValue(){return typeof t=="function"?t():t}})}const co=m("ZodNonOptional",(e,t)=>{fa.init(e,t),X.init(e,t),e.unwrap=()=>e._zod.def.innerType});function ou(e,t){return new co({type:"nonoptional",innerType:e,...R(t)})}const su=m("ZodCatch",(e,t)=>{ha.init(e,t),X.init(e,t),e.unwrap=()=>e._zod.def.innerType,e.removeCatch=e.unwrap});function iu(e,t){return new su({type:"catch",innerType:e,catchValue:typeof t=="function"?t:()=>t})}const au=m("ZodPipe",(e,t)=>{pa.init(e,t),X.init(e,t),e.in=t.in,e.out=t.out});function rn(e,t){return new au({type:"pipe",in:e,out:t})}const cu=m("ZodReadonly",(e,t)=>{ma.init(e,t),X.init(e,t),e.unwrap=()=>e._zod.def.innerType});function uu(e){return new cu({type:"readonly",innerType:e})}const du=m("ZodCustom",(e,t)=>{ga.init(e,t),X.init(e,t)});function lu(e){const t=new ae({check:"custom"});return t._zod.check=e,t}function fu(e,t={}){return uc(du,e,t)}function hu(e){const t=lu(r=>(r.addIssue=n=>{if(typeof n=="string")r.issues.push(dt(n,r.value,t._zod.def));else{const o=n;o.fatal&&(o.continue=!1),o.code??(o.code="custom"),o.input??(o.input=r.value),o.inst??(o.inst=t),o.continue??(o.continue=!t._zod.def.abort),r.issues.push(dt(o))}},e(r.value,r)));return t}function qt(e){return ba(to,e)}function nn(e){return Ja(so,e)}const Qe=(e,t="ms")=>new Date(Date.now()+(t==="sec"?e*1e3:e));function $t(e){return e?"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_":"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"}function uo(e,t,r){let n="",o=0,s=0;for(const i of e)for(o=o<<8|i,s+=8;s>=6;)s-=6,n+=t[o>>s&63];if(s>0&&(n+=t[o<<6-s&63]),r){const i=(4-n.length%4)%4;n+="=".repeat(i)}return n}function lo(e,t){const r=new Map;for(let i=0;i<t.length;i++)r.set(t[i],i);const n=[];let o=0,s=0;for(const i of e){if(i==="=")break;const a=r.get(i);if(a===void 0)throw new Error(`Invalid Base64 character: ${i}`);o=o<<6|a,s+=6,s>=8&&(s-=8,n.push(o>>s&255))}return Uint8Array.from(n)}const rt={encode(e,t={}){const r=$t(!1),n=typeof e=="string"?new TextEncoder().encode(e):new Uint8Array(e);return uo(n,r,t.padding??!0)},decode(e){typeof e!="string"&&(e=new TextDecoder().decode(e));const t=e.includes("-")||e.includes("_"),r=$t(t);return lo(e,r)}},kr={encode(e,t={}){const r=$t(!0),n=typeof e=="string"?new TextEncoder().encode(e):new Uint8Array(e);return uo(n,r,t.padding??!0)},decode(e){const t=e.includes("-")||e.includes("_"),r=$t(t);return lo(e,r)}};function Tr(e,t){return{digest:async r=>{const n=new TextEncoder,o=typeof r=="string"?n.encode(r):r;return await Le.digest(e,o)}}}function It(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`positive integer expected, not ${e}`)}function on(e){if(typeof e!="boolean")throw new Error(`boolean expected, not ${e}`)}function fo(e){return e instanceof Uint8Array||e!=null&&typeof e=="object"&&e.constructor.name==="Uint8Array"}function ce(e,...t){if(!fo(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error(`Uint8Array expected of length ${t}, not of length=${e.length}`)}function sn(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function pu(e,t){ce(e);const r=t.outputLen;if(e.length<r)throw new Error(`digestInto() expects output buffer of length at least ${r}`)}/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */const Ie=e=>new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4)),mu=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),gu=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!gu)throw new Error("Non little-endian hardware is not supported");const wu=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function yu(e){ce(e);let t="";for(let r=0;r<e.length;r++)t+=wu[e[r]];return t}const ve={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function an(e){if(e>=ve._0&&e<=ve._9)return e-ve._0;if(e>=ve._A&&e<=ve._F)return e-(ve._A-10);if(e>=ve._a&&e<=ve._f)return e-(ve._a-10)}function _u(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);const t=e.length,r=t/2;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);const n=new Uint8Array(r);for(let o=0,s=0;o<r;o++,s+=2){const i=an(e.charCodeAt(s)),a=an(e.charCodeAt(s+1));if(i===void 0||a===void 0){const c=e[s]+e[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}n[o]=i*16+a}return n}function ho(e){if(typeof e!="string")throw new Error(`string expected, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function ir(e){if(typeof e=="string")e=ho(e);else if(fo(e))e=ar(e);else throw new Error(`Uint8Array expected, got ${typeof e}`);return e}function bu(...e){let t=0;for(let n=0;n<e.length;n++){const o=e[n];ce(o),t+=o.length}const r=new Uint8Array(t);for(let n=0,o=0;n<e.length;n++){const s=e[n];r.set(s,o),o+=s.length}return r}function vu(e,t){if(t==null||typeof t!="object")throw new Error("options must be defined");return Object.assign(e,t)}function Eu(e,t){if(e.length!==t.length)return!1;let r=0;for(let n=0;n<e.length;n++)r|=e[n]^t[n];return r===0}const Au=(e,t)=>(Object.assign(t,e),t);function cn(e,t,r,n){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,r,n);const o=BigInt(32),s=BigInt(4294967295),i=Number(r>>o&s),a=Number(r&s),c=4,u=0;e.setUint32(t+c,i,n),e.setUint32(t+u,a,n)}function ar(e){return Uint8Array.from(e)}function Ye(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}const po=e=>Uint8Array.from(e.split("").map(t=>t.charCodeAt(0))),ku=po("expand 16-byte k"),Tu=po("expand 32-byte k"),Su=Ie(ku),mo=Ie(Tu);mo.slice();function S(e,t){return e<<t|e>>>32-t}function cr(e){return e.byteOffset%4===0}const _t=64,Iu=16,go=2**32-1,un=new Uint32Array;function Ru(e,t,r,n,o,s,i,a){const c=o.length,u=new Uint8Array(_t),d=Ie(u),l=cr(o)&&cr(s),f=l?Ie(o):un,h=l?Ie(s):un;for(let p=0;p<c;i++){if(e(t,r,n,d,i,a),i>=go)throw new Error("arx: counter overflow");const y=Math.min(_t,c-p);if(l&&y===_t){const g=p/4;if(p%4!==0)throw new Error("arx: invalid block position");for(let A=0,v;A<Iu;A++)v=g+A,h[v]=f[v]^d[A];p+=_t;continue}for(let g=0,A;g<y;g++)A=p+g,s[A]=o[A]^u[g];p+=y}}function Uu(e,t){const{allowShortKeys:r,extendNonceFn:n,counterLength:o,counterRight:s,rounds:i}=vu({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},t);if(typeof e!="function")throw new Error("core must be a function");return It(o),It(i),on(s),on(r),(a,c,u,d,l=0)=>{ce(a),ce(c),ce(u);const f=u.length;if(d===void 0&&(d=new Uint8Array(f)),ce(d),It(l),l<0||l>=go)throw new Error("arx: counter overflow");if(d.length<f)throw new Error(`arx: output (${d.length}) is shorter than data (${f})`);const h=[];let p=a.length,y,g;if(p===32)h.push(y=ar(a)),g=mo;else if(p===16&&r)y=new Uint8Array(32),y.set(a),y.set(a,16),g=Su,h.push(y);else throw new Error(`arx: invalid 32-byte key, got length=${p}`);cr(c)||h.push(c=ar(c));const A=Ie(y);if(n){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");n(g,A,Ie(c.subarray(0,16)),A),c=c.subarray(16)}const v=16-o;if(v!==c.length)throw new Error(`arx: nonce must be ${v} or 16 bytes`);if(v!==12){const _=new Uint8Array(12);_.set(c,s?0:12-c.length),c=_,h.push(c)}const E=Ie(c);return Ru(e,g,A,E,u,d,l,i),Ye(...h),d}}const ne=(e,t)=>e[t++]&255|(e[t++]&255)<<8;class Ou{constructor(t){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,t=ir(t),ce(t,32);const r=ne(t,0),n=ne(t,2),o=ne(t,4),s=ne(t,6),i=ne(t,8),a=ne(t,10),c=ne(t,12),u=ne(t,14);this.r[0]=r&8191,this.r[1]=(r>>>13|n<<3)&8191,this.r[2]=(n>>>10|o<<6)&7939,this.r[3]=(o>>>7|s<<9)&8191,this.r[4]=(s>>>4|i<<12)&255,this.r[5]=i>>>1&8190,this.r[6]=(i>>>14|a<<2)&8191,this.r[7]=(a>>>11|c<<5)&8065,this.r[8]=(c>>>8|u<<8)&8191,this.r[9]=u>>>5&127;for(let d=0;d<8;d++)this.pad[d]=ne(t,16+2*d)}process(t,r,n=!1){const o=n?0:2048,{h:s,r:i}=this,a=i[0],c=i[1],u=i[2],d=i[3],l=i[4],f=i[5],h=i[6],p=i[7],y=i[8],g=i[9],A=ne(t,r+0),v=ne(t,r+2),E=ne(t,r+4),_=ne(t,r+6),U=ne(t,r+8),k=ne(t,r+10),V=ne(t,r+12),j=ne(t,r+14);let C=s[0]+(A&8191),T=s[1]+((A>>>13|v<<3)&8191),z=s[2]+((v>>>10|E<<6)&8191),B=s[3]+((E>>>7|_<<9)&8191),P=s[4]+((_>>>4|U<<12)&8191),O=s[5]+(U>>>1&8191),L=s[6]+((U>>>14|k<<2)&8191),N=s[7]+((k>>>11|V<<5)&8191),D=s[8]+((V>>>8|j<<8)&8191),Z=s[9]+(j>>>5|o),I=0,W=I+C*a+T*(5*g)+z*(5*y)+B*(5*p)+P*(5*h);I=W>>>13,W&=8191,W+=O*(5*f)+L*(5*l)+N*(5*d)+D*(5*u)+Z*(5*c),I+=W>>>13,W&=8191;let K=I+C*c+T*a+z*(5*g)+B*(5*y)+P*(5*p);I=K>>>13,K&=8191,K+=O*(5*h)+L*(5*f)+N*(5*l)+D*(5*d)+Z*(5*u),I+=K>>>13,K&=8191;let J=I+C*u+T*c+z*a+B*(5*g)+P*(5*y);I=J>>>13,J&=8191,J+=O*(5*p)+L*(5*h)+N*(5*f)+D*(5*l)+Z*(5*d),I+=J>>>13,J&=8191;let ue=I+C*d+T*u+z*c+B*a+P*(5*g);I=ue>>>13,ue&=8191,ue+=O*(5*y)+L*(5*p)+N*(5*h)+D*(5*f)+Z*(5*l),I+=ue>>>13,ue&=8191;let Ve=I+C*l+T*d+z*u+B*c+P*a;I=Ve>>>13,Ve&=8191,Ve+=O*(5*g)+L*(5*y)+N*(5*p)+D*(5*h)+Z*(5*f),I+=Ve>>>13,Ve&=8191;let je=I+C*f+T*l+z*d+B*u+P*c;I=je>>>13,je&=8191,je+=O*a+L*(5*g)+N*(5*y)+D*(5*p)+Z*(5*h),I+=je>>>13,je&=8191;let Be=I+C*h+T*f+z*l+B*d+P*u;I=Be>>>13,Be&=8191,Be+=O*c+L*a+N*(5*g)+D*(5*y)+Z*(5*p),I+=Be>>>13,Be&=8191;let qe=I+C*p+T*h+z*f+B*l+P*d;I=qe>>>13,qe&=8191,qe+=O*u+L*c+N*a+D*(5*g)+Z*(5*y),I+=qe>>>13,qe&=8191;let Me=I+C*y+T*p+z*h+B*f+P*l;I=Me>>>13,Me&=8191,Me+=O*d+L*u+N*c+D*a+Z*(5*g),I+=Me>>>13,Me&=8191;let We=I+C*g+T*y+z*p+B*h+P*f;I=We>>>13,We&=8191,We+=O*l+L*d+N*u+D*c+Z*a,I+=We>>>13,We&=8191,I=(I<<2)+I|0,I=I+W|0,W=I&8191,I=I>>>13,K+=I,s[0]=W,s[1]=K,s[2]=J,s[3]=ue,s[4]=Ve,s[5]=je,s[6]=Be,s[7]=qe,s[8]=Me,s[9]=We}finalize(){const{h:t,pad:r}=this,n=new Uint16Array(10);let o=t[1]>>>13;t[1]&=8191;for(let a=2;a<10;a++)t[a]+=o,o=t[a]>>>13,t[a]&=8191;t[0]+=o*5,o=t[0]>>>13,t[0]&=8191,t[1]+=o,o=t[1]>>>13,t[1]&=8191,t[2]+=o,n[0]=t[0]+5,o=n[0]>>>13,n[0]&=8191;for(let a=1;a<10;a++)n[a]=t[a]+o,o=n[a]>>>13,n[a]&=8191;n[9]-=8192;let s=(o^1)-1;for(let a=0;a<10;a++)n[a]&=s;s=~s;for(let a=0;a<10;a++)t[a]=t[a]&s|n[a];t[0]=(t[0]|t[1]<<13)&65535,t[1]=(t[1]>>>3|t[2]<<10)&65535,t[2]=(t[2]>>>6|t[3]<<7)&65535,t[3]=(t[3]>>>9|t[4]<<4)&65535,t[4]=(t[4]>>>12|t[5]<<1|t[6]<<14)&65535,t[5]=(t[6]>>>2|t[7]<<11)&65535,t[6]=(t[7]>>>5|t[8]<<8)&65535,t[7]=(t[8]>>>8|t[9]<<5)&65535;let i=t[0]+r[0];t[0]=i&65535;for(let a=1;a<8;a++)i=(t[a]+r[a]|0)+(i>>>16)|0,t[a]=i&65535;Ye(n)}update(t){sn(this);const{buffer:r,blockLen:n}=this;t=ir(t);const o=t.length;for(let s=0;s<o;){const i=Math.min(n-this.pos,o-s);if(i===n){for(;n<=o-s;s+=n)this.process(t,s);continue}r.set(t.subarray(s,s+i),this.pos),this.pos+=i,s+=i,this.pos===n&&(this.process(r,0,!1),this.pos=0)}return this}destroy(){Ye(this.h,this.r,this.buffer,this.pad)}digestInto(t){sn(this),pu(t,this),this.finished=!0;const{buffer:r,h:n}=this;let{pos:o}=this;if(o){for(r[o++]=1;o<16;o++)r[o]=0;this.process(r,0,!0)}this.finalize();let s=0;for(let i=0;i<8;i++)t[s++]=n[i]>>>0,t[s++]=n[i]>>>8;return t}digest(){const{buffer:t,outputLen:r}=this;this.digestInto(t);const n=t.slice(0,r);return this.destroy(),n}}function Du(e){const t=(n,o)=>e(o).update(ir(n)).digest(),r=e(new Uint8Array(32));return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=n=>e(n),t}const Pu=Du(e=>new Ou(e));function $u(e,t,r,n,o,s=20){let i=e[0],a=e[1],c=e[2],u=e[3],d=t[0],l=t[1],f=t[2],h=t[3],p=t[4],y=t[5],g=t[6],A=t[7],v=o,E=r[0],_=r[1],U=r[2],k=i,V=a,j=c,C=u,T=d,z=l,B=f,P=h,O=p,L=y,N=g,D=A,Z=v,I=E,W=_,K=U;for(let ue=0;ue<s;ue+=2)k=k+T|0,Z=S(Z^k,16),O=O+Z|0,T=S(T^O,12),k=k+T|0,Z=S(Z^k,8),O=O+Z|0,T=S(T^O,7),V=V+z|0,I=S(I^V,16),L=L+I|0,z=S(z^L,12),V=V+z|0,I=S(I^V,8),L=L+I|0,z=S(z^L,7),j=j+B|0,W=S(W^j,16),N=N+W|0,B=S(B^N,12),j=j+B|0,W=S(W^j,8),N=N+W|0,B=S(B^N,7),C=C+P|0,K=S(K^C,16),D=D+K|0,P=S(P^D,12),C=C+P|0,K=S(K^C,8),D=D+K|0,P=S(P^D,7),k=k+z|0,K=S(K^k,16),N=N+K|0,z=S(z^N,12),k=k+z|0,K=S(K^k,8),N=N+K|0,z=S(z^N,7),V=V+B|0,Z=S(Z^V,16),D=D+Z|0,B=S(B^D,12),V=V+B|0,Z=S(Z^V,8),D=D+Z|0,B=S(B^D,7),j=j+P|0,I=S(I^j,16),O=O+I|0,P=S(P^O,12),j=j+P|0,I=S(I^j,8),O=O+I|0,P=S(P^O,7),C=C+T|0,W=S(W^C,16),L=L+W|0,T=S(T^L,12),C=C+T|0,W=S(W^C,8),L=L+W|0,T=S(T^L,7);let J=0;n[J++]=i+k|0,n[J++]=a+V|0,n[J++]=c+j|0,n[J++]=u+C|0,n[J++]=d+T|0,n[J++]=l+z|0,n[J++]=f+B|0,n[J++]=h+P|0,n[J++]=p+O|0,n[J++]=y+L|0,n[J++]=g+N|0,n[J++]=A+D|0,n[J++]=v+Z|0,n[J++]=E+I|0,n[J++]=_+W|0,n[J++]=U+K|0}function Lu(e,t,r,n){let o=e[0],s=e[1],i=e[2],a=e[3],c=t[0],u=t[1],d=t[2],l=t[3],f=t[4],h=t[5],p=t[6],y=t[7],g=r[0],A=r[1],v=r[2],E=r[3];for(let U=0;U<20;U+=2)o=o+c|0,g=S(g^o,16),f=f+g|0,c=S(c^f,12),o=o+c|0,g=S(g^o,8),f=f+g|0,c=S(c^f,7),s=s+u|0,A=S(A^s,16),h=h+A|0,u=S(u^h,12),s=s+u|0,A=S(A^s,8),h=h+A|0,u=S(u^h,7),i=i+d|0,v=S(v^i,16),p=p+v|0,d=S(d^p,12),i=i+d|0,v=S(v^i,8),p=p+v|0,d=S(d^p,7),a=a+l|0,E=S(E^a,16),y=y+E|0,l=S(l^y,12),a=a+l|0,E=S(E^a,8),y=y+E|0,l=S(l^y,7),o=o+u|0,E=S(E^o,16),p=p+E|0,u=S(u^p,12),o=o+u|0,E=S(E^o,8),p=p+E|0,u=S(u^p,7),s=s+d|0,g=S(g^s,16),y=y+g|0,d=S(d^y,12),s=s+d|0,g=S(g^s,8),y=y+g|0,d=S(d^y,7),i=i+l|0,A=S(A^i,16),f=f+A|0,l=S(l^f,12),i=i+l|0,A=S(A^i,8),f=f+A|0,l=S(l^f,7),a=a+c|0,v=S(v^a,16),h=h+v|0,c=S(c^h,12),a=a+c|0,v=S(v^a,8),h=h+v|0,c=S(c^h,7);let _=0;n[_++]=o,n[_++]=s,n[_++]=i,n[_++]=a,n[_++]=g,n[_++]=A,n[_++]=v,n[_++]=E}const Nu=Uu($u,{counterRight:!1,counterLength:8,extendNonceFn:Lu,allowShortKeys:!1}),xu=new Uint8Array(16),dn=(e,t)=>{e.update(t);const r=t.length%16;r&&e.update(xu.subarray(r))},Cu=new Uint8Array(32);function ln(e,t,r,n,o){const s=e(t,r,Cu),i=Pu.create(s);o&&dn(i,o),dn(i,n);const a=new Uint8Array(16),c=mu(a);cn(c,0,BigInt(o?o.length:0),!0),cn(c,8,BigInt(n.length),!0),i.update(a);const u=i.digest();return Ye(s,a),u}const zu=e=>(t,r,n)=>(ce(t,32),ce(r),{encrypt(s,i){const a=s.length,c=a+16;i?ce(i,c):i=new Uint8Array(c),e(t,r,s,i,1);const u=ln(e,t,r,i.subarray(0,-16),n);return i.set(u,a),Ye(u),i},decrypt(s,i){const a=s.length,c=a-16;if(a<16)throw new Error("encrypted data must be at least 16 bytes");i?ce(i,c):i=new Uint8Array(c);const u=s.subarray(0,-16),d=s.subarray(-16),l=ln(e,t,r,u,n);if(!Eu(d,l))throw new Error("invalid tag");return e(t,r,u,i,1),Ye(l),i}}),wo=Au({blockSize:64,nonceLength:24,tagLength:16},zu(Nu)),Ht=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function Zu(e=32){if(Ht&&typeof Ht.getRandomValues=="function")return Ht.getRandomValues(new Uint8Array(e));throw new Error("crypto.getRandomValues must be defined")}function yo(e){return It(e.nonceLength),(t,...r)=>({encrypt(n,...o){const{nonceLength:s}=e,i=Zu(s),a=e(t,i,...r).encrypt(n,...o),c=bu(i,a);return a.fill(0),c},decrypt(n,...o){const{nonceLength:s}=e,i=n.subarray(0,s),a=n.subarray(s);return e(t,i,...r).decrypt(a,...o)}})}const Mt=crypto,_o=e=>e instanceof CryptoKey,_e=new TextEncoder,De=new TextDecoder;function bo(...e){const t=e.reduce((o,{length:s})=>o+s,0),r=new Uint8Array(t);let n=0;for(const o of e)r.set(o,n),n+=o.length;return r}const Vu=e=>{let t=e;typeof t=="string"&&(t=_e.encode(t));const r=32768,n=[];for(let o=0;o<t.length;o+=r)n.push(String.fromCharCode.apply(null,t.subarray(o,o+r)));return btoa(n.join(""))},Kt=e=>Vu(e).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"),ju=e=>{const t=atob(e),r=new Uint8Array(t.length);for(let n=0;n<t.length;n++)r[n]=t.charCodeAt(n);return r},Re=e=>{let t=e;t instanceof Uint8Array&&(t=De.decode(t)),t=t.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"");try{return ju(t)}catch{throw new TypeError("The input to be decoded is not correctly encoded.")}};class oe extends Error{constructor(t,r){var n;super(t,r),this.code="ERR_JOSE_GENERIC",this.name=this.constructor.name,(n=Error.captureStackTrace)==null||n.call(Error,this,this.constructor)}}oe.code="ERR_JOSE_GENERIC";class le extends oe{constructor(t,r,n="unspecified",o="unspecified"){super(t,{cause:{claim:n,reason:o,payload:r}}),this.code="ERR_JWT_CLAIM_VALIDATION_FAILED",this.claim=n,this.reason=o,this.payload=r}}le.code="ERR_JWT_CLAIM_VALIDATION_FAILED";class Lt extends oe{constructor(t,r,n="unspecified",o="unspecified"){super(t,{cause:{claim:n,reason:o,payload:r}}),this.code="ERR_JWT_EXPIRED",this.claim=n,this.reason=o,this.payload=r}}Lt.code="ERR_JWT_EXPIRED";class vo extends oe{constructor(){super(...arguments),this.code="ERR_JOSE_ALG_NOT_ALLOWED"}}vo.code="ERR_JOSE_ALG_NOT_ALLOWED";class be extends oe{constructor(){super(...arguments),this.code="ERR_JOSE_NOT_SUPPORTED"}}be.code="ERR_JOSE_NOT_SUPPORTED";class Bu extends oe{constructor(t="decryption operation failed",r){super(t,r),this.code="ERR_JWE_DECRYPTION_FAILED"}}Bu.code="ERR_JWE_DECRYPTION_FAILED";class qu extends oe{constructor(){super(...arguments),this.code="ERR_JWE_INVALID"}}qu.code="ERR_JWE_INVALID";class Q extends oe{constructor(){super(...arguments),this.code="ERR_JWS_INVALID"}}Q.code="ERR_JWS_INVALID";class fe extends oe{constructor(){super(...arguments),this.code="ERR_JWT_INVALID"}}fe.code="ERR_JWT_INVALID";class Mu extends oe{constructor(){super(...arguments),this.code="ERR_JWK_INVALID"}}Mu.code="ERR_JWK_INVALID";class Sr extends oe{constructor(){super(...arguments),this.code="ERR_JWKS_INVALID"}}Sr.code="ERR_JWKS_INVALID";class Ir extends oe{constructor(t="no applicable key found in the JSON Web Key Set",r){super(t,r),this.code="ERR_JWKS_NO_MATCHING_KEY"}}Ir.code="ERR_JWKS_NO_MATCHING_KEY";class Eo extends oe{constructor(t="multiple matching keys found in the JSON Web Key Set",r){super(t,r),this.code="ERR_JWKS_MULTIPLE_MATCHING_KEYS"}}Eo.code="ERR_JWKS_MULTIPLE_MATCHING_KEYS";class Ao extends oe{constructor(t="request timed out",r){super(t,r),this.code="ERR_JWKS_TIMEOUT"}}Ao.code="ERR_JWKS_TIMEOUT";class ko extends oe{constructor(t="signature verification failed",r){super(t,r),this.code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED"}}ko.code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED";function ge(e,t="algorithm.name"){return new TypeError(`CryptoKey does not support this operation, its ${t} must be ${e}`)}function ot(e,t){return e.name===t}function Jt(e){return parseInt(e.name.slice(4),10)}function Wu(e){switch(e){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw new Error("unreachable")}}function Hu(e,t){if(t.length&&!t.some(r=>e.usages.includes(r))){let r="CryptoKey does not support this operation, its usages must include ";if(t.length>2){const n=t.pop();r+=`one of ${t.join(", ")}, or ${n}.`}else t.length===2?r+=`one of ${t[0]} or ${t[1]}.`:r+=`${t[0]}.`;throw new TypeError(r)}}function Ku(e,t,...r){switch(t){case"HS256":case"HS384":case"HS512":{if(!ot(e.algorithm,"HMAC"))throw ge("HMAC");const n=parseInt(t.slice(2),10);if(Jt(e.algorithm.hash)!==n)throw ge(`SHA-${n}`,"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if(!ot(e.algorithm,"RSASSA-PKCS1-v1_5"))throw ge("RSASSA-PKCS1-v1_5");const n=parseInt(t.slice(2),10);if(Jt(e.algorithm.hash)!==n)throw ge(`SHA-${n}`,"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if(!ot(e.algorithm,"RSA-PSS"))throw ge("RSA-PSS");const n=parseInt(t.slice(2),10);if(Jt(e.algorithm.hash)!==n)throw ge(`SHA-${n}`,"algorithm.hash");break}case"EdDSA":{if(e.algorithm.name!=="Ed25519"&&e.algorithm.name!=="Ed448")throw ge("Ed25519 or Ed448");break}case"Ed25519":{if(!ot(e.algorithm,"Ed25519"))throw ge("Ed25519");break}case"ES256":case"ES384":case"ES512":{if(!ot(e.algorithm,"ECDSA"))throw ge("ECDSA");const n=Wu(t);if(e.algorithm.namedCurve!==n)throw ge(n,"algorithm.namedCurve");break}default:throw new TypeError("CryptoKey does not support this operation")}Hu(e,r)}function To(e,t,...r){var n;if(r=r.filter(Boolean),r.length>2){const o=r.pop();e+=`one of type ${r.join(", ")}, or ${o}.`}else r.length===2?e+=`one of type ${r[0]} or ${r[1]}.`:e+=`of type ${r[0]}.`;return t==null?e+=` Received ${t}`:typeof t=="function"&&t.name?e+=` Received function ${t.name}`:typeof t=="object"&&t!=null&&(n=t.constructor)!=null&&n.name&&(e+=` Received an instance of ${t.constructor.name}`),e}const fn=(e,...t)=>To("Key must be ",e,...t);function So(e,t,...r){return To(`Key for the ${e} algorithm must be `,t,...r)}const Io=e=>_o(e)?!0:(e==null?void 0:e[Symbol.toStringTag])==="KeyObject",Nt=["CryptoKey"],Ro=(...e)=>{const t=e.filter(Boolean);if(t.length===0||t.length===1)return!0;let r;for(const n of t){const o=Object.keys(n);if(!r||r.size===0){r=new Set(o);continue}for(const s of o){if(r.has(s))return!1;r.add(s)}}return!0};function Ju(e){return typeof e=="object"&&e!==null}function pe(e){if(!Ju(e)||Object.prototype.toString.call(e)!=="[object Object]")return!1;if(Object.getPrototypeOf(e)===null)return!0;let t=e;for(;Object.getPrototypeOf(t)!==null;)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}const Uo=(e,t)=>{if(e.startsWith("RS")||e.startsWith("PS")){const{modulusLength:r}=t.algorithm;if(typeof r!="number"||r<2048)throw new TypeError(`${e} requires key modulusLength to be 2048 bits or larger`)}};function nt(e){return pe(e)&&typeof e.kty=="string"}function Fu(e){return e.kty!=="oct"&&typeof e.d=="string"}function Gu(e){return e.kty!=="oct"&&typeof e.d>"u"}function Qu(e){return nt(e)&&e.kty==="oct"&&typeof e.k=="string"}function Yu(e){let t,r;switch(e.kty){case"RSA":{switch(e.alg){case"PS256":case"PS384":case"PS512":t={name:"RSA-PSS",hash:`SHA-${e.alg.slice(-3)}`},r=e.d?["sign"]:["verify"];break;case"RS256":case"RS384":case"RS512":t={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${e.alg.slice(-3)}`},r=e.d?["sign"]:["verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":t={name:"RSA-OAEP",hash:`SHA-${parseInt(e.alg.slice(-3),10)||1}`},r=e.d?["decrypt","unwrapKey"]:["encrypt","wrapKey"];break;default:throw new be('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"EC":{switch(e.alg){case"ES256":t={name:"ECDSA",namedCurve:"P-256"},r=e.d?["sign"]:["verify"];break;case"ES384":t={name:"ECDSA",namedCurve:"P-384"},r=e.d?["sign"]:["verify"];break;case"ES512":t={name:"ECDSA",namedCurve:"P-521"},r=e.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":t={name:"ECDH",namedCurve:e.crv},r=e.d?["deriveBits"]:[];break;default:throw new be('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"OKP":{switch(e.alg){case"Ed25519":t={name:"Ed25519"},r=e.d?["sign"]:["verify"];break;case"EdDSA":t={name:e.crv},r=e.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":t={name:e.crv},r=e.d?["deriveBits"]:[];break;default:throw new be('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}default:throw new be('Invalid or unsupported JWK "kty" (Key Type) Parameter value')}return{algorithm:t,keyUsages:r}}const Oo=async e=>{if(!e.alg)throw new TypeError('"alg" argument is required when "jwk.alg" is not present');const{algorithm:t,keyUsages:r}=Yu(e),n=[t,e.ext??!1,e.key_ops??r],o={...e};return delete o.alg,delete o.use,Mt.subtle.importKey("jwk",o,...n)},Do=e=>Re(e);let He,Ke;const Po=e=>(e==null?void 0:e[Symbol.toStringTag])==="KeyObject",xt=async(e,t,r,n,o=!1)=>{let s=e.get(t);if(s!=null&&s[n])return s[n];const i=await Oo({...r,alg:n});return o&&Object.freeze(t),s?s[n]=i:e.set(t,{[n]:i}),i},Xu=(e,t)=>{if(Po(e)){let r=e.export({format:"jwk"});return delete r.d,delete r.dp,delete r.dq,delete r.p,delete r.q,delete r.qi,r.k?Do(r.k):(Ke||(Ke=new WeakMap),xt(Ke,e,r,t))}return nt(e)?e.k?Re(e.k):(Ke||(Ke=new WeakMap),xt(Ke,e,e,t,!0)):e},ed=(e,t)=>{if(Po(e)){let r=e.export({format:"jwk"});return r.k?Do(r.k):(He||(He=new WeakMap),xt(He,e,r,t))}return nt(e)?e.k?Re(e.k):(He||(He=new WeakMap),xt(He,e,e,t,!0)):e},hn={normalizePublicKey:Xu,normalizePrivateKey:ed};async function Rr(e,t){if(!pe(e))throw new TypeError("JWK must be an object");switch(t||(t=e.alg),e.kty){case"oct":if(typeof e.k!="string"||!e.k)throw new TypeError('missing "k" (Key Value) Parameter value');return Re(e.k);case"RSA":if("oth"in e&&e.oth!==void 0)throw new be('RSA JWK "oth" (Other Primes Info) Parameter value is not supported');case"EC":case"OKP":return Oo({...e,alg:t});default:throw new be('Unsupported "kty" (Key Type) Parameter value')}}const Je=e=>e==null?void 0:e[Symbol.toStringTag],ur=(e,t,r)=>{var n,o;if(t.use!==void 0&&t.use!=="sig")throw new TypeError("Invalid key for this operation, when present its use must be sig");if(t.key_ops!==void 0&&((o=(n=t.key_ops).includes)==null?void 0:o.call(n,r))!==!0)throw new TypeError(`Invalid key for this operation, when present its key_ops must include ${r}`);if(t.alg!==void 0&&t.alg!==e)throw new TypeError(`Invalid key for this operation, when present its alg must be ${e}`);return!0},td=(e,t,r,n)=>{if(!(t instanceof Uint8Array)){if(n&&nt(t)){if(Qu(t)&&ur(e,t,r))return;throw new TypeError('JSON Web Key for symmetric algorithms must have JWK "kty" (Key Type) equal to "oct" and the JWK "k" (Key Value) present')}if(!Io(t))throw new TypeError(So(e,t,...Nt,"Uint8Array",n?"JSON Web Key":null));if(t.type!=="secret")throw new TypeError(`${Je(t)} instances for symmetric algorithms must be of type "secret"`)}},rd=(e,t,r,n)=>{if(n&&nt(t))switch(r){case"sign":if(Fu(t)&&ur(e,t,r))return;throw new TypeError("JSON Web Key for this operation be a private JWK");case"verify":if(Gu(t)&&ur(e,t,r))return;throw new TypeError("JSON Web Key for this operation be a public JWK")}if(!Io(t))throw new TypeError(So(e,t,...Nt,n?"JSON Web Key":null));if(t.type==="secret")throw new TypeError(`${Je(t)} instances for asymmetric algorithms must not be of type "secret"`);if(r==="sign"&&t.type==="public")throw new TypeError(`${Je(t)} instances for asymmetric algorithm signing must be of type "private"`);if(r==="decrypt"&&t.type==="public")throw new TypeError(`${Je(t)} instances for asymmetric algorithm decryption must be of type "private"`);if(t.algorithm&&r==="verify"&&t.type==="private")throw new TypeError(`${Je(t)} instances for asymmetric algorithm verifying must be of type "public"`);if(t.algorithm&&r==="encrypt"&&t.type==="private")throw new TypeError(`${Je(t)} instances for asymmetric algorithm encryption must be of type "public"`)};function $o(e,t,r,n){t.startsWith("HS")||t==="dir"||t.startsWith("PBES2")||/^A\d{3}(?:GCM)?KW$/.test(t)?td(t,r,n,e):rd(t,r,n,e)}$o.bind(void 0,!1);const dr=$o.bind(void 0,!0);function Lo(e,t,r,n,o){if(o.crit!==void 0&&(n==null?void 0:n.crit)===void 0)throw new e('"crit" (Critical) Header Parameter MUST be integrity protected');if(!n||n.crit===void 0)return new Set;if(!Array.isArray(n.crit)||n.crit.length===0||n.crit.some(i=>typeof i!="string"||i.length===0))throw new e('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');let s;r!==void 0?s=new Map([...Object.entries(r),...t.entries()]):s=t;for(const i of n.crit){if(!s.has(i))throw new be(`Extension Header Parameter "${i}" is not recognized`);if(o[i]===void 0)throw new e(`Extension Header Parameter "${i}" is missing`);if(s.get(i)&&n[i]===void 0)throw new e(`Extension Header Parameter "${i}" MUST be integrity protected`)}return new Set(n.crit)}const nd=(e,t)=>{if(t!==void 0&&(!Array.isArray(t)||t.some(r=>typeof r!="string")))throw new TypeError(`"${e}" option must be an array of strings`);if(t)return new Set(t)};function No(e,t){const r=`SHA-${e.slice(-3)}`;switch(e){case"HS256":case"HS384":case"HS512":return{hash:r,name:"HMAC"};case"PS256":case"PS384":case"PS512":return{hash:r,name:"RSA-PSS",saltLength:e.slice(-3)>>3};case"RS256":case"RS384":case"RS512":return{hash:r,name:"RSASSA-PKCS1-v1_5"};case"ES256":case"ES384":case"ES512":return{hash:r,name:"ECDSA",namedCurve:t.namedCurve};case"Ed25519":return{name:"Ed25519"};case"EdDSA":return{name:t.name};default:throw new be(`alg ${e} is not supported either by JOSE or your javascript runtime`)}}async function xo(e,t,r){if(r==="sign"&&(t=await hn.normalizePrivateKey(t,e)),r==="verify"&&(t=await hn.normalizePublicKey(t,e)),_o(t))return Ku(t,e,r),t;if(t instanceof Uint8Array){if(!e.startsWith("HS"))throw new TypeError(fn(t,...Nt));return Mt.subtle.importKey("raw",t,{hash:`SHA-${e.slice(-3)}`,name:"HMAC"},!1,[r])}throw new TypeError(fn(t,...Nt,"Uint8Array","JSON Web Key"))}const od=async(e,t,r,n)=>{const o=await xo(e,t,"verify");Uo(e,o);const s=No(e,o.algorithm);try{return await Mt.subtle.verify(s,o,r,n)}catch{return!1}};async function sd(e,t,r){if(!pe(e))throw new Q("Flattened JWS must be an object");if(e.protected===void 0&&e.header===void 0)throw new Q('Flattened JWS must have either of the "protected" or "header" members');if(e.protected!==void 0&&typeof e.protected!="string")throw new Q("JWS Protected Header incorrect type");if(e.payload===void 0)throw new Q("JWS Payload missing");if(typeof e.signature!="string")throw new Q("JWS Signature missing or incorrect type");if(e.header!==void 0&&!pe(e.header))throw new Q("JWS Unprotected Header incorrect type");let n={};if(e.protected)try{const y=Re(e.protected);n=JSON.parse(De.decode(y))}catch{throw new Q("JWS Protected Header is invalid")}if(!Ro(n,e.header))throw new Q("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");const o={...n,...e.header},s=Lo(Q,new Map([["b64",!0]]),r==null?void 0:r.crit,n,o);let i=!0;if(s.has("b64")&&(i=n.b64,typeof i!="boolean"))throw new Q('The "b64" (base64url-encode payload) Header Parameter must be a boolean');const{alg:a}=o;if(typeof a!="string"||!a)throw new Q('JWS "alg" (Algorithm) Header Parameter missing or invalid');const c=r&&nd("algorithms",r.algorithms);if(c&&!c.has(a))throw new vo('"alg" (Algorithm) Header Parameter value not allowed');if(i){if(typeof e.payload!="string")throw new Q("JWS Payload must be a string")}else if(typeof e.payload!="string"&&!(e.payload instanceof Uint8Array))throw new Q("JWS Payload must be a string or an Uint8Array instance");let u=!1;typeof t=="function"?(t=await t(n,e),u=!0,dr(a,t,"verify"),nt(t)&&(t=await Rr(t,a))):dr(a,t,"verify");const d=bo(_e.encode(e.protected??""),_e.encode("."),typeof e.payload=="string"?_e.encode(e.payload):e.payload);let l;try{l=Re(e.signature)}catch{throw new Q("Failed to base64url decode the signature")}if(!await od(a,t,l,d))throw new ko;let h;if(i)try{h=Re(e.payload)}catch{throw new Q("Failed to base64url decode the payload")}else typeof e.payload=="string"?h=_e.encode(e.payload):h=e.payload;const p={payload:h};return e.protected!==void 0&&(p.protectedHeader=n),e.header!==void 0&&(p.unprotectedHeader=e.header),u?{...p,key:t}:p}async function id(e,t,r){if(e instanceof Uint8Array&&(e=De.decode(e)),typeof e!="string")throw new Q("Compact JWS must be a string or Uint8Array");const{0:n,1:o,2:s,length:i}=e.split(".");if(i!==3)throw new Q("Invalid Compact JWS");const a=await sd({payload:o,protected:n,signature:s},t,r),c={payload:a.payload,protectedHeader:a.protectedHeader};return typeof t=="function"?{...c,key:a.key}:c}const Te=e=>Math.floor(e.getTime()/1e3),Co=60,zo=Co*60,Ur=zo*24,ad=Ur*7,cd=Ur*365.25,ud=/^(\+|\-)? ?(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i,at=e=>{const t=ud.exec(e);if(!t||t[4]&&t[1])throw new TypeError("Invalid time period format");const r=parseFloat(t[2]),n=t[3].toLowerCase();let o;switch(n){case"sec":case"secs":case"second":case"seconds":case"s":o=Math.round(r);break;case"minute":case"minutes":case"min":case"mins":case"m":o=Math.round(r*Co);break;case"hour":case"hours":case"hr":case"hrs":case"h":o=Math.round(r*zo);break;case"day":case"days":case"d":o=Math.round(r*Ur);break;case"week":case"weeks":case"w":o=Math.round(r*ad);break;default:o=Math.round(r*cd);break}return t[1]==="-"||t[4]==="ago"?-o:o},pn=e=>e.toLowerCase().replace(/^application\//,""),dd=(e,t)=>typeof e=="string"?t.includes(e):Array.isArray(e)?t.some(Set.prototype.has.bind(new Set(e))):!1,ld=(e,t,r={})=>{let n;try{n=JSON.parse(De.decode(t))}catch{}if(!pe(n))throw new fe("JWT Claims Set must be a top-level JSON object");const{typ:o}=r;if(o&&(typeof e.typ!="string"||pn(e.typ)!==pn(o)))throw new le('unexpected "typ" JWT header value',n,"typ","check_failed");const{requiredClaims:s=[],issuer:i,subject:a,audience:c,maxTokenAge:u}=r,d=[...s];u!==void 0&&d.push("iat"),c!==void 0&&d.push("aud"),a!==void 0&&d.push("sub"),i!==void 0&&d.push("iss");for(const p of new Set(d.reverse()))if(!(p in n))throw new le(`missing required "${p}" claim`,n,p,"missing");if(i&&!(Array.isArray(i)?i:[i]).includes(n.iss))throw new le('unexpected "iss" claim value',n,"iss","check_failed");if(a&&n.sub!==a)throw new le('unexpected "sub" claim value',n,"sub","check_failed");if(c&&!dd(n.aud,typeof c=="string"?[c]:c))throw new le('unexpected "aud" claim value',n,"aud","check_failed");let l;switch(typeof r.clockTolerance){case"string":l=at(r.clockTolerance);break;case"number":l=r.clockTolerance;break;case"undefined":l=0;break;default:throw new TypeError("Invalid clockTolerance option type")}const{currentDate:f}=r,h=Te(f||new Date);if((n.iat!==void 0||u)&&typeof n.iat!="number")throw new le('"iat" claim must be a number',n,"iat","invalid");if(n.nbf!==void 0){if(typeof n.nbf!="number")throw new le('"nbf" claim must be a number',n,"nbf","invalid");if(n.nbf>h+l)throw new le('"nbf" claim timestamp check failed',n,"nbf","check_failed")}if(n.exp!==void 0){if(typeof n.exp!="number")throw new le('"exp" claim must be a number',n,"exp","invalid");if(n.exp<=h-l)throw new Lt('"exp" claim timestamp check failed',n,"exp","check_failed")}if(u){const p=h-n.iat,y=typeof u=="number"?u:at(u);if(p-l>y)throw new Lt('"iat" claim timestamp check failed (too far in the past)',n,"iat","check_failed");if(p<0-l)throw new le('"iat" claim timestamp check failed (it should be in the past)',n,"iat","check_failed")}return n};async function Or(e,t,r){var i;const n=await id(e,t,r);if((i=n.protectedHeader.crit)!=null&&i.includes("b64")&&n.protectedHeader.b64===!1)throw new fe("JWTs MUST NOT use unencoded payload");const s={payload:ld(n.protectedHeader,n.payload,r),protectedHeader:n.protectedHeader};return typeof t=="function"?{...s,key:n.key}:s}const fd=async(e,t,r)=>{const n=await xo(e,t,"sign");Uo(e,n);const o=await Mt.subtle.sign(No(e,n.algorithm),n,r);return new Uint8Array(o)};class hd{constructor(t){if(!(t instanceof Uint8Array))throw new TypeError("payload must be an instance of Uint8Array");this._payload=t}setProtectedHeader(t){if(this._protectedHeader)throw new TypeError("setProtectedHeader can only be called once");return this._protectedHeader=t,this}setUnprotectedHeader(t){if(this._unprotectedHeader)throw new TypeError("setUnprotectedHeader can only be called once");return this._unprotectedHeader=t,this}async sign(t,r){if(!this._protectedHeader&&!this._unprotectedHeader)throw new Q("either setProtectedHeader or setUnprotectedHeader must be called before #sign()");if(!Ro(this._protectedHeader,this._unprotectedHeader))throw new Q("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");const n={...this._protectedHeader,...this._unprotectedHeader},o=Lo(Q,new Map([["b64",!0]]),r==null?void 0:r.crit,this._protectedHeader,n);let s=!0;if(o.has("b64")&&(s=this._protectedHeader.b64,typeof s!="boolean"))throw new Q('The "b64" (base64url-encode payload) Header Parameter must be a boolean');const{alg:i}=n;if(typeof i!="string"||!i)throw new Q('JWS "alg" (Algorithm) Header Parameter missing or invalid');dr(i,t,"sign");let a=this._payload;s&&(a=_e.encode(Kt(a)));let c;this._protectedHeader?c=_e.encode(Kt(JSON.stringify(this._protectedHeader))):c=_e.encode("");const u=bo(c,_e.encode("."),a),d=await fd(i,t,u),l={signature:Kt(d),payload:""};return s&&(l.payload=De.decode(a)),this._unprotectedHeader&&(l.header=this._unprotectedHeader),this._protectedHeader&&(l.protected=De.decode(c)),l}}class pd{constructor(t){this._flattened=new hd(t)}setProtectedHeader(t){return this._flattened.setProtectedHeader(t),this}async sign(t,r){const n=await this._flattened.sign(t,r);if(n.payload===void 0)throw new TypeError("use the flattened module for creating JWS with b64: false");return`${n.protected}.${n.payload}.${n.signature}`}}function Pe(e,t){if(!Number.isFinite(t))throw new TypeError(`Invalid ${e} input`);return t}class md{constructor(t={}){if(!pe(t))throw new TypeError("JWT Claims Set MUST be an object");this._payload=t}setIssuer(t){return this._payload={...this._payload,iss:t},this}setSubject(t){return this._payload={...this._payload,sub:t},this}setAudience(t){return this._payload={...this._payload,aud:t},this}setJti(t){return this._payload={...this._payload,jti:t},this}setNotBefore(t){return typeof t=="number"?this._payload={...this._payload,nbf:Pe("setNotBefore",t)}:t instanceof Date?this._payload={...this._payload,nbf:Pe("setNotBefore",Te(t))}:this._payload={...this._payload,nbf:Te(new Date)+at(t)},this}setExpirationTime(t){return typeof t=="number"?this._payload={...this._payload,exp:Pe("setExpirationTime",t)}:t instanceof Date?this._payload={...this._payload,exp:Pe("setExpirationTime",Te(t))}:this._payload={...this._payload,exp:Te(new Date)+at(t)},this}setIssuedAt(t){return typeof t>"u"?this._payload={...this._payload,iat:Te(new Date)}:t instanceof Date?this._payload={...this._payload,iat:Pe("setIssuedAt",Te(t))}:typeof t=="string"?this._payload={...this._payload,iat:Pe("setIssuedAt",Te(new Date)+at(t))}:this._payload={...this._payload,iat:Pe("setIssuedAt",t)},this}}class gd extends md{setProtectedHeader(t){return this._protectedHeader=t,this}async sign(t,r){var o;const n=new pd(_e.encode(JSON.stringify(this._payload)));if(n.setProtectedHeader(this._protectedHeader),Array.isArray((o=this._protectedHeader)==null?void 0:o.crit)&&this._protectedHeader.crit.includes("b64")&&this._protectedHeader.b64===!1)throw new fe("JWTs MUST NOT use unencoded payload");return n.sign(t,r)}}function wd(e){switch(typeof e=="string"&&e.slice(0,2)){case"RS":case"PS":return"RSA";case"ES":return"EC";case"Ed":return"OKP";default:throw new be('Unsupported "alg" value for a JSON Web Key Set')}}function yd(e){return e&&typeof e=="object"&&Array.isArray(e.keys)&&e.keys.every(_d)}function _d(e){return pe(e)}function Zo(e){return typeof structuredClone=="function"?structuredClone(e):JSON.parse(JSON.stringify(e))}class bd{constructor(t){if(this._cached=new WeakMap,!yd(t))throw new Sr("JSON Web Key Set malformed");this._jwks=Zo(t)}async getKey(t,r){const{alg:n,kid:o}={...t,...r==null?void 0:r.header},s=wd(n),i=this._jwks.keys.filter(u=>{let d=s===u.kty;if(d&&typeof o=="string"&&(d=o===u.kid),d&&typeof u.alg=="string"&&(d=n===u.alg),d&&typeof u.use=="string"&&(d=u.use==="sig"),d&&Array.isArray(u.key_ops)&&(d=u.key_ops.includes("verify")),d)switch(n){case"ES256":d=u.crv==="P-256";break;case"ES256K":d=u.crv==="secp256k1";break;case"ES384":d=u.crv==="P-384";break;case"ES512":d=u.crv==="P-521";break;case"Ed25519":d=u.crv==="Ed25519";break;case"EdDSA":d=u.crv==="Ed25519"||u.crv==="Ed448";break}return d}),{0:a,length:c}=i;if(c===0)throw new Ir;if(c!==1){const u=new Eo,{_cached:d}=this;throw u[Symbol.asyncIterator]=async function*(){for(const l of i)try{yield await mn(d,l,n)}catch{}},u}return mn(this._cached,a,n)}}async function mn(e,t,r){const n=e.get(t)||e.set(t,{}).get(t);if(n[r]===void 0){const o=await Rr({...t,ext:!0},r);if(o instanceof Uint8Array||o.type!=="public")throw new Sr("JSON Web Key Set members must be public keys");n[r]=o}return n[r]}function gn(e){const t=new bd(e),r=async(n,o)=>t.getKey(n,o);return Object.defineProperties(r,{jwks:{value:()=>Zo(t._jwks),enumerable:!0,configurable:!1,writable:!1}}),r}const vd=async(e,t,r)=>{let n,o,s=!1;typeof AbortController=="function"&&(n=new AbortController,o=setTimeout(()=>{s=!0,n.abort()},t));const i=await fetch(e.href,{signal:n?n.signal:void 0,redirect:"manual",headers:r.headers}).catch(a=>{throw s?new Ao:a});if(o!==void 0&&clearTimeout(o),i.status!==200)throw new oe("Expected 200 OK from the JSON Web Key Set HTTP response");try{return await i.json()}catch{throw new oe("Failed to parse the JSON Web Key Set HTTP response as JSON")}};function Ed(){return typeof WebSocketPair<"u"||typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"||typeof EdgeRuntime<"u"&&EdgeRuntime==="vercel"}let lr;var kt,Rn;(typeof navigator>"u"||!((Rn=(kt=navigator.userAgent)==null?void 0:kt.startsWith)!=null&&Rn.call(kt,"Mozilla/5.0 ")))&&(lr="jose/v5.10.0");const Ft=Symbol();function Ad(e,t){return!(typeof e!="object"||e===null||!("uat"in e)||typeof e.uat!="number"||Date.now()-e.uat>=t||!("jwks"in e)||!pe(e.jwks)||!Array.isArray(e.jwks.keys)||!Array.prototype.every.call(e.jwks.keys,pe))}class kd{constructor(t,r){if(!(t instanceof URL))throw new TypeError("url must be an instance of URL");this._url=new URL(t.href),this._options={agent:r==null?void 0:r.agent,headers:r==null?void 0:r.headers},this._timeoutDuration=typeof(r==null?void 0:r.timeoutDuration)=="number"?r==null?void 0:r.timeoutDuration:5e3,this._cooldownDuration=typeof(r==null?void 0:r.cooldownDuration)=="number"?r==null?void 0:r.cooldownDuration:3e4,this._cacheMaxAge=typeof(r==null?void 0:r.cacheMaxAge)=="number"?r==null?void 0:r.cacheMaxAge:6e5,(r==null?void 0:r[Ft])!==void 0&&(this._cache=r==null?void 0:r[Ft],Ad(r==null?void 0:r[Ft],this._cacheMaxAge)&&(this._jwksTimestamp=this._cache.uat,this._local=gn(this._cache.jwks)))}coolingDown(){return typeof this._jwksTimestamp=="number"?Date.now()<this._jwksTimestamp+this._cooldownDuration:!1}fresh(){return typeof this._jwksTimestamp=="number"?Date.now()<this._jwksTimestamp+this._cacheMaxAge:!1}async getKey(t,r){(!this._local||!this.fresh())&&await this.reload();try{return await this._local(t,r)}catch(n){if(n instanceof Ir&&this.coolingDown()===!1)return await this.reload(),this._local(t,r);throw n}}async reload(){this._pendingFetch&&Ed()&&(this._pendingFetch=void 0);const t=new Headers(this._options.headers);lr&&!t.has("User-Agent")&&(t.set("User-Agent",lr),this._options.headers=Object.fromEntries(t.entries())),this._pendingFetch||(this._pendingFetch=vd(this._url,this._timeoutDuration,this._options).then(r=>{this._local=gn(r),this._cache&&(this._cache.uat=Date.now(),this._cache.jwks=r),this._jwksTimestamp=Date.now(),this._pendingFetch=void 0}).catch(r=>{throw this._pendingFetch=void 0,r})),await this._pendingFetch}}function Td(e,t){const r=new kd(e,t),n=async(o,s)=>r.getKey(o,s);return Object.defineProperties(n,{coolingDown:{get:()=>r.coolingDown(),enumerable:!0,configurable:!1},fresh:{get:()=>r.fresh(),enumerable:!0,configurable:!1},reload:{value:()=>r.reload(),enumerable:!0,configurable:!1,writable:!1},reloading:{get:()=>!!r._pendingFetch,enumerable:!0,configurable:!1},jwks:{value:()=>{var o;return(o=r._local)==null?void 0:o.jwks()},enumerable:!0,configurable:!1,writable:!1}}),n}const Vo=Re;function Sd(e){let t;if(typeof e=="string"){const r=e.split(".");(r.length===3||r.length===5)&&([t]=r)}else if(typeof e=="object"&&e)if("protected"in e)t=e.protected;else throw new TypeError("Token does not contain a Protected Header");try{if(typeof t!="string"||!t)throw new Error;const r=JSON.parse(De.decode(Vo(t)));if(!pe(r))throw new Error;return r}catch{throw new TypeError("Invalid Token or Protected Header formatting")}}function pt(e){if(typeof e!="string")throw new fe("JWTs must use Compact JWS serialization, JWT must be a string");const{1:t,length:r}=e.split(".");if(r===5)throw new fe("Only JWTs using Compact JWS serialization can be decoded");if(r!==3)throw new fe("Invalid JWT");if(!t)throw new fe("JWTs must contain a payload");let n;try{n=Vo(t)}catch{throw new fe("Failed to base64url decode the payload")}let o;try{o=JSON.parse(De.decode(n))}catch{throw new fe("Failed to parse the decoded payload as JSON")}if(!pe(o))throw new fe("Invalid JWT Claims Set");return o}const Id="0123456789abcdef",wn={encode:e=>{if(typeof e=="string"&&(e=new TextEncoder().encode(e)),e.byteLength===0)return"";const t=new Uint8Array(e);let r="";for(const n of t)r+=n.toString(16).padStart(2,"0");return r},decode:e=>{if(!e)return"";if(typeof e=="string"){if(e.length%2!==0)throw new Error("Invalid hexadecimal string");if(!new RegExp(`^[${Id}]+$`).test(e))throw new Error("Invalid hexadecimal string");const t=new Uint8Array(e.length/2);for(let r=0;r<e.length;r+=2)t[r/2]=parseInt(e.slice(r,r+2),16);return new TextDecoder().decode(t)}return new TextDecoder().decode(e)}};function yn(e){switch(e){case"a-z":return"abcdefghijklmnopqrstuvwxyz";case"A-Z":return"ABCDEFGHIJKLMNOPQRSTUVWXYZ";case"0-9":return"0123456789";case"-_":return"-_";default:throw new Error(`Unsupported alphabet: ${e}`)}}function jo(...e){const t=e.map(yn).join("");if(t.length===0)throw new Error("No valid characters provided for random string generation.");const r=t.length;return(n,...o)=>{if(n<=0)throw new Error("Length must be a positive integer.");let s=t,i=r;o.length>0&&(s=o.map(yn).join(""),i=s.length);const a=Math.floor(256/i)*i,c=new Uint8Array(n*2),u=c.length;let d="",l=u,f;for(;d.length<n;)l>=u&&(us(c),l=0),f=c[l++],f<a&&(d+=s[f%i]);return d}}const fr=jo("a-z","0-9","A-Z","-_");async function Rd(e,t,r=3600){return await new gd(e).setProtectedHeader({alg:"HS256"}).setIssuedAt().setExpirationTime(Math.floor(Date.now()/1e3)+r).sign(new TextEncoder().encode(t))}const Ud=async({key:e,data:t})=>{const r=await Tr("SHA-256").digest(e),n=ho(t),o=yo(wo)(new Uint8Array(r));return yu(o.encrypt(n))},Od=async({key:e,data:t})=>{const r=await Tr("SHA-256").digest(e),n=_u(t),o=yo(wo)(new Uint8Array(r));return new TextDecoder().decode(o.decrypt(n))};var Dd=Object.defineProperty,Pd=Object.defineProperties,$d=Object.getOwnPropertyDescriptors,_n=Object.getOwnPropertySymbols,Ld=Object.prototype.hasOwnProperty,Nd=Object.prototype.propertyIsEnumerable,bn=(e,t,r)=>t in e?Dd(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,he=(e,t)=>{for(var r in t||(t={}))Ld.call(t,r)&&bn(e,r,t[r]);if(_n)for(var r of _n(t))Nd.call(t,r)&&bn(e,r,t[r]);return e},we=(e,t)=>Pd(e,$d(t)),xd=class extends Error{constructor(e,t,r){super(t||e.toString(),{cause:r}),this.status=e,this.statusText=t,this.error=r}},Cd=async(e,t)=>{var r,n,o,s,i,a;let c=t||{};const u={onRequest:[t==null?void 0:t.onRequest],onResponse:[t==null?void 0:t.onResponse],onSuccess:[t==null?void 0:t.onSuccess],onError:[t==null?void 0:t.onError],onRetry:[t==null?void 0:t.onRetry]};if(!t||!(t!=null&&t.plugins))return{url:e,options:c,hooks:u};for(const d of(t==null?void 0:t.plugins)||[]){if(d.init){const l=await((r=d.init)==null?void 0:r.call(d,e.toString(),t));c=l.options||c,e=l.url}u.onRequest.push((n=d.hooks)==null?void 0:n.onRequest),u.onResponse.push((o=d.hooks)==null?void 0:o.onResponse),u.onSuccess.push((s=d.hooks)==null?void 0:s.onSuccess),u.onError.push((i=d.hooks)==null?void 0:i.onError),u.onRetry.push((a=d.hooks)==null?void 0:a.onRetry)}return{url:e,options:c,hooks:u}},vn=class{constructor(e){this.options=e}shouldAttemptRetry(e,t){return this.options.shouldRetry?Promise.resolve(e<this.options.attempts&&this.options.shouldRetry(t)):Promise.resolve(e<this.options.attempts)}getDelay(){return this.options.delay}},zd=class{constructor(e){this.options=e}shouldAttemptRetry(e,t){return this.options.shouldRetry?Promise.resolve(e<this.options.attempts&&this.options.shouldRetry(t)):Promise.resolve(e<this.options.attempts)}getDelay(e){return Math.min(this.options.maxDelay,this.options.baseDelay*2**e)}};function Zd(e){if(typeof e=="number")return new vn({type:"linear",attempts:e,delay:1e3});switch(e.type){case"linear":return new vn(e);case"exponential":return new zd(e);default:throw new Error("Invalid retry strategy")}}var Vd=async e=>{const t={},r=async n=>typeof n=="function"?await n():n;if(e!=null&&e.auth){if(e.auth.type==="Bearer"){const n=await r(e.auth.token);if(!n)return t;t.authorization=`Bearer ${n}`}else if(e.auth.type==="Basic"){const n=r(e.auth.username),o=r(e.auth.password);if(!n||!o)return t;t.authorization=`Basic ${btoa(`${n}:${o}`)}`}else if(e.auth.type==="Custom"){const n=r(e.auth.value);if(!n)return t;t.authorization=`${r(e.auth.prefix)} ${n}`}}return t},jd=/^application\/(?:[\w!#$%&*.^`~-]*\+)?json(;.+)?$/i;function Bd(e){const t=e.headers.get("content-type"),r=new Set(["image/svg","application/xml","application/xhtml","application/html"]);if(!t)return"json";const n=t.split(";").shift()||"";return jd.test(n)?"json":r.has(n)||n.startsWith("text/")?"text":"blob"}function qd(e){try{return JSON.parse(e),!0}catch{return!1}}function Bo(e){if(e===void 0)return!1;const t=typeof e;return t==="string"||t==="number"||t==="boolean"||t===null?!0:t!=="object"?!1:Array.isArray(e)?!0:e.buffer?!1:e.constructor&&e.constructor.name==="Object"||typeof e.toJSON=="function"}function En(e){try{return JSON.parse(e)}catch{return e}}function An(e){return typeof e=="function"}function Md(e){if(e!=null&&e.customFetchImpl)return e.customFetchImpl;if(typeof globalThis<"u"&&An(globalThis.fetch))return globalThis.fetch;if(typeof window<"u"&&An(window.fetch))return window.fetch;throw new Error("No fetch implementation found")}async function Wd(e){const t=new Headers(e==null?void 0:e.headers),r=await Vd(e);for(const[n,o]of Object.entries(r||{}))t.set(n,o);if(!t.has("content-type")){const n=Hd(e==null?void 0:e.body);n&&t.set("content-type",n)}return t}function Hd(e){return Bo(e)?"application/json":null}function Kd(e){if(!(e!=null&&e.body))return null;const t=new Headers(e==null?void 0:e.headers);if(Bo(e.body)&&!t.has("content-type")){for(const[r,n]of Object.entries(e==null?void 0:e.body))n instanceof Date&&(e.body[r]=n.toISOString());return JSON.stringify(e.body)}return e.body}function Jd(e,t){var r;if(t!=null&&t.method)return t.method.toUpperCase();if(e.startsWith("@")){const n=(r=e.split("@")[1])==null?void 0:r.split("/")[0];return Mo.includes(n)?n.toUpperCase():t!=null&&t.body?"POST":"GET"}return t!=null&&t.body?"POST":"GET"}function Fd(e,t){let r;return!(e!=null&&e.signal)&&(e!=null&&e.timeout)&&(r=setTimeout(()=>t==null?void 0:t.abort(),e==null?void 0:e.timeout)),{abortTimeout:r,clearTimeout:()=>{r&&clearTimeout(r)}}}var Gd=class qo extends Error{constructor(t,r){super(r||JSON.stringify(t,null,2)),this.issues=t,Object.setPrototypeOf(this,qo.prototype)}};async function Rt(e,t){let r=await e["~standard"].validate(t);if(r.issues)throw new Gd(r.issues);return r.value}var Mo=["get","post","put","patch","delete"],Qd=e=>({id:"apply-schema",name:"Apply Schema",version:"1.0.0",async init(t,r){var n,o,s,i;const a=((o=(n=e.plugins)==null?void 0:n.find(c=>{var u;return(u=c.schema)!=null&&u.config?t.startsWith(c.schema.config.baseURL||"")||t.startsWith(c.schema.config.prefix||""):!1}))==null?void 0:o.schema)||e.schema;if(a){let c=t;(s=a.config)!=null&&s.prefix&&c.startsWith(a.config.prefix)&&(c=c.replace(a.config.prefix,""),a.config.baseURL&&(t=t.replace(a.config.prefix,a.config.baseURL))),(i=a.config)!=null&&i.baseURL&&c.startsWith(a.config.baseURL)&&(c=c.replace(a.config.baseURL,""));const u=a.schema[c];if(u){let d=we(he({},r),{method:u.method,output:u.output});return r!=null&&r.disableValidation||(d=we(he({},d),{body:u.input?await Rt(u.input,r==null?void 0:r.body):r==null?void 0:r.body,params:u.params?await Rt(u.params,r==null?void 0:r.params):r==null?void 0:r.params,query:u.query?await Rt(u.query,r==null?void 0:r.query):r==null?void 0:r.query})),{url:t,options:d}}}return{url:t,options:r}}}),Yd=e=>{async function t(r,n){const o=we(he(he({},e),n),{plugins:[...(e==null?void 0:e.plugins)||[],Qd(e||{})]});if(e!=null&&e.catchAllError)try{return await q(r,o)}catch(s){return{data:null,error:{status:500,statusText:"Fetch Error",message:"Fetch related error. Captured by catchAllError option. See error property for more details.",error:s}}}return await q(r,o)}return t};function Xd(e,t){let{baseURL:r,params:n,query:o}=t||{query:{},params:{},baseURL:""},s=e.startsWith("http")?e.split("/").slice(0,3).join("/"):r||"";if(e.startsWith("@")){const l=e.toString().split("@")[1].split("/")[0];Mo.includes(l)&&(e=e.replace(`@${l}/`,"/"))}s.endsWith("/")||(s+="/");let[i,a]=e.replace(s,"").split("?");const c=new URLSearchParams(a);for(const[l,f]of Object.entries(o||{}))f!=null&&c.set(l,String(f));if(n)if(Array.isArray(n)){const l=i.split("/").filter(f=>f.startsWith(":"));for(const[f,h]of l.entries()){const p=n[f];i=i.replace(h,p)}}else for(const[l,f]of Object.entries(n))i=i.replace(`:${l}`,String(f));i=i.split("/").map(encodeURIComponent).join("/"),i.startsWith("/")&&(i=i.slice(1));let u=c.toString();return u=u.length>0?`?${u}`.replace(/\+/g,"%20"):"",s.startsWith("http")?new URL(`${i}${u}`,s):`${s}${i}${u}`}var q=async(e,t)=>{var r,n,o,s,i,a,c,u;const{hooks:d,url:l,options:f}=await Cd(e,t),h=Md(f),p=new AbortController,y=(r=f.signal)!=null?r:p.signal,g=Xd(l,f),A=Kd(f),v=await Wd(f),E=Jd(l,f);let _=we(he({},f),{url:g,headers:v,body:A,method:E,signal:y});for(const P of d.onRequest)if(P){const O=await P(_);O instanceof Object&&(_=O)}("pipeTo"in _&&typeof _.pipeTo=="function"||typeof((n=t==null?void 0:t.body)==null?void 0:n.pipe)=="function")&&("duplex"in _||(_.duplex="half"));const{clearTimeout:U}=Fd(f,p);let k=await h(_.url,_);U();const V={response:k,request:_};for(const P of d.onResponse)if(P){const O=await P(we(he({},V),{response:(o=t==null?void 0:t.hookOptions)!=null&&o.cloneResponse?k.clone():k}));O instanceof Response?k=O:O instanceof Object&&(k=O.response)}if(k.ok){if(!(_.method!=="HEAD"))return{data:"",error:null};const O=Bd(k),L={data:"",response:k,request:_};if(O==="json"||O==="text"){const N=await k.text(),Z=await((s=_.jsonParser)!=null?s:En)(N);L.data=Z}else L.data=await k[O]();_!=null&&_.output&&_.output&&!_.disableValidation&&(L.data=await Rt(_.output,L.data));for(const N of d.onSuccess)N&&await N(we(he({},L),{response:(i=t==null?void 0:t.hookOptions)!=null&&i.cloneResponse?k.clone():k}));return t!=null&&t.throw?L.data:{data:L.data,error:null}}const j=(a=t==null?void 0:t.jsonParser)!=null?a:En,C=await k.text(),T=qd(C),z=T?await j(C):null,B={response:k,responseText:C,request:_,error:we(he({},z),{status:k.status,statusText:k.statusText})};for(const P of d.onError)P&&await P(we(he({},B),{response:(c=t==null?void 0:t.hookOptions)!=null&&c.cloneResponse?k.clone():k}));if(t!=null&&t.retry){const P=Zd(t.retry),O=(u=t.retryAttempt)!=null?u:0;if(await P.shouldAttemptRetry(O,k)){for(const N of d.onRetry)N&&await N(V);const L=P.getDelay(O);return await new Promise(N=>setTimeout(N,L)),await q(e,we(he({},t),{retryAttempt:O+1}))}}if(t!=null&&t.throw)throw new xd(k.status,k.statusText,T?z:C);return{data:null,error:we(he({},z),{status:k.status,statusText:k.statusText})}},el={},tl={};const Ut=Object.create(null),st=e=>{var t;return el||((t=globalThis.Deno)==null?void 0:t.env.toObject())||globalThis.__env__||(e?Ut:globalThis)},Se=new Proxy(Ut,{get(e,t){return st()[t]??Ut[t]},has(e,t){const r=st();return t in r||t in Ut},set(e,t,r){const n=st(!0);return n[t]=r,!0},deleteProperty(e,t){if(!t)return!1;const r=st(!0);return delete r[t],!0},ownKeys(){const e=st(!0);return Object.keys(e)}});function rl(e){return e?e!=="false":!1}const hr=typeof process<"u"&&tl&&"production"||"",nl=hr==="dev"||hr==="development";hr==="test"||rl(Se.TEST);class Ct extends Error{constructor(t,r){super(t),this.name="BetterAuthError",this.message=t,this.cause=r,this.stack=""}}function ol(e){try{return new URL(e).pathname!=="/"}catch{throw new Ct(`Invalid base URL: ${e}. Please provide a valid base URL.`)}}function Gt(e,t="/api/auth"){return ol(e)?e:(t=t.startsWith("/")?t:`/${t}`,`${e.replace(/\/+$/,"")}${t}`)}function sl(e,t,r){if(e)return Gt(e,t);const n=Se.BETTER_AUTH_URL||Se.NEXT_PUBLIC_BETTER_AUTH_URL||Se.PUBLIC_BETTER_AUTH_URL||Se.NUXT_PUBLIC_BETTER_AUTH_URL||Se.NUXT_PUBLIC_AUTH_URL||(Se.BASE_URL!=="/"?Se.BASE_URL:void 0);if(n)return Gt(n,t);if(typeof window<"u"&&window.location)return Gt(window.location.origin,t)}function zt(e){try{return new URL(e).origin}catch{return null}}function Wo(e){try{return new URL(e).protocol}catch{return null}}function Ho(e){try{return new URL(e).host}catch{return e}}const Ko=(e="SHA-256",t="none")=>{const r={importKey:async(n,o)=>Le.importKey("raw",typeof n=="string"?new TextEncoder().encode(n):n,{name:"HMAC",hash:{name:e}},!1,[o]),sign:async(n,o)=>{typeof n=="string"&&(n=await r.importKey(n,"sign"));const s=await Le.sign("HMAC",n,typeof o=="string"?new TextEncoder().encode(o):o);return t==="hex"?wn.encode(s):t==="base64"||t==="base64url"||t==="base64urlnopad"?kr.encode(s,{padding:t!=="base64urlnopad"}):s},verify:async(n,o,s)=>(typeof n=="string"&&(n=await r.importKey(n,"verify")),t==="hex"&&(s=wn.decode(s)),(t==="base64"||t==="base64url"||t==="base64urlnopad")&&(s=await rt.decode(s)),Le.verify("HMAC",n,typeof s=="string"?new TextEncoder().encode(s):s,typeof o=="string"?new TextEncoder().encode(o):o))};return r};function Jo(e){function t(r,n){if(typeof n=="string"&&/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(?:\.\d+)?Z$/.test(n)){const s=new Date(n);if(!isNaN(s.getTime()))return s}return n}try{return JSON.parse(e,t)}catch{return null}}const Qt=new Map,il=new TextEncoder,al={decode:(e,t="utf-8")=>(Qt.has(t)||Qt.set(t,new TextDecoder(t)),Qt.get(t).decode(e)),encode:il.encode};async function Fo(e,t){var n,o;if((o=(n=e.context.options.session)==null?void 0:n.cookieCache)==null?void 0:o.enabled){const i={session:Object.entries(t.session).reduce((u,[d,l])=>{var h,p;const f=(p=(h=e.context.options.session)==null?void 0:h.additionalFields)==null?void 0:p[d];return(!f||f.returned!==!1)&&(u[d]=l),u},{}),user:t.user},a=Qe(e.context.authCookies.sessionData.options.maxAge||60,"sec").getTime(),c=kr.encode(JSON.stringify({session:i,expiresAt:a,signature:await Ko("SHA-256","base64urlnopad").sign(e.context.secret,JSON.stringify({...i,expiresAt:a}))}),{padding:!1});if(c.length>4093)throw new Ct("Session data is too large to store in the cookie. Please disable session cookie caching or reduce the size of the session data");e.setCookie(e.context.authCookies.sessionData.name,c,e.context.authCookies.sessionData.options)}}async function Ee(e,t,r,n){var a;const o=await e.getSignedCookie(e.context.authCookies.dontRememberToken.name,e.context.secret);r=r!==void 0?r:!!o;const s=e.context.authCookies.sessionToken.options,i=r?void 0:e.context.sessionConfig.expiresIn;await e.setSignedCookie(e.context.authCookies.sessionToken.name,t.session.token,e.context.secret,{...s,maxAge:i,...n}),r&&await e.setSignedCookie(e.context.authCookies.dontRememberToken.name,"true",e.context.secret,e.context.authCookies.dontRememberToken.options),await Fo(e,t),e.context.setNewSession(t),e.context.options.secondaryStorage&&await((a=e.context.secondaryStorage)==null?void 0:a.set(t.session.token,JSON.stringify({user:t.user,session:t.session}),Math.floor((new Date(t.session.expiresAt).getTime()-Date.now())/1e3)))}function Xe(e,t){e.setCookie(e.context.authCookies.sessionToken.name,"",{...e.context.authCookies.sessionToken.options,maxAge:0}),e.setCookie(e.context.authCookies.sessionData.name,"",{...e.context.authCookies.sessionData.options,maxAge:0}),e.setCookie(e.context.authCookies.dontRememberToken.name,"",{...e.context.authCookies.dontRememberToken.options,maxAge:0})}const ze=e=>jo("a-z","A-Z","0-9")(e||32),pr=["info","success","warn","error","debug"];function cl(e,t){return pr.indexOf(t)<=pr.indexOf(e)}const ye={reset:"\x1B[0m",bright:"\x1B[1m",dim:"\x1B[2m",fg:{red:"\x1B[31m",green:"\x1B[32m",yellow:"\x1B[33m",blue:"\x1B[34m",magenta:"\x1B[35m"}},ul={info:ye.fg.blue,success:ye.fg.green,warn:ye.fg.yellow,error:ye.fg.red,debug:ye.fg.magenta},dl=(e,t)=>{const r=new Date().toISOString();return`${ye.dim}${r}${ye.reset} ${ul[e]}${e.toUpperCase()}${ye.reset} ${ye.bright}[Better Auth]:${ye.reset} ${t}`},ll=e=>{const t="error",r=(n,o,s=[])=>{if(!cl(t,n))return;const i=dl(n,o);{n==="error"?console.error(i,...s):n==="warn"?console.warn(i,...s):console.log(i,...s);return}};return Object.fromEntries(pr.map(n=>[n,(...[o,...s])=>r(n,o,s)]))},$e=ll();x({id:w(),providerId:w(),accountId:w(),userId:qt(),accessToken:w().nullish(),refreshToken:w().nullish(),idToken:w().nullish(),accessTokenExpiresAt:re().nullish(),refreshTokenExpiresAt:re().nullish(),scope:w().nullish(),password:w().nullish(),createdAt:re().default(()=>new Date),updatedAt:re().default(()=>new Date)});x({id:w(),email:w().transform(e=>e.toLowerCase()),emailVerified:Ne().default(!1),name:w(),image:w().nullish(),createdAt:re().default(()=>new Date),updatedAt:re().default(()=>new Date)});x({id:w(),userId:qt(),expiresAt:re(),createdAt:re().default(()=>new Date),updatedAt:re().default(()=>new Date),token:w(),ipAddress:w().nullish(),userAgent:w().nullish()});x({id:w(),value:w(),createdAt:re().default(()=>new Date),updatedAt:re().default(()=>new Date),expiresAt:re(),identifier:w()});const Go=Ge(async()=>({})),Ze=Ge.create({use:[Go,Ge(async()=>({}))]}),M=er.create({use:[Go]});function mr(e){return e==="-"||e==="^"||e==="$"||e==="+"||e==="."||e==="("||e===")"||e==="|"||e==="["||e==="]"||e==="{"||e==="}"||e==="*"||e==="?"||e==="\\"?`\\${e}`:e}function fl(e){let t="";for(let r=0;r<e.length;r++)t+=mr(e[r]);return t}function Qo(e,t=!0){if(Array.isArray(e))return`(?:${e.map(d=>`^${Qo(d,t)}$`).join("|")})`;let r="",n="",o=".";t===!0?(r="/",n="[/\\\\]",o="[^/\\\\]"):t&&(r=t,n=fl(r),n.length>1?(n=`(?:${n})`,o=`((?!${n}).)`):o=`[^${n}]`);let s=t?`${n}+?`:"",i=t?`${n}*?`:"",a=t?e.split(r):[e],c="";for(let u=0;u<a.length;u++){let d=a[u],l=a[u+1],f="";if(!(!d&&u>0)){if(t&&(u===a.length-1?f=i:l!=="**"?f=s:f=""),t&&d==="**"){f&&(c+=u===0?"":f,c+=`(?:${o}*?${f})*?`);continue}for(let h=0;h<d.length;h++){let p=d[h];p==="\\"?h<d.length-1&&(c+=mr(d[h+1]),h++):p==="?"?c+=o:p==="*"?c+=`${o}*?`:c+=mr(p)}c+=f}}return c}function hl(e,t){if(typeof t!="string")throw new TypeError(`Sample must be a string, but ${typeof t} given`);return e.test(t)}function Zt(e,t){if(typeof e!="string"&&!Array.isArray(e))throw new TypeError(`The first argument must be a single pattern string or an array of patterns, but ${typeof e} given`);if((typeof t=="string"||typeof t=="boolean")&&(t={separator:t}),arguments.length===2&&!(typeof t>"u"||typeof t=="object"&&t!==null&&!Array.isArray(t)))throw new TypeError(`The second argument must be an options object or a string/boolean separator, but ${typeof t} given`);if(t=t||{},t.separator==="\\")throw new Error("\\ is not a valid separator because it is used for escaping. Try setting the separator to `true` instead");let r=Qo(e,t.separator),n=new RegExp(`^${r}$`,t.flags),o=hl.bind(null,n);return o.options=t,o.pattern=e,o.regexp=n,o}Ze(async e=>{var h,p,y,g,A,v,E;if(((h=e.request)==null?void 0:h.method)!=="POST"||!e.request)return;const{body:t,query:r,context:n}=e,o=((p=e.headers)==null?void 0:p.get("origin"))||((y=e.headers)==null?void 0:y.get("referer"))||"",s=(t==null?void 0:t.callbackURL)||(r==null?void 0:r.callbackURL),i=t==null?void 0:t.redirectTo,a=t==null?void 0:t.errorCallbackURL,c=t==null?void 0:t.newUserCallbackURL,u=Array.isArray(n.options.trustedOrigins)?n.trustedOrigins:[...n.trustedOrigins,...await((A=(g=n.options).trustedOrigins)==null?void 0:A.call(g,e.request))||[]],d=(v=e.headers)==null?void 0:v.has("cookie"),l=(_,U)=>{if(_.startsWith("/"))return!1;if(U.includes("*"))return U.includes("://")?Zt(U)(zt(_)||_):Zt(U)(Ho(_));const k=Wo(_);return k==="http:"||k==="https:"||!k?U===zt(_):_.startsWith(U)},f=(_,U)=>{if(!_)return;if(!u.some(V=>l(_,V)||(_==null?void 0:_.startsWith("/"))&&U!=="origin"&&/^\/(?!\/|\\|%2f|%5c)[\w\-.\+/@]*(?:\?[\w\-.\+/=&%@]*)?$/.test(_)))throw e.context.logger.error(`Invalid ${U}: ${_}`),e.context.logger.info(`If it's a valid URL, please add ${_} to trustedOrigins in your auth config
`,`Current list of trustedOrigins: ${u}`),new b("FORBIDDEN",{message:`Invalid ${U}`})};d&&!((E=e.context.options.advanced)!=null&&E.disableCSRFCheck)&&f(o,"origin"),s&&f(s,"callbackURL"),i&&f(i,"redirectURL"),a&&f(a,"errorCallbackURL"),c&&f(c,"newUserCallbackURL")});const Dr=e=>Ze(async t=>{var c,u;if(!t.request)return;const{context:r}=t,n=e(t),o=Array.isArray(r.options.trustedOrigins)?r.trustedOrigins:[...r.trustedOrigins,...await((u=(c=r.options).trustedOrigins)==null?void 0:u.call(c,t.request))||[]],s=(d,l)=>{if(d.startsWith("/"))return!1;if(l.includes("*"))return l.includes("://")?Zt(l)(zt(d)||d):Zt(l)(Ho(d));const f=Wo(d);return f==="http:"||f==="https:"||!f?l===zt(d):d.startsWith(l)},i=(d,l)=>{if(!d)return;if(!o.some(h=>s(d,h)||(d==null?void 0:d.startsWith("/"))&&l!=="origin"&&/^\/(?!\/|\\|%2f|%5c)[\w\-.\+/@]*(?:\?[\w\-.\+/=&%@]*)?$/.test(d)))throw t.context.logger.error(`Invalid ${l}: ${d}`),t.context.logger.info(`If it's a valid URL, please add ${d} to trustedOrigins in your auth config
`,`Current list of trustedOrigins: ${o}`),new b("FORBIDDEN",{message:`Invalid ${l}`})},a=Array.isArray(n)?n:[n];for(const d of a)i(d,"callbackURL")}),$={FAILED_TO_CREATE_SESSION:"Failed to create session",FAILED_TO_GET_SESSION:"Failed to get session",INVALID_PASSWORD:"Invalid password",INVALID_EMAIL:"Invalid email",INVALID_EMAIL_OR_PASSWORD:"Invalid email or password",PROVIDER_NOT_FOUND:"Provider not found",INVALID_TOKEN:"invalid token",ID_TOKEN_NOT_SUPPORTED:"id_token not supported",FAILED_TO_GET_USER_INFO:"Failed to get user info",USER_EMAIL_NOT_FOUND:"User email not found",EMAIL_NOT_VERIFIED:"Email not verified",PASSWORD_TOO_SHORT:"Password too short",PASSWORD_TOO_LONG:"Password too long",USER_ALREADY_EXISTS:"User already exists",CREDENTIAL_ACCOUNT_NOT_FOUND:"Credential account not found",SESSION_EXPIRED:"Session expired. Re-authenticate to perform this action.",FAILED_TO_UNLINK_LAST_ACCOUNT:"You can't unlink your last account",ACCOUNT_NOT_FOUND:"Account not found"},pl=()=>M("/get-session",{method:"GET",query:Pt(x({disableCookieCache:nn().meta({description:"Disable cookie cache and fetch session from database"}).optional(),disableRefresh:nn().meta({description:"Disable session refresh. Useful for checking session status, without updating the session"}).optional()})),requireHeaders:!0,metadata:{openapi:{description:"Get the current session",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{session:{$ref:"#/components/schemas/Session"},user:{$ref:"#/components/schemas/User"}},required:["session","user"]}}}}}}}},async e=>{var t,r,n,o,s,i;try{const a=await e.getSignedCookie(e.context.authCookies.sessionToken.name,e.context.secret);if(!a)return null;const c=e.getCookie(e.context.authCookies.sessionData.name),u=c?Jo(al.decode(rt.decode(c))):null;if(u&&!await Ko("SHA-256","base64urlnopad").verify(e.context.secret,JSON.stringify({...u.session,expiresAt:u.expiresAt}),u.signature)){const A=e.context.authCookies.sessionData.name;return e.setCookie(A,"",{maxAge:0}),e.json(null)}const d=await e.getSignedCookie(e.context.authCookies.dontRememberToken.name,e.context.secret);if(u!=null&&u.session&&((r=(t=e.context.options.session)==null?void 0:t.cookieCache)!=null&&r.enabled)&&!((n=e.query)!=null&&n.disableCookieCache)){const g=u.session;if(u.expiresAt<Date.now()||g.session.expiresAt<new Date){const v=e.context.authCookies.sessionData.name;e.setCookie(v,"",{maxAge:0})}else return e.context.session=g,e.json(g)}const l=await e.context.internalAdapter.findSession(a);if(e.context.session=l,!l||l.session.expiresAt<new Date)return Xe(e),l&&await e.context.internalAdapter.deleteSession(l.session.token),e.json(null);if(d||(o=e.query)!=null&&o.disableRefresh)return e.json(l);const f=e.context.sessionConfig.expiresIn,h=e.context.sessionConfig.updateAge;if(l.session.expiresAt.valueOf()-f*1e3+h*1e3<=Date.now()&&(!((s=e.query)!=null&&s.disableRefresh)||!((i=e.context.options.session)!=null&&i.disableSessionRefresh))){const g=await e.context.internalAdapter.updateSession(l.session.token,{expiresAt:Qe(e.context.sessionConfig.expiresIn,"sec"),updatedAt:new Date});if(!g)return Xe(e),e.json(null,{status:401});const A=(g.expiresAt.valueOf()-Date.now())/1e3;return await Ee(e,{session:g,user:l.user},!1,{maxAge:A}),e.json({session:g,user:l.user})}return await Fo(e,l),e.json(l)}catch(a){throw e.context.logger.error("INTERNAL_SERVER_ERROR",a),new b("INTERNAL_SERVER_ERROR",{message:$.FAILED_TO_GET_SESSION})}}),Ae=async(e,t)=>{if(e.context.session)return e.context.session;const r=await pl()({...e,asResponse:!1,headers:e.headers,returnHeaders:!1,query:{...t,...e.query}}).catch(n=>null);return e.context.session=r,r},me=Ze(async e=>{const t=await Ae(e);if(!(t!=null&&t.session))throw new b("UNAUTHORIZED");return{session:t}});Ze(async e=>{const t=await Ae(e);if(!(t!=null&&t.session)&&(e.request||e.headers))throw new b("UNAUTHORIZED");return{session:t}});const ml=Ze(async e=>{var i;const t=await Ae(e);if(!(t!=null&&t.session))throw new b("UNAUTHORIZED");if(e.context.sessionConfig.freshAge===0)return{session:t};const r=e.context.sessionConfig.freshAge,n=((i=t.session.updatedAt)==null?void 0:i.valueOf())||t.session.createdAt.valueOf();if(!(Date.now()-n<r*1e3))throw new b("FORBIDDEN",{message:"Session is not fresh"});return{session:t}});M("/revoke-session",{method:"POST",body:x({token:w().meta({description:"The token to revoke"})}),use:[me],requireHeaders:!0,metadata:{openapi:{description:"Revoke a single session",requestBody:{content:{"application/json":{schema:{type:"object",properties:{token:{type:"string",description:"The token to revoke"}},required:["token"]}}}},responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean",description:"Indicates if the session was revoked successfully"}},required:["status"]}}}}}}}},async e=>{const t=e.body.token,r=await e.context.internalAdapter.findSession(t);if(!r)throw new b("BAD_REQUEST",{message:"Session not found"});if(r.session.userId!==e.context.session.user.id)throw new b("UNAUTHORIZED");try{await e.context.internalAdapter.deleteSession(t)}catch(n){throw e.context.logger.error(n&&typeof n=="object"&&"name"in n?n.name:"",n),new b("INTERNAL_SERVER_ERROR")}return e.json({status:!0})});M("/revoke-sessions",{method:"POST",use:[me],requireHeaders:!0,metadata:{openapi:{description:"Revoke all sessions for the user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean",description:"Indicates if all sessions were revoked successfully"}},required:["status"]}}}}}}}},async e=>{try{await e.context.internalAdapter.deleteSessions(e.context.session.user.id)}catch(t){throw e.context.logger.error(t&&typeof t=="object"&&"name"in t?t.name:"",t),new b("INTERNAL_SERVER_ERROR")}return e.json({status:!0})});M("/revoke-other-sessions",{method:"POST",requireHeaders:!0,use:[me],metadata:{openapi:{description:"Revoke all other sessions for the user except the current one",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean",description:"Indicates if all other sessions were revoked successfully"}},required:["status"]}}}}}}}},async e=>{const t=e.context.session;if(!t.user)throw new b("UNAUTHORIZED");const o=(await e.context.internalAdapter.listSessions(t.user.id)).filter(s=>s.expiresAt>new Date).filter(s=>s.token!==e.context.session.session.token);return await Promise.all(o.map(s=>e.context.internalAdapter.deleteSession(s.token))),e.json({status:!0})});async function et(e,t,r,n=3600){return await Rd({email:t.toLowerCase(),updateTo:r},e,n)}async function kn(e,t){var o,s;if(!((o=e.context.options.emailVerification)!=null&&o.sendVerificationEmail))throw e.context.logger.error("Verification email isn't enabled."),new b("BAD_REQUEST",{message:"Verification email isn't enabled"});const r=await et(e.context.secret,t.email,void 0,(s=e.context.options.emailVerification)==null?void 0:s.expiresIn),n=`${e.context.baseURL}/verify-email?token=${r}&callbackURL=${e.body.callbackURL||"/"}`;await e.context.options.emailVerification.sendVerificationEmail({user:t,url:n,token:r},e.request)}M("/send-verification-email",{method:"POST",body:x({email:Ar().meta({description:"The email to send the verification email to"}),callbackURL:w().meta({description:"The URL to use for email verification callback"}).optional()}),metadata:{openapi:{description:"Send a verification email to the user",requestBody:{content:{"application/json":{schema:{type:"object",properties:{email:{type:"string",description:"The email to send the verification email to",example:"user@example.com"},callbackURL:{type:"string",description:"The URL to use for email verification callback",example:"https://example.com/callback",nullable:!0}},required:["email"]}}}},responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean",description:"Indicates if the email was sent successfully",example:!0}}}}}},400:{description:"Bad Request",content:{"application/json":{schema:{type:"object",properties:{message:{type:"string",description:"Error message",example:"Verification email isn't enabled"}}}}}}}}}},async e=>{var n;if(!((n=e.context.options.emailVerification)!=null&&n.sendVerificationEmail))throw e.context.logger.error("Verification email isn't enabled."),new b("BAD_REQUEST",{message:"Verification email isn't enabled"});const{email:t}=e.body,r=await Ae(e);if(!r){const o=await e.context.internalAdapter.findUserByEmail(t);return o?(await kn(e,o.user),e.json({status:!0})):e.json({status:!0})}if(r!=null&&r.user.emailVerified)throw new b("BAD_REQUEST",{message:"You can only send a verification email to an unverified email"});if((r==null?void 0:r.user.email)!==t)throw new b("BAD_REQUEST",{message:"You can only send a verification email to your own email"});return await kn(e,r.user),e.json({status:!0})});M("/verify-email",{method:"GET",query:x({token:w().meta({description:"The token to verify the email"}),callbackURL:w().meta({description:"The URL to redirect to after email verification"}).optional()}),use:[Dr(e=>e.query.callbackURL)],metadata:{openapi:{description:"Verify the email of the user",parameters:[{name:"token",in:"query",description:"The token to verify the email",required:!0,schema:{type:"string"}},{name:"callbackURL",in:"query",description:"The URL to redirect to after email verification",required:!1,schema:{type:"string"}}],responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{user:{type:"object",properties:{id:{type:"string",description:"User ID"},email:{type:"string",description:"User email"},name:{type:"string",description:"User name"},image:{type:"string",description:"User image URL"},emailVerified:{type:"boolean",description:"Indicates if the user email is verified"},createdAt:{type:"string",description:"User creation date"},updatedAt:{type:"string",description:"User update date"}},required:["id","email","name","image","emailVerified","createdAt","updatedAt"]},status:{type:"boolean",description:"Indicates if the email was verified successfully"}},required:["user","status"]}}}}}}}},async e=>{var c,u,d,l,f;function t(h){throw e.query.callbackURL?e.query.callbackURL.includes("?")?e.redirect(`${e.query.callbackURL}&error=${h}`):e.redirect(`${e.query.callbackURL}?error=${h}`):new b("UNAUTHORIZED",{message:h})}const{token:r}=e.query;let n;try{n=await Or(r,new TextEncoder().encode(e.context.secret),{algorithms:["HS256"]})}catch(h){return h instanceof Lt?t("token_expired"):t("invalid_token")}const s=x({email:w().email(),updateTo:w().optional()}).parse(n.payload),i=await e.context.internalAdapter.findUserByEmail(s.email);if(!i)return t("user_not_found");if(s.updateTo){const h=await Ae(e);if(!h){if(e.query.callbackURL)throw e.redirect(`${e.query.callbackURL}?error=unauthorized`);return t("unauthorized")}if(h.user.email!==s.email){if(e.query.callbackURL)throw e.redirect(`${e.query.callbackURL}?error=unauthorized`);return t("unauthorized")}const p=await e.context.internalAdapter.updateUserByEmail(s.email,{email:s.updateTo,emailVerified:!1},e),y=await et(e.context.secret,s.updateTo);if(await((u=(c=e.context.options.emailVerification)==null?void 0:c.sendVerificationEmail)==null?void 0:u.call(c,{user:p,url:`${e.context.baseURL}/verify-email?token=${y}&callbackURL=${e.query.callbackURL||"/"}`,token:y},e.request)),await Ee(e,{session:h.session,user:{...h.user,email:s.updateTo,emailVerified:!1}}),e.query.callbackURL)throw e.redirect(e.query.callbackURL);return e.json({status:!0,user:{id:p.id,email:p.email,name:p.name,image:p.image,emailVerified:p.emailVerified,createdAt:p.createdAt,updatedAt:p.updatedAt}})}(d=e.context.options.emailVerification)!=null&&d.onEmailVerification&&await e.context.options.emailVerification.onEmailVerification(i.user,e.request);const a=await e.context.internalAdapter.updateUserByEmail(s.email,{emailVerified:!0},e);if((l=e.context.options.emailVerification)!=null&&l.afterEmailVerification&&await e.context.options.emailVerification.afterEmailVerification(a,e.request),(f=e.context.options.emailVerification)!=null&&f.autoSignInAfterVerification){const h=await Ae(e);if(!h||h.user.email!==s.email){const p=await e.context.internalAdapter.createSession(i.user.id,e);if(!p)throw new b("INTERNAL_SERVER_ERROR",{message:"Failed to create session"});await Ee(e,{session:p,user:{...i.user,emailVerified:!0}})}else await Ee(e,{session:h.session,user:{...h.user,emailVerified:!0}})}if(e.query.callbackURL)throw e.redirect(e.query.callbackURL);return e.json({status:!0,user:null})});const Pr={isAction:!1};async function Yo(e,t){var c,u,d,l;const r=((c=e.body)==null?void 0:c.callbackURL)||e.context.options.baseURL;if(!r)throw new b("BAD_REQUEST",{message:"callbackURL is required"});const n=fr(128),o=fr(32),s=JSON.stringify({callbackURL:r,codeVerifier:n,errorURL:(u=e.body)==null?void 0:u.errorCallbackURL,newUserURL:(d=e.body)==null?void 0:d.newUserCallbackURL,link:t,expiresAt:Date.now()+600*1e3,requestSignUp:(l=e.body)==null?void 0:l.requestSignUp}),i=new Date;i.setMinutes(i.getMinutes()+10);const a=await e.context.internalAdapter.createVerificationValue({value:s,identifier:o,expiresAt:i},e);if(!a)throw e.context.logger.error("Unable to create verification. Make sure the database adapter is properly working and there is a verification table in the database"),new b("INTERNAL_SERVER_ERROR",{message:"Unable to create verification"});return{state:a.identifier,codeVerifier:n}}async function gl(e){var o,s;const t=e.query.state||e.body.state,r=await e.context.internalAdapter.findVerificationValue(t);if(!r){e.context.logger.error("State Mismatch. Verification not found",{state:t});const i=((o=e.context.options.onAPIError)==null?void 0:o.errorURL)||`${e.context.baseURL}/error`;throw e.redirect(`${i}?error=please_restart_the_process`)}const n=x({callbackURL:w(),codeVerifier:w(),errorURL:w().optional(),newUserURL:w().optional(),expiresAt:oo(),link:x({email:w(),userId:qt()}).optional(),requestSignUp:Ne().optional()}).parse(JSON.parse(r.value));if(n.errorURL||(n.errorURL=`${e.context.baseURL}/error`),n.expiresAt<Date.now()){await e.context.internalAdapter.deleteVerificationValue(r.id);const i=((s=e.context.options.onAPIError)==null?void 0:s.errorURL)||`${e.context.baseURL}/error`;throw e.redirect(`${i}?error=please_restart_the_process`)}return await e.context.internalAdapter.deleteVerificationValue(r.id),n}async function Xo(e){const t=await Tr("SHA-256").digest(e);return kr.encode(new Uint8Array(t),{padding:!1})}function es(e){return{tokenType:e.token_type,accessToken:e.access_token,refreshToken:e.refresh_token,accessTokenExpiresAt:e.expires_in?Qe(e.expires_in,"sec"):void 0,refreshTokenExpiresAt:e.refresh_token_expires_in?Qe(e.refresh_token_expires_in,"sec"):void 0,scopes:e!=null&&e.scope?typeof e.scope=="string"?e.scope.split(" "):e.scope:[],idToken:e.id_token}}function wl(e,t){var r;return e&&((r=t.options.account)!=null&&r.encryptOAuthTokens?Od({key:t.secret,data:e}):e)}function ie(e,t){var r;return(r=t.options.account)!=null&&r.encryptOAuthTokens&&e?Ud({key:t.secret,data:e}):e}async function ts(e,{userInfo:t,account:r,callbackURL:n,disableSignUp:o,overrideUserInfo:s}){var d,l,f,h,p,y,g,A,v;const i=await e.context.internalAdapter.findOAuthUser(t.email.toLowerCase(),r.accountId,r.providerId).catch(E=>{var U;$e.error(`Better auth was unable to query your database.
Error: `,E);const _=((U=e.context.options.onAPIError)==null?void 0:U.errorURL)||`${e.context.baseURL}/error`;throw e.redirect(`${_}?error=internal_server_error`)});let a=i==null?void 0:i.user,c=!a;if(i){const E=i.accounts.find(_=>_.providerId===r.providerId&&_.accountId===r.accountId);if(E){if(((p=e.context.options.account)==null?void 0:p.updateAccountOnSignIn)!==!1){const _=Object.fromEntries(Object.entries({idToken:r.idToken,accessToken:await ie(r.accessToken,e.context),refreshToken:await ie(r.refreshToken,e.context),accessTokenExpiresAt:r.accessTokenExpiresAt,refreshTokenExpiresAt:r.refreshTokenExpiresAt,scope:r.scope}).filter(([U,k])=>k!==void 0));Object.keys(_).length>0&&await e.context.internalAdapter.updateAccount(E.id,_,e)}}else{const _=(l=(d=e.context.options.account)==null?void 0:d.accountLinking)==null?void 0:l.trustedProviders;if(!(_==null?void 0:_.includes(r.providerId))&&!t.emailVerified||((h=(f=e.context.options.account)==null?void 0:f.accountLinking)==null?void 0:h.enabled)===!1)return nl&&$e.warn(`User already exist but account isn't linked to ${r.providerId}. To read more about how account linking works in Better Auth see https://www.better-auth.com/docs/concepts/users-accounts#account-linking.`),{error:"account not linked",data:null};try{await e.context.internalAdapter.linkAccount({providerId:r.providerId,accountId:t.id.toString(),userId:i.user.id,accessToken:await ie(r.accessToken,e.context),refreshToken:await ie(r.refreshToken,e.context),idToken:r.idToken,accessTokenExpiresAt:r.accessTokenExpiresAt,refreshTokenExpiresAt:r.refreshTokenExpiresAt,scope:r.scope},e)}catch(k){return $e.error("Unable to link account",k),{error:"unable to link account",data:null}}}if(s){const{id:_,...U}=t;await e.context.internalAdapter.updateUser(i.user.id,{...U,email:t.email.toLowerCase(),emailVerified:t.email.toLowerCase()===i.user.email&&i.user.emailVerified||t.emailVerified})}}else{if(o)return{error:"signup disabled",data:null,isRegister:!1};try{const{id:E,..._}=t;if(a=await e.context.internalAdapter.createOAuthUser({..._,email:t.email.toLowerCase()},{accessToken:await ie(r.accessToken,e.context),refreshToken:await ie(r.refreshToken,e.context),idToken:r.idToken,accessTokenExpiresAt:r.accessTokenExpiresAt,refreshTokenExpiresAt:r.refreshTokenExpiresAt,scope:r.scope,providerId:r.providerId,accountId:t.id.toString()},e).then(U=>U==null?void 0:U.user),!t.emailVerified&&a&&((y=e.context.options.emailVerification)!=null&&y.sendOnSignUp)){const U=await et(e.context.secret,a.email,void 0,(g=e.context.options.emailVerification)==null?void 0:g.expiresIn),k=`${e.context.baseURL}/verify-email?token=${U}&callbackURL=${n}`;await((v=(A=e.context.options.emailVerification)==null?void 0:A.sendVerificationEmail)==null?void 0:v.call(A,{user:a,url:k,token:U},e.request))}}catch(E){return $e.error(E),E instanceof b?{error:E.message,data:null,isRegister:!1}:{error:"unable to create user",data:null,isRegister:!1}}}if(!a)return{error:"unable to create user",data:null,isRegister:!1};const u=await e.context.internalAdapter.createSession(a.id,e);return u?{data:{session:u,user:a},error:null,isRegister:c}:{error:"unable to create session",data:null,isRegister:!1}}async function se({id:e,options:t,authorizationEndpoint:r,state:n,codeVerifier:o,scopes:s,claims:i,redirectURI:a,duration:c,prompt:u,accessType:d,responseType:l,display:f,loginHint:h,hd:p,responseMode:y,additionalParams:g,scopeJoiner:A}){const v=new URL(r);if(v.searchParams.set("response_type",l||"code"),v.searchParams.set("client_id",t.clientId),v.searchParams.set("state",n),v.searchParams.set("scope",s.join(A||" ")),v.searchParams.set("redirect_uri",t.redirectURI||a),c&&v.searchParams.set("duration",c),f&&v.searchParams.set("display",f),h&&v.searchParams.set("login_hint",h),u&&v.searchParams.set("prompt",u),p&&v.searchParams.set("hd",p),d&&v.searchParams.set("access_type",d),y&&v.searchParams.set("response_mode",y),o){const E=await Xo(o);v.searchParams.set("code_challenge_method","S256"),v.searchParams.set("code_challenge",E)}if(i){const E=i.reduce((_,U)=>(_[U]=null,_),{});v.searchParams.set("claims",JSON.stringify({id_token:{email:null,email_verified:null,...E}}))}return g&&Object.entries(g).forEach(([E,_])=>{v.searchParams.set(E,_)}),v}async function ee({code:e,codeVerifier:t,redirectURI:r,options:n,tokenEndpoint:o,authentication:s,deviceId:i,headers:a,additionalParams:c={}}){const u=new URLSearchParams,d={"content-type":"application/x-www-form-urlencoded",accept:"application/json","user-agent":"better-auth",...a};if(u.set("grant_type","authorization_code"),u.set("code",e),t&&u.set("code_verifier",t),n.clientKey&&u.set("client_key",n.clientKey),i&&u.set("device_id",i),u.set("redirect_uri",n.redirectURI||r),u.set("client_id",n.clientId),s==="basic"){const p=rt.encode(`${n.clientId}:${n.clientSecret}`);d.authorization=`Basic ${p}`}else u.set("client_secret",n.clientSecret);for(const[p,y]of Object.entries(c))u.has(p)||u.append(p,y);const{data:l,error:f}=await q(o,{method:"POST",body:u,headers:d});if(f)throw f;return es(l)}async function te({refreshToken:e,options:t,tokenEndpoint:r,authentication:n,extraParams:o,grantType:s="refresh_token"}){var l;const i=new URLSearchParams,a={"content-type":"application/x-www-form-urlencoded",accept:"application/json"};if(i.set("grant_type",s),i.set("refresh_token",e),n==="basic"?a.authorization=rt.encode(`${t.clientId}:${t.clientSecret}`):(i.set("client_id",t.clientId),i.set("client_secret",t.clientSecret)),o)for(const[f,h]of Object.entries(o))i.set(f,h);const{data:c,error:u}=await q(r,{method:"POST",body:i,headers:a});if(u)throw u;const d={accessToken:c.access_token,refreshToken:c.refresh_token,tokenType:c.token_type,scopes:(l=c.scope)==null?void 0:l.split(" "),idToken:c.id_token};if(c.expires_in){const f=new Date;d.accessTokenExpiresAt=new Date(f.getTime()+c.expires_in*1e3)}return d}const yl=e=>{const t="https://appleid.apple.com/auth/token";return{id:"apple",name:"Apple",async createAuthorizationURL({state:r,scopes:n,redirectURI:o}){const s=e.disableDefaultScope?[]:["email","name"];return e.scope&&s.push(...e.scope),n&&s.push(...n),await se({id:"apple",options:e,authorizationEndpoint:"https://appleid.apple.com/auth/authorize",scopes:s,state:r,redirectURI:o,responseMode:"form_post",responseType:"code id_token"})},validateAuthorizationCode:async({code:r,codeVerifier:n,redirectURI:o})=>ee({code:r,codeVerifier:n,redirectURI:o,options:e,tokenEndpoint:t}),async verifyIdToken(r,n){if(e.disableIdTokenSignIn)return!1;if(e.verifyIdToken)return e.verifyIdToken(r,n);const o=Sd(r),{kid:s,alg:i}=o;if(!s||!i)return!1;const a=await _l(s),{payload:c}=await Or(r,a,{algorithms:[i],issuer:"https://appleid.apple.com",audience:e.appBundleIdentifier||e.clientId,maxTokenAge:"1h"});return["email_verified","is_private_email"].forEach(u=>{c[u]!==void 0&&(c[u]=!!c[u])}),n&&c.nonce!==n?!1:!!c},refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async r=>te({refreshToken:r,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://appleid.apple.com/auth/token"}),async getUserInfo(r){var a,c,u;if(e.getUserInfo)return e.getUserInfo(r);if(!r.idToken)return null;const n=pt(r.idToken);if(!n)return null;const o=r.user?`${(a=r.user.name)==null?void 0:a.firstName} ${(c=r.user.name)==null?void 0:c.lastName}`:n.name||n.email,s=typeof n.email_verified=="boolean"?n.email_verified:n.email_verified==="true",i=await((u=e.mapProfileToUser)==null?void 0:u.call(e,n));return{user:{id:n.sub,name:o,emailVerified:s,email:n.email,...i},data:n}},options:e}},_l=async e=>{const t="https://appleid.apple.com",r="/auth/keys",{data:n}=await q(`${t}${r}`);if(!(n!=null&&n.keys))throw new b("BAD_REQUEST",{message:"Keys not found"});const o=n.keys.find(s=>s.kid===e);if(!o)throw new Error(`JWK with kid ${e} not found`);return await Rr(o,o.alg)},bl=e=>({id:"discord",name:"Discord",createAuthorizationURL({state:t,scopes:r,redirectURI:n}){const o=e.disableDefaultScope?[]:["identify","email"];return r&&o.push(...r),e.scope&&o.push(...e.scope),new URL(`https://discord.com/api/oauth2/authorize?scope=${o.join("+")}&response_type=code&client_id=${e.clientId}&redirect_uri=${encodeURIComponent(e.redirectURI||n)}&state=${t}&prompt=${e.prompt||"none"}`)},validateAuthorizationCode:async({code:t,redirectURI:r})=>ee({code:t,redirectURI:r,options:e,tokenEndpoint:"https://discord.com/api/oauth2/token"}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>te({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://discord.com/api/oauth2/token"}),async getUserInfo(t){var s;if(e.getUserInfo)return e.getUserInfo(t);const{data:r,error:n}=await q("https://discord.com/api/users/@me",{headers:{authorization:`Bearer ${t.accessToken}`}});if(n)return null;if(r.avatar===null){const i=r.discriminator==="0"?Number(BigInt(r.id)>>BigInt(22))%6:parseInt(r.discriminator)%5;r.image_url=`https://cdn.discordapp.com/embed/avatars/${i}.png`}else{const i=r.avatar.startsWith("a_")?"gif":"png";r.image_url=`https://cdn.discordapp.com/avatars/${r.id}/${r.avatar}.${i}`}const o=await((s=e.mapProfileToUser)==null?void 0:s.call(e,r));return{user:{id:r.id,name:r.global_name||r.username||"",email:r.email,emailVerified:r.verified,image:r.image_url,...o},data:r}},options:e}),vl=e=>({id:"facebook",name:"Facebook",async createAuthorizationURL({state:t,scopes:r,redirectURI:n,loginHint:o}){const s=e.disableDefaultScope?[]:["email","public_profile"];return e.scope&&s.push(...e.scope),r&&s.push(...r),await se({id:"facebook",options:e,authorizationEndpoint:"https://www.facebook.com/v21.0/dialog/oauth",scopes:s,state:t,redirectURI:n,loginHint:o,additionalParams:e.configId?{config_id:e.configId}:{}})},validateAuthorizationCode:async({code:t,redirectURI:r})=>ee({code:t,redirectURI:r,options:e,tokenEndpoint:"https://graph.facebook.com/oauth/access_token"}),async verifyIdToken(t,r){if(e.disableIdTokenSignIn)return!1;if(e.verifyIdToken)return e.verifyIdToken(t,r);if(t.split(".").length===3)try{const{payload:n}=await Or(t,Td(new URL("https://limited.facebook.com/.well-known/oauth/openid/jwks/")),{algorithms:["RS256"],audience:e.clientId,issuer:"https://www.facebook.com"});return r&&n.nonce!==r?!1:!!n}catch{return!1}return!0},refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>te({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://graph.facebook.com/v18.0/oauth/access_token"}),async getUserInfo(t){var i,a;if(e.getUserInfo)return e.getUserInfo(t);if(t.idToken&&t.idToken.split(".").length===3){const c=pt(t.idToken),u={id:c.sub,name:c.name,email:c.email,picture:{data:{url:c.picture,height:100,width:100,is_silhouette:!1}}},d=await((i=e.mapProfileToUser)==null?void 0:i.call(e,{...u,email_verified:!0}));return{user:{...u,emailVerified:!0,...d},data:c}}const r=["id","name","email","picture",...(e==null?void 0:e.fields)||[]],{data:n,error:o}=await q("https://graph.facebook.com/me?fields="+r.join(","),{auth:{type:"Bearer",token:t.accessToken}});if(o)return null;const s=await((a=e.mapProfileToUser)==null?void 0:a.call(e,n));return{user:{id:n.id,name:n.name,email:n.email,image:n.picture.data.url,emailVerified:n.email_verified,...s},data:n}},options:e}),El=e=>{const t="https://github.com/login/oauth/access_token";return{id:"github",name:"GitHub",createAuthorizationURL({state:r,scopes:n,loginHint:o,redirectURI:s}){const i=e.disableDefaultScope?[]:["read:user","user:email"];return e.scope&&i.push(...e.scope),n&&i.push(...n),se({id:"github",options:e,authorizationEndpoint:"https://github.com/login/oauth/authorize",scopes:i,state:r,redirectURI:s,loginHint:o,prompt:e.prompt})},validateAuthorizationCode:async({code:r,redirectURI:n})=>ee({code:r,redirectURI:n,options:e,tokenEndpoint:t}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async r=>te({refreshToken:r,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://github.com/login/oauth/access_token"}),async getUserInfo(r){var c,u,d;if(e.getUserInfo)return e.getUserInfo(r);const{data:n,error:o}=await q("https://api.github.com/user",{headers:{"User-Agent":"better-auth",authorization:`Bearer ${r.accessToken}`}});if(o)return null;const{data:s}=await q("https://api.github.com/user/emails",{headers:{Authorization:`Bearer ${r.accessToken}`,"User-Agent":"better-auth"}});!n.email&&s&&(n.email=(c=s.find(l=>l.primary)??s[0])==null?void 0:c.email);const i=((u=s==null?void 0:s.find(l=>l.email===n.email))==null?void 0:u.verified)??!1,a=await((d=e.mapProfileToUser)==null?void 0:d.call(e,n));return{user:{id:n.id.toString(),name:n.name||n.login,email:n.email,image:n.avatar_url,emailVerified:i,...a},data:n}},options:e}},Al=e=>({id:"google",name:"Google",async createAuthorizationURL({state:t,scopes:r,codeVerifier:n,redirectURI:o,loginHint:s,display:i}){if(!e.clientId||!e.clientSecret)throw $e.error("Client Id and Client Secret is required for Google. Make sure to provide them in the options."),new Ct("CLIENT_ID_AND_SECRET_REQUIRED");if(!n)throw new Ct("codeVerifier is required for Google");const a=e.disableDefaultScope?[]:["email","profile","openid"];return e.scope&&a.push(...e.scope),r&&a.push(...r),e.prompt==="select_account+consent"&&(e.prompt="select_account consent"),await se({id:"google",options:e,authorizationEndpoint:"https://accounts.google.com/o/oauth2/auth",scopes:a,state:t,codeVerifier:n,redirectURI:o,prompt:e.prompt,accessType:e.accessType,display:i||e.display,loginHint:s,hd:e.hd,additionalParams:{include_granted_scopes:"true"}})},validateAuthorizationCode:async({code:t,codeVerifier:r,redirectURI:n})=>ee({code:t,codeVerifier:r,redirectURI:n,options:e,tokenEndpoint:"https://oauth2.googleapis.com/token"}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>te({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://www.googleapis.com/oauth2/v4/token"}),async verifyIdToken(t,r){if(e.disableIdTokenSignIn)return!1;if(e.verifyIdToken)return e.verifyIdToken(t,r);const n=`https://www.googleapis.com/oauth2/v3/tokeninfo?id_token=${t}`,{data:o}=await q(n);return o?o.aud===e.clientId&&(o.iss==="https://accounts.google.com"||o.iss==="accounts.google.com"):!1},async getUserInfo(t){var o;if(e.getUserInfo)return e.getUserInfo(t);if(!t.idToken)return null;const r=pt(t.idToken),n=await((o=e.mapProfileToUser)==null?void 0:o.call(e,r));return{user:{id:r.sub,name:r.name,email:r.email,image:r.picture,emailVerified:r.email_verified,...n},data:r}},options:e}),kl=e=>({id:"kick",name:"Kick",createAuthorizationURL({state:t,scopes:r,redirectURI:n,codeVerifier:o}){const s=e.disableDefaultScope?[]:["user:read"];return e.scope&&s.push(...e.scope),r&&s.push(...r),se({id:"kick",redirectURI:n,options:e,authorizationEndpoint:"https://id.kick.com/oauth/authorize",scopes:s,codeVerifier:o,state:t})},async validateAuthorizationCode({code:t,redirectURI:r,codeVerifier:n}){return ee({code:t,redirectURI:r,options:e,tokenEndpoint:"https://id.kick.com/oauth/token",codeVerifier:n})},async getUserInfo(t){var i;if(e.getUserInfo)return e.getUserInfo(t);const{data:r,error:n}=await q("https://api.kick.com/public/v1/users",{method:"GET",headers:{Authorization:`Bearer ${t.accessToken}`}});if(n)return null;const o=r.data[0],s=await((i=e.mapProfileToUser)==null?void 0:i.call(e,o));return{user:{id:o.user_id,name:o.name,email:o.email,image:o.profile_picture,emailVerified:!0,...s},data:o}},options:e}),Tl=e=>({id:"huggingface",name:"Hugging Face",createAuthorizationURL({state:t,scopes:r,codeVerifier:n,redirectURI:o}){const s=e.disableDefaultScope?[]:["openid","profile","email"];return e.scope&&s.push(...e.scope),r&&s.push(...r),se({id:"huggingface",options:e,authorizationEndpoint:"https://huggingface.co/oauth/authorize",scopes:s,state:t,codeVerifier:n,redirectURI:o})},validateAuthorizationCode:async({code:t,codeVerifier:r,redirectURI:n})=>ee({code:t,codeVerifier:r,redirectURI:n,options:e,tokenEndpoint:"https://huggingface.co/oauth/token"}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>te({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://huggingface.co/oauth/token"}),async getUserInfo(t){var s;if(e.getUserInfo)return e.getUserInfo(t);const{data:r,error:n}=await q("https://huggingface.co/oauth/userinfo",{method:"GET",headers:{Authorization:`Bearer ${t.accessToken}`}});if(n)return null;const o=await((s=e.mapProfileToUser)==null?void 0:s.call(e,r));return{user:{id:r.sub,name:r.name||r.preferred_username,email:r.email,image:r.picture,emailVerified:r.email_verified??!1,...o},data:r}},options:e}),Sl=e=>{const t=e.tenantId||"common",r=`https://login.microsoftonline.com/${t}/oauth2/v2.0/authorize`,n=`https://login.microsoftonline.com/${t}/oauth2/v2.0/token`;return{id:"microsoft",name:"Microsoft EntraID",createAuthorizationURL(o){const s=e.disableDefaultScope?[]:["openid","profile","email","User.Read","offline_access"];return e.scope&&s.push(...e.scope),o.scopes&&s.push(...o.scopes),se({id:"microsoft",options:e,authorizationEndpoint:r,state:o.state,codeVerifier:o.codeVerifier,scopes:s,redirectURI:o.redirectURI,prompt:e.prompt})},validateAuthorizationCode({code:o,codeVerifier:s,redirectURI:i}){return ee({code:o,codeVerifier:s,redirectURI:i,options:e,tokenEndpoint:n})},async getUserInfo(o){var c;if(e.getUserInfo)return e.getUserInfo(o);if(!o.idToken)return null;const s=pt(o.idToken),i=e.profilePhotoSize||48;await q(`https://graph.microsoft.com/v1.0/me/photos/${i}x${i}/$value`,{headers:{Authorization:`Bearer ${o.accessToken}`},async onResponse(u){if(!(e.disableProfilePhoto||!u.response.ok))try{const l=await u.response.clone().arrayBuffer(),f=rt.encode(l);s.picture=`data:image/jpeg;base64, ${f}`}catch(d){$e.error(d&&typeof d=="object"&&"name"in d?d.name:"",d)}}});const a=await((c=e.mapProfileToUser)==null?void 0:c.call(e,s));return{user:{id:s.sub,name:s.name,email:s.email,image:s.picture,emailVerified:!0,...a},data:s}},refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async o=>{const s=e.disableDefaultScope?[]:["openid","profile","email","User.Read","offline_access"];return e.scope&&s.push(...e.scope),te({refreshToken:o,options:{clientId:e.clientId,clientSecret:e.clientSecret},extraParams:{scope:s.join(" ")},tokenEndpoint:n})},options:e}},Il=e=>({id:"slack",name:"Slack",createAuthorizationURL({state:t,scopes:r,redirectURI:n}){const o=e.disableDefaultScope?[]:["openid","profile","email"];r&&o.push(...r),e.scope&&o.push(...e.scope);const s=new URL("https://slack.com/openid/connect/authorize");return s.searchParams.set("scope",o.join(" ")),s.searchParams.set("response_type","code"),s.searchParams.set("client_id",e.clientId),s.searchParams.set("redirect_uri",e.redirectURI||n),s.searchParams.set("state",t),s},validateAuthorizationCode:async({code:t,redirectURI:r})=>ee({code:t,redirectURI:r,options:e,tokenEndpoint:"https://slack.com/api/openid.connect.token"}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>te({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://slack.com/api/openid.connect.token"}),async getUserInfo(t){var s;if(e.getUserInfo)return e.getUserInfo(t);const{data:r,error:n}=await q("https://slack.com/api/openid.connect.userInfo",{headers:{authorization:`Bearer ${t.accessToken}`}});if(n)return null;const o=await((s=e.mapProfileToUser)==null?void 0:s.call(e,r));return{user:{id:r["https://slack.com/user_id"],name:r.name||"",email:r.email,emailVerified:r.email_verified,image:r.picture||r["https://slack.com/user_image_512"],...o},data:r}},options:e}),Rl=e=>{const t="https://api.notion.com/v1/oauth/token";return{id:"notion",name:"Notion",createAuthorizationURL({state:r,scopes:n,loginHint:o,redirectURI:s}){const i=e.disableDefaultScope?[]:[];return e.scope&&i.push(...e.scope),n&&i.push(...n),se({id:"notion",options:e,authorizationEndpoint:"https://api.notion.com/v1/oauth/authorize",scopes:i,state:r,redirectURI:s,loginHint:o,additionalParams:{owner:"user"}})},validateAuthorizationCode:async({code:r,redirectURI:n})=>ee({code:r,redirectURI:n,options:e,tokenEndpoint:t,authentication:"basic"}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async r=>te({refreshToken:r,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:t}),async getUserInfo(r){var a,c,u,d,l;if(e.getUserInfo)return e.getUserInfo(r);const{data:n,error:o}=await q("https://api.notion.com/v1/users/me",{headers:{Authorization:`Bearer ${r.accessToken}`,"Notion-Version":"2022-06-28"}});if(o||!n)return null;const s=(c=(a=n.bot)==null?void 0:a.owner)==null?void 0:c.user;if(!s)return null;const i=await((u=e.mapProfileToUser)==null?void 0:u.call(e,s));return{user:{id:s.id,name:s.name||"Notion User",email:((d=s.person)==null?void 0:d.email)||null,image:s.avatar_url,emailVerified:!!((l=s.person)!=null&&l.email),...i},data:s}},options:e}},Ul=e=>({id:"spotify",name:"Spotify",createAuthorizationURL({state:t,scopes:r,codeVerifier:n,redirectURI:o}){const s=e.disableDefaultScope?[]:["user-read-email"];return e.scope&&s.push(...e.scope),r&&s.push(...r),se({id:"spotify",options:e,authorizationEndpoint:"https://accounts.spotify.com/authorize",scopes:s,state:t,codeVerifier:n,redirectURI:o})},validateAuthorizationCode:async({code:t,codeVerifier:r,redirectURI:n})=>ee({code:t,codeVerifier:r,redirectURI:n,options:e,tokenEndpoint:"https://accounts.spotify.com/api/token"}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>te({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://accounts.spotify.com/api/token"}),async getUserInfo(t){var s,i;if(e.getUserInfo)return e.getUserInfo(t);const{data:r,error:n}=await q("https://api.spotify.com/v1/me",{method:"GET",headers:{Authorization:`Bearer ${t.accessToken}`}});if(n)return null;const o=await((s=e.mapProfileToUser)==null?void 0:s.call(e,r));return{user:{id:r.id,name:r.display_name,email:r.email,image:(i=r.images[0])==null?void 0:i.url,emailVerified:!1,...o},data:r}},options:e}),Ol=e=>({id:"twitch",name:"Twitch",createAuthorizationURL({state:t,scopes:r,redirectURI:n}){const o=e.disableDefaultScope?[]:["user:read:email","openid"];return e.scope&&o.push(...e.scope),r&&o.push(...r),se({id:"twitch",redirectURI:n,options:e,authorizationEndpoint:"https://id.twitch.tv/oauth2/authorize",scopes:o,state:t,claims:e.claims||["email","email_verified","preferred_username","picture"]})},validateAuthorizationCode:async({code:t,redirectURI:r})=>ee({code:t,redirectURI:r,options:e,tokenEndpoint:"https://id.twitch.tv/oauth2/token"}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>te({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://id.twitch.tv/oauth2/token"}),async getUserInfo(t){var s;if(e.getUserInfo)return e.getUserInfo(t);const r=t.idToken;if(!r)return $e.error("No idToken found in token"),null;const n=pt(r),o=await((s=e.mapProfileToUser)==null?void 0:s.call(e,n));return{user:{id:n.sub,name:n.preferred_username,email:n.email,image:n.picture,emailVerified:n.email_verified,...o},data:n}},options:e}),Dl=e=>({id:"twitter",name:"Twitter",createAuthorizationURL(t){const r=e.disableDefaultScope?[]:["users.read","tweet.read","offline.access","users.email"];return e.scope&&r.push(...e.scope),t.scopes&&r.push(...t.scopes),se({id:"twitter",options:e,authorizationEndpoint:"https://x.com/i/oauth2/authorize",scopes:r,state:t.state,codeVerifier:t.codeVerifier,redirectURI:t.redirectURI})},validateAuthorizationCode:async({code:t,codeVerifier:r,redirectURI:n})=>ee({code:t,codeVerifier:r,authentication:"basic",redirectURI:n,options:e,tokenEndpoint:"https://api.x.com/2/oauth2/token"}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>te({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://api.x.com/2/oauth2/token"}),async getUserInfo(t){var c,u;if(e.getUserInfo)return e.getUserInfo(t);const{data:r,error:n}=await q("https://api.x.com/2/users/me?user.fields=profile_image_url",{method:"GET",headers:{Authorization:`Bearer ${t.accessToken}`}});if(n)return null;const{data:o,error:s}=await q("https://api.x.com/2/users/me?user.fields=confirmed_email",{method:"GET",headers:{Authorization:`Bearer ${t.accessToken}`}});let i=!1;!s&&((c=o==null?void 0:o.data)!=null&&c.confirmed_email)&&(r.data.email=o.data.confirmed_email,i=!0);const a=await((u=e.mapProfileToUser)==null?void 0:u.call(e,r));return{user:{id:r.data.id,name:r.data.name,email:r.data.email||r.data.username||null,image:r.data.profile_image_url,emailVerified:i,...a},data:r}},options:e}),Pl=e=>{const t="https://api.dropboxapi.com/oauth2/token";return{id:"dropbox",name:"Dropbox",createAuthorizationURL:async({state:r,scopes:n,codeVerifier:o,redirectURI:s})=>{const i=e.disableDefaultScope?[]:["account_info.read"];e.scope&&i.push(...e.scope),n&&i.push(...n);const a={};return e.accessType&&(a.token_access_type=e.accessType),await se({id:"dropbox",options:e,authorizationEndpoint:"https://www.dropbox.com/oauth2/authorize",scopes:i,state:r,redirectURI:s,codeVerifier:o,additionalParams:a})},validateAuthorizationCode:async({code:r,codeVerifier:n,redirectURI:o})=>await ee({code:r,codeVerifier:n,redirectURI:o,options:e,tokenEndpoint:t}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async r=>te({refreshToken:r,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://api.dropbox.com/oauth2/token"}),async getUserInfo(r){var i,a;if(e.getUserInfo)return e.getUserInfo(r);const{data:n,error:o}=await q("https://api.dropboxapi.com/2/users/get_current_account",{method:"POST",headers:{Authorization:`Bearer ${r.accessToken}`}});if(o)return null;const s=await((i=e.mapProfileToUser)==null?void 0:i.call(e,n));return{user:{id:n.account_id,name:(a=n.name)==null?void 0:a.display_name,email:n.email,emailVerified:n.email_verified||!1,image:n.profile_photo_url,...s},data:n}},options:e}},$l=e=>{const t="https://api.linear.app/oauth/token";return{id:"linear",name:"Linear",createAuthorizationURL({state:r,scopes:n,loginHint:o,redirectURI:s}){const i=e.disableDefaultScope?[]:["read"];return e.scope&&i.push(...e.scope),n&&i.push(...n),se({id:"linear",options:e,authorizationEndpoint:"https://linear.app/oauth/authorize",scopes:i,state:r,redirectURI:s,loginHint:o})},validateAuthorizationCode:async({code:r,redirectURI:n})=>ee({code:r,redirectURI:n,options:e,tokenEndpoint:t}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async r=>te({refreshToken:r,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:t}),async getUserInfo(r){var a,c;if(e.getUserInfo)return e.getUserInfo(r);const{data:n,error:o}=await q("https://api.linear.app/graphql",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r.accessToken}`},body:JSON.stringify({query:`
							query {
								viewer {
									id
									name
									email
									avatarUrl
									active
									createdAt
									updatedAt
								}
							}
						`})});if(o||!((a=n==null?void 0:n.data)!=null&&a.viewer))return null;const s=n.data.viewer,i=await((c=e.mapProfileToUser)==null?void 0:c.call(e,s));return{user:{id:n.data.viewer.id,name:n.data.viewer.name,email:n.data.viewer.email,image:n.data.viewer.avatarUrl,emailVerified:!0,...i},data:s}},options:e}},Ll=e=>{const t="https://www.linkedin.com/oauth/v2/authorization",r="https://www.linkedin.com/oauth/v2/accessToken";return{id:"linkedin",name:"Linkedin",createAuthorizationURL:async({state:n,scopes:o,redirectURI:s,loginHint:i})=>{const a=e.disableDefaultScope?[]:["profile","email","openid"];return e.scope&&a.push(...e.scope),o&&a.push(...o),await se({id:"linkedin",options:e,authorizationEndpoint:t,scopes:a,state:n,loginHint:i,redirectURI:s})},validateAuthorizationCode:async({code:n,redirectURI:o})=>await ee({code:n,redirectURI:o,options:e,tokenEndpoint:r}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async n=>te({refreshToken:n,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:r}),async getUserInfo(n){var a;if(e.getUserInfo)return e.getUserInfo(n);const{data:o,error:s}=await q("https://api.linkedin.com/v2/userinfo",{method:"GET",headers:{Authorization:`Bearer ${n.accessToken}`}});if(s)return null;const i=await((a=e.mapProfileToUser)==null?void 0:a.call(e,o));return{user:{id:o.sub,name:o.name,email:o.email,emailVerified:o.email_verified||!1,image:o.picture,...i},data:o}},options:e}},Yt=(e="")=>e.split("://").map(t=>t.replace(/\/{2,}/g,"/")).join("://"),Nl=e=>{let t=e||"https://gitlab.com";return{authorizationEndpoint:Yt(`${t}/oauth/authorize`),tokenEndpoint:Yt(`${t}/oauth/token`),userinfoEndpoint:Yt(`${t}/api/v4/user`)}},xl=e=>{const{authorizationEndpoint:t,tokenEndpoint:r,userinfoEndpoint:n}=Nl(e.issuer),o="gitlab";return{id:o,name:"Gitlab",createAuthorizationURL:async({state:i,scopes:a,codeVerifier:c,loginHint:u,redirectURI:d})=>{const l=e.disableDefaultScope?[]:["read_user"];return e.scope&&l.push(...e.scope),a&&l.push(...a),await se({id:o,options:e,authorizationEndpoint:t,scopes:l,state:i,redirectURI:d,codeVerifier:c,loginHint:u})},validateAuthorizationCode:async({code:i,redirectURI:a,codeVerifier:c})=>ee({code:i,redirectURI:a,options:e,codeVerifier:c,tokenEndpoint:r}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async i=>te({refreshToken:i,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://gitlab.com/oauth/token"}),async getUserInfo(i){var d;if(e.getUserInfo)return e.getUserInfo(i);const{data:a,error:c}=await q(n,{headers:{authorization:`Bearer ${i.accessToken}`}});if(c||a.state!=="active"||a.locked)return null;const u=await((d=e.mapProfileToUser)==null?void 0:d.call(e,a));return{user:{id:a.id.toString(),name:a.name??a.username,email:a.email,image:a.avatar_url,emailVerified:!0,...u},data:a}},options:e}},Cl=e=>({id:"tiktok",name:"TikTok",createAuthorizationURL({state:t,scopes:r,redirectURI:n}){const o=e.disableDefaultScope?[]:["user.info.profile"];return e.scope&&o.push(...e.scope),r&&o.push(...r),new URL(`https://www.tiktok.com/v2/auth/authorize?scope=${o.join(",")}&response_type=code&client_key=${e.clientKey}&client_secret=${e.clientSecret}&redirect_uri=${encodeURIComponent(e.redirectURI||n)}&state=${t}`)},validateAuthorizationCode:async({code:t,redirectURI:r})=>ee({code:t,redirectURI:e.redirectURI||r,options:e,tokenEndpoint:"https://open.tiktokapis.com/v2/oauth/token/"}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>te({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://open.tiktokapis.com/v2/oauth/token/"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);const r=["open_id","avatar_large_url","display_name","username"],{data:n,error:o}=await q(`https://open.tiktokapis.com/v2/user/info/?fields=${r.join(",")}`,{headers:{authorization:`Bearer ${t.accessToken}`}});return o?null:{user:{email:n.data.user.email||n.data.user.username,id:n.data.user.open_id,name:n.data.user.display_name||n.data.user.username,image:n.data.user.avatar_large_url,emailVerified:!!n.data.user.email},data:n}},options:e}),zl=e=>({id:"reddit",name:"Reddit",createAuthorizationURL({state:t,scopes:r,redirectURI:n}){const o=e.disableDefaultScope?[]:["identity"];return e.scope&&o.push(...e.scope),r&&o.push(...r),se({id:"reddit",options:e,authorizationEndpoint:"https://www.reddit.com/api/v1/authorize",scopes:o,state:t,redirectURI:n,duration:e.duration})},validateAuthorizationCode:async({code:t,redirectURI:r})=>{const n=new URLSearchParams({grant_type:"authorization_code",code:t,redirect_uri:e.redirectURI||r}),o={"content-type":"application/x-www-form-urlencoded",accept:"text/plain","user-agent":"better-auth",Authorization:`Basic ${rt.encode(`${e.clientId}:${e.clientSecret}`)}`},{data:s,error:i}=await q("https://www.reddit.com/api/v1/access_token",{method:"POST",headers:o,body:n.toString()});if(i)throw i;return es(s)},refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>te({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://www.reddit.com/api/v1/access_token"}),async getUserInfo(t){var s,i;if(e.getUserInfo)return e.getUserInfo(t);const{data:r,error:n}=await q("https://oauth.reddit.com/api/v1/me",{headers:{Authorization:`Bearer ${t.accessToken}`,"User-Agent":"better-auth"}});if(n)return null;const o=await((s=e.mapProfileToUser)==null?void 0:s.call(e,r));return{user:{id:r.id,name:r.name,email:r.oauth_client_id,emailVerified:r.has_verified_email,image:(i=r.icon_img)==null?void 0:i.split("?")[0],...o},data:r}},options:e}),Zl=e=>({id:"roblox",name:"Roblox",createAuthorizationURL({state:t,scopes:r,redirectURI:n}){const o=e.disableDefaultScope?[]:["openid","profile"];return e.scope&&o.push(...e.scope),r&&o.push(...r),new URL(`https://apis.roblox.com/oauth/v1/authorize?scope=${o.join("+")}&response_type=code&client_id=${e.clientId}&redirect_uri=${encodeURIComponent(e.redirectURI||n)}&state=${t}&prompt=${e.prompt||"select_account+consent"}`)},validateAuthorizationCode:async({code:t,redirectURI:r})=>ee({code:t,redirectURI:e.redirectURI||r,options:e,tokenEndpoint:"https://apis.roblox.com/oauth/v1/token",authentication:"post"}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>te({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://apis.roblox.com/oauth/v1/token"}),async getUserInfo(t){var s;if(e.getUserInfo)return e.getUserInfo(t);const{data:r,error:n}=await q("https://apis.roblox.com/oauth/v1/userinfo",{headers:{authorization:`Bearer ${t.accessToken}`}});if(n)return null;const o=await((s=e.mapProfileToUser)==null?void 0:s.call(e,r));return{user:{id:r.sub,name:r.nickname||r.preferred_username||"",image:r.picture,email:r.preferred_username||null,emailVerified:!0,...o},data:{...r}}},options:e}),Vl=e=>({id:"vk",name:"VK",async createAuthorizationURL({state:t,scopes:r,codeVerifier:n,redirectURI:o}){const s=e.disableDefaultScope?[]:["email","phone"];return e.scope&&s.push(...e.scope),r&&s.push(...r),se({id:"vk",options:e,authorizationEndpoint:"https://id.vk.com/authorize",scopes:s,state:t,redirectURI:o,codeVerifier:n})},validateAuthorizationCode:async({code:t,codeVerifier:r,redirectURI:n,deviceId:o})=>ee({code:t,codeVerifier:r,redirectURI:e.redirectURI||n,options:e,deviceId:o,tokenEndpoint:"https://id.vk.com/oauth2/auth"}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>te({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://id.vk.com/oauth2/auth"}),async getUserInfo(t){var i;if(e.getUserInfo)return e.getUserInfo(t);if(!t.accessToken)return null;const r=new URLSearchParams({access_token:t.accessToken,client_id:e.clientId}).toString(),{data:n,error:o}=await q("https://id.vk.com/oauth2/user_info",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:r});if(o||!n.user.email)return null;const s=await((i=e.mapProfileToUser)==null?void 0:i.call(e,n));return{user:{id:n.user.user_id,first_name:n.user.first_name,last_name:n.user.last_name,email:n.user.email,image:n.user.avatar,emailVerified:!!n.user.email,birthday:n.user.birthday,sex:n.user.sex,...s},data:n}},options:e}),jl=e=>{const t={pkce:!0,...e};return{id:"zoom",name:"Zoom",createAuthorizationURL:async({state:r,redirectURI:n,codeVerifier:o})=>{const s=new URLSearchParams({response_type:"code",redirect_uri:t.redirectURI?t.redirectURI:n,client_id:t.clientId,state:r});if(t.pkce){const a=await Xo(o);s.set("code_challenge_method","S256"),s.set("code_challenge",a)}const i=new URL("https://zoom.us/oauth/authorize");return i.search=s.toString(),i},validateAuthorizationCode:async({code:r,redirectURI:n,codeVerifier:o})=>ee({code:r,redirectURI:t.redirectURI||n,codeVerifier:o,options:t,tokenEndpoint:"https://zoom.us/oauth/token",authentication:"post"}),async getUserInfo(r){var i;if(t.getUserInfo)return t.getUserInfo(r);const{data:n,error:o}=await q("https://api.zoom.us/v2/users/me",{headers:{authorization:`Bearer ${r.accessToken}`}});if(o)return null;const s=await((i=t.mapProfileToUser)==null?void 0:i.call(t,n));return{user:{id:n.id,name:n.display_name,image:n.pic_url,email:n.email,emailVerified:!!n.verified,...s},data:{...n}}}}},Bl={apple:yl,discord:bl,facebook:vl,github:El,microsoft:Sl,google:Al,huggingface:Tl,slack:Il,spotify:Ul,twitch:Ol,twitter:Dl,dropbox:Pl,kick:kl,linear:$l,linkedin:Ll,gitlab:xl,tiktok:Cl,reddit:zl,roblox:Zl,vk:Vl,zoom:jl,notion:Rl},ql=Object.keys(Bl),rs=ft(ql).or(w());M("/sign-in/social",{method:"POST",body:x({callbackURL:w().meta({description:"Callback URL to redirect to after the user has signed in"}).optional(),newUserCallbackURL:w().optional(),errorCallbackURL:w().meta({description:"Callback URL to redirect to if an error happens"}).optional(),provider:rs,disableRedirect:Ne().meta({description:"Disable automatic redirection to the provider. Useful for handling the redirection yourself"}).optional(),idToken:Pt(x({token:w().meta({description:"ID token from the provider"}),nonce:w().meta({description:"Nonce used to generate the token"}).optional(),accessToken:w().meta({description:"Access token from the provider"}).optional(),refreshToken:w().meta({description:"Refresh token from the provider"}).optional(),expiresAt:oo().meta({description:"Expiry date of the token"}).optional()})),scopes:lt(w()).meta({description:"Array of scopes to request from the provider. This will override the default scopes passed."}).optional(),requestSignUp:Ne().meta({description:"Explicitly request sign-up. Useful when disableImplicitSignUp is true for this provider"}).optional(),loginHint:w().meta({description:"The login hint to use for the authorization code request"}).optional()}),metadata:{openapi:{description:"Sign in with a social provider",operationId:"socialSignIn",responses:{200:{description:"Success - Returns either session details or redirect URL",content:{"application/json":{schema:{type:"object",description:"Session response when idToken is provided",properties:{redirect:{type:"boolean",enum:[!1]},token:{type:"string",description:"Session token",url:{type:"null",nullable:!0},user:{type:"object",properties:{id:{type:"string"},email:{type:"string"},name:{type:"string",nullable:!0},image:{type:"string",nullable:!0},emailVerified:{type:"boolean"},createdAt:{type:"string",format:"date-time"},updatedAt:{type:"string",format:"date-time"}},required:["id","email","emailVerified","createdAt","updatedAt"]}}},required:["redirect","token","user"]}}}}}}}},async e=>{const t=e.context.socialProviders.find(s=>s.id===e.body.provider);if(!t)throw e.context.logger.error("Provider not found. Make sure to add the provider in your auth config",{provider:e.body.provider}),new b("NOT_FOUND",{message:$.PROVIDER_NOT_FOUND});if(e.body.idToken){if(!t.verifyIdToken)throw e.context.logger.error("Provider does not support id token verification",{provider:e.body.provider}),new b("NOT_FOUND",{message:$.ID_TOKEN_NOT_SUPPORTED});const{token:s,nonce:i}=e.body.idToken;if(!await t.verifyIdToken(s,i))throw e.context.logger.error("Invalid id token",{provider:e.body.provider}),new b("UNAUTHORIZED",{message:$.INVALID_TOKEN});const c=await t.getUserInfo({idToken:s,accessToken:e.body.idToken.accessToken,refreshToken:e.body.idToken.refreshToken});if(!c||!(c!=null&&c.user))throw e.context.logger.error("Failed to get user info",{provider:e.body.provider}),new b("UNAUTHORIZED",{message:$.FAILED_TO_GET_USER_INFO});if(!c.user.email)throw e.context.logger.error("User email not found",{provider:e.body.provider}),new b("UNAUTHORIZED",{message:$.USER_EMAIL_NOT_FOUND});const u=await ts(e,{userInfo:{...c.user,email:c.user.email,id:c.user.id,name:c.user.name||"",image:c.user.image,emailVerified:c.user.emailVerified||!1},account:{providerId:t.id,accountId:c.user.id,accessToken:e.body.idToken.accessToken},callbackURL:e.body.callbackURL,disableSignUp:t.disableImplicitSignUp&&!e.body.requestSignUp||t.disableSignUp});if(u.error)throw new b("UNAUTHORIZED",{message:u.error});return await Ee(e,u.data),e.json({redirect:!1,token:u.data.session.token,url:void 0,user:{id:u.data.user.id,email:u.data.user.email,name:u.data.user.name,image:u.data.user.image,emailVerified:u.data.user.emailVerified,createdAt:u.data.user.createdAt,updatedAt:u.data.user.updatedAt}})}const{codeVerifier:r,state:n}=await Yo(e),o=await t.createAuthorizationURL({state:n,codeVerifier:r,redirectURI:`${e.context.baseURL}/callback/${t.id}`,scopes:e.body.scopes,loginHint:e.body.loginHint});return e.json({url:o.toString(),redirect:!e.body.disableRedirect})});M("/sign-in/email",{method:"POST",body:x({email:w().meta({description:"Email of the user"}),password:w().meta({description:"Password of the user"}),callbackURL:w().meta({description:"Callback URL to use as a redirect for email verification"}).optional(),rememberMe:Ne().meta({description:"If this is false, the session will not be remembered. Default is `true`."}).default(!0).optional()}),metadata:{openapi:{description:"Sign in with email and password",responses:{200:{description:"Success - Returns either session details or redirect URL",content:{"application/json":{schema:{type:"object",description:"Session response when idToken is provided",properties:{redirect:{type:"boolean",enum:[!1]},token:{type:"string",description:"Session token"},url:{type:"null",nullable:!0},user:{type:"object",properties:{id:{type:"string"},email:{type:"string"},name:{type:"string",nullable:!0},image:{type:"string",nullable:!0},emailVerified:{type:"boolean"},createdAt:{type:"string",format:"date-time"},updatedAt:{type:"string",format:"date-time"}},required:["id","email","emailVerified","createdAt","updatedAt"]}},required:["redirect","token","user"]}}}}}}}},async e=>{var u,d,l,f,h,p,y,g,A;if(!((d=(u=e.context.options)==null?void 0:u.emailAndPassword)!=null&&d.enabled))throw e.context.logger.error("Email and password is not enabled. Make sure to enable it in the options on you `auth.ts` file. Check `https://better-auth.com/docs/authentication/email-password` for more!"),new b("BAD_REQUEST",{message:"Email and password is not enabled"});const{email:t,password:r}=e.body;if(!w().email().safeParse(t).success)throw new b("BAD_REQUEST",{message:$.INVALID_EMAIL});const o=await e.context.internalAdapter.findUserByEmail(t,{includeAccounts:!0});if(!o)throw await e.context.password.hash(r),e.context.logger.error("User not found",{email:t}),new b("UNAUTHORIZED",{message:$.INVALID_EMAIL_OR_PASSWORD});const s=o.accounts.find(v=>v.providerId==="credential");if(!s)throw e.context.logger.error("Credential account not found",{email:t}),new b("UNAUTHORIZED",{message:$.INVALID_EMAIL_OR_PASSWORD});const i=s==null?void 0:s.password;if(!i)throw e.context.logger.error("Password not found",{email:t}),new b("UNAUTHORIZED",{message:$.INVALID_EMAIL_OR_PASSWORD});if(!await e.context.password.verify({hash:i,password:r}))throw e.context.logger.error("Invalid password"),new b("UNAUTHORIZED",{message:$.INVALID_EMAIL_OR_PASSWORD});if((f=(l=e.context.options)==null?void 0:l.emailAndPassword)!=null&&f.requireEmailVerification&&!o.user.emailVerified){if(!((p=(h=e.context.options)==null?void 0:h.emailVerification)!=null&&p.sendVerificationEmail))throw new b("FORBIDDEN",{message:$.EMAIL_NOT_VERIFIED});if((g=(y=e.context.options)==null?void 0:y.emailVerification)!=null&&g.sendOnSignIn){const v=await et(e.context.secret,o.user.email,void 0,(A=e.context.options.emailVerification)==null?void 0:A.expiresIn),E=`${e.context.baseURL}/verify-email?token=${v}&callbackURL=${e.body.callbackURL||"/"}`;await e.context.options.emailVerification.sendVerificationEmail({user:o.user,url:E,token:v},e.request)}throw new b("FORBIDDEN",{message:$.EMAIL_NOT_VERIFIED})}const c=await e.context.internalAdapter.createSession(o.user.id,e,e.body.rememberMe===!1);if(!c)throw e.context.logger.error("Failed to create session"),new b("UNAUTHORIZED",{message:$.FAILED_TO_CREATE_SESSION});return await Ee(e,{session:c,user:o.user},e.body.rememberMe===!1),e.json({redirect:!!e.body.callbackURL,token:c.token,url:e.body.callbackURL,user:{id:o.user.id,email:o.user.email,name:o.user.name,image:o.user.image,emailVerified:o.user.emailVerified,createdAt:o.user.createdAt,updatedAt:o.user.updatedAt}})});const bt=x({code:w().optional(),error:w().optional(),device_id:w().optional(),error_description:w().optional(),state:w().optional(),user:w().optional()});M("/callback/:id",{method:["GET","POST"],body:bt.optional(),query:bt.optional(),metadata:Pr},async e=>{var k,V,j,C,T,z,B,P,O,L,N;let t;const r=((k=e.context.options.onAPIError)==null?void 0:k.errorURL)||`${e.context.baseURL}/error`;try{if(e.method==="GET")t=bt.parse(e.query);else if(e.method==="POST")t=bt.parse(e.body);else throw new Error("Unsupported method")}catch(D){throw e.context.logger.error("INVALID_CALLBACK_REQUEST",D),e.redirect(`${r}?error=invalid_callback_request`)}const{code:n,error:o,state:s,error_description:i,device_id:a}=t;if(o)throw e.redirect(`${r}?error=${o}&error_description=${i}`);if(!s)throw e.context.logger.error("State not found",o),e.redirect(`${r}?error=state_not_found`);const{codeVerifier:c,callbackURL:u,link:d,errorURL:l,newUserURL:f,requestSignUp:h}=await gl(e);function p(D){let Z=l||r;throw Z.includes("?")?Z=`${Z}&error=${D}`:Z=`${Z}?error=${D}`,e.redirect(Z)}if(!n)throw e.context.logger.error("Code not found"),p("no_code");const y=e.context.socialProviders.find(D=>D.id===e.params.id);if(!y)throw e.context.logger.error("Oauth provider with id",e.params.id,"not found"),p("oauth_provider_not_found");let g;try{g=await y.validateAuthorizationCode({code:n,codeVerifier:c,deviceId:a,redirectURI:`${e.context.baseURL}/callback/${y.id}`})}catch(D){throw e.context.logger.error("",D),p("invalid_code")}const A=await y.getUserInfo({...g,user:(V=e.body)!=null&&V.user?Jo(e.body.user):void 0}).then(D=>D==null?void 0:D.user);if(!A)return e.context.logger.error("Unable to get user info"),p("unable_to_get_user_info");if(!u)throw e.context.logger.error("No callback URL found"),p("no_callback_url");if(d){const D=(C=(j=e.context.options.account)==null?void 0:j.accountLinking)==null?void 0:C.trustedProviders;if(!(D==null?void 0:D.includes(y.id))&&!A.emailVerified||((z=(T=e.context.options.account)==null?void 0:T.accountLinking)==null?void 0:z.enabled)===!1)return e.context.logger.error("Unable to link account - untrusted provider"),p("unable_to_link_account");const I=await e.context.internalAdapter.findAccount(A.id);if(I){if(I.userId.toString()!==d.userId.toString())return p("account_already_linked_to_different_user");const K=Object.fromEntries(Object.entries({accessToken:await ie(g.accessToken,e.context),refreshToken:await ie(g.refreshToken,e.context),idToken:g.idToken,accessTokenExpiresAt:g.accessTokenExpiresAt,refreshTokenExpiresAt:g.refreshTokenExpiresAt,scope:(B=g.scopes)==null?void 0:B.join(",")}).filter(([J,ue])=>ue!==void 0));await e.context.internalAdapter.updateAccount(I.id,K)}else if(!await e.context.internalAdapter.createAccount({userId:d.userId,providerId:y.id,accountId:A.id,...g,accessToken:await ie(g.accessToken,e.context),refreshToken:await ie(g.refreshToken,e.context),scope:(P=g.scopes)==null?void 0:P.join(",")},e))return p("unable_to_link_account");let W;try{W=u.toString()}catch{W=u}throw e.redirect(W)}if(!A.email)return e.context.logger.error("Provider did not return email. This could be due to misconfiguration in the provider settings."),p("email_not_found");const v=await ts(e,{userInfo:{...A,email:A.email,name:A.name||A.email},account:{providerId:y.id,accountId:A.id,...g,scope:(O=g.scopes)==null?void 0:O.join(",")},callbackURL:u,disableSignUp:y.disableImplicitSignUp&&!h||((L=y.options)==null?void 0:L.disableSignUp),overrideUserInfo:(N=y.options)==null?void 0:N.overrideUserInfoOnSignIn});if(v.error)return e.context.logger.error(v.error.split(" ").join("_")),p(v.error.split(" ").join("_"));const{session:E,user:_}=v.data;await Ee(e,{session:E,user:_});let U;try{U=(v.isRegister&&f||u).toString()}catch{U=v.isRegister&&f||u}throw e.redirect(U)});M("/sign-out",{method:"POST",requireHeaders:!0,metadata:{openapi:{description:"Sign out the current user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{success:{type:"boolean"}}}}}}}}}},async e=>{const t=await e.getSignedCookie(e.context.authCookies.sessionToken.name,e.context.secret);if(!t)throw Xe(e),new b("BAD_REQUEST",{message:$.FAILED_TO_GET_SESSION});return await e.context.internalAdapter.deleteSession(t),Xe(e),e.json({success:!0})});function Tn(e,t,r){const n=t?new URL(t,e.baseURL):new URL(`${e.baseURL}/error`);return r&&Object.entries(r).forEach(([o,s])=>n.searchParams.set(o,s)),n.href}function Ml(e,t,r){const n=new URL(t,e.baseURL);return r&&Object.entries(r).forEach(([o,s])=>n.searchParams.set(o,s)),n.href}M("/request-password-reset",{method:"POST",body:x({email:Ar().meta({description:"The email address of the user to send a password reset email to"}),redirectTo:w().meta({description:"The URL to redirect the user to reset their password. If the token isn't valid or expired, it'll be redirected with a query parameter `?error=INVALID_TOKEN`. If the token is valid, it'll be redirected with a query parameter `?token=VALID_TOKEN"}).optional()}),metadata:{openapi:{description:"Send a password reset email to the user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean"},message:{type:"string"}}}}}}}}}},async e=>{var u;if(!((u=e.context.options.emailAndPassword)!=null&&u.sendResetPassword))throw e.context.logger.error("Reset password isn't enabled.Please pass an emailAndPassword.sendResetPassword function in your auth config!"),new b("BAD_REQUEST",{message:"Reset password isn't enabled"});const{email:t,redirectTo:r}=e.body,n=await e.context.internalAdapter.findUserByEmail(t,{includeAccounts:!0});if(!n)return e.context.logger.error("Reset Password: User not found",{email:t}),e.json({status:!0,message:"If this email exists in our system, check your email for the reset link"});const o=3600*1,s=Qe(e.context.options.emailAndPassword.resetPasswordTokenExpiresIn||o,"sec"),i=ze(24);await e.context.internalAdapter.createVerificationValue({value:n.user.id,identifier:`reset-password:${i}`,expiresAt:s},e);const a=r?encodeURIComponent(r):"",c=`${e.context.baseURL}/reset-password/${i}?callbackURL=${a}`;return await e.context.options.emailAndPassword.sendResetPassword({user:n.user,url:c,token:i},e.request),e.json({status:!0})});M("/forget-password",{method:"POST",body:x({email:w().email().meta({description:"The email address of the user to send a password reset email to"}),redirectTo:w().meta({description:"The URL to redirect the user to reset their password. If the token isn't valid or expired, it'll be redirected with a query parameter `?error=INVALID_TOKEN`. If the token is valid, it'll be redirected with a query parameter `?token=VALID_TOKEN"}).optional()}),metadata:{openapi:{description:"Send a password reset email to the user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean"},message:{type:"string"}}}}}}}}}},async e=>{var u;if(!((u=e.context.options.emailAndPassword)!=null&&u.sendResetPassword))throw e.context.logger.error("Reset password isn't enabled.Please pass an emailAndPassword.sendResetPassword function in your auth config!"),new b("BAD_REQUEST",{message:"Reset password isn't enabled"});const{email:t,redirectTo:r}=e.body,n=await e.context.internalAdapter.findUserByEmail(t,{includeAccounts:!0});if(!n)return e.context.logger.error("Reset Password: User not found",{email:t}),e.json({status:!0,message:"If this email exists in our system, check your email for the reset link"});const o=3600*1,s=Qe(e.context.options.emailAndPassword.resetPasswordTokenExpiresIn||o,"sec"),i=ze(24);await e.context.internalAdapter.createVerificationValue({value:n.user.id,identifier:`reset-password:${i}`,expiresAt:s},e);const a=r?encodeURIComponent(r):"",c=`${e.context.baseURL}/reset-password/${i}?callbackURL=${a}`;return await e.context.options.emailAndPassword.sendResetPassword({user:n.user,url:c,token:i},e.request),e.json({status:!0})});M("/reset-password/:token",{method:"GET",query:x({callbackURL:w().meta({description:"The URL to redirect the user to reset their password"})}),use:[Dr(e=>e.query.callbackURL)],metadata:{openapi:{description:"Redirects the user to the callback URL with the token",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{token:{type:"string"}}}}}}}}}},async e=>{const{token:t}=e.params,{callbackURL:r}=e.query;if(!t||!r)throw e.redirect(Tn(e.context,r,{error:"INVALID_TOKEN"}));const n=await e.context.internalAdapter.findVerificationValue(`reset-password:${t}`);throw!n||n.expiresAt<new Date?e.redirect(Tn(e.context,r,{error:"INVALID_TOKEN"})):e.redirect(Ml(e.context,r,{token:t}))});M("/reset-password",{method:"POST",query:x({token:w().optional()}).optional(),body:x({newPassword:w().meta({description:"The new password to set"}),token:w().meta({description:"The token to reset the password"}).optional()}),metadata:{openapi:{description:"Reset the password for a user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean"}}}}}}}}}},async e=>{var l,f,h,p,y;const t=e.body.token||((l=e.query)==null?void 0:l.token);if(!t)throw new b("BAD_REQUEST",{message:$.INVALID_TOKEN});const{newPassword:r}=e.body,n=(f=e.context.password)==null?void 0:f.config.minPasswordLength,o=(h=e.context.password)==null?void 0:h.config.maxPasswordLength;if(r.length<n)throw new b("BAD_REQUEST",{message:$.PASSWORD_TOO_SHORT});if(r.length>o)throw new b("BAD_REQUEST",{message:$.PASSWORD_TOO_LONG});const s=`reset-password:${t}`,i=await e.context.internalAdapter.findVerificationValue(s);if(!i||i.expiresAt<new Date)throw new b("BAD_REQUEST",{message:$.INVALID_TOKEN});const a=i.value,c=await e.context.password.hash(r);if((await e.context.internalAdapter.findAccounts(a)).find(g=>g.providerId==="credential")?await e.context.internalAdapter.updatePassword(a,c,e):await e.context.internalAdapter.createAccount({userId:a,providerId:"credential",password:c,accountId:a},e),await e.context.internalAdapter.deleteVerificationValue(i.id),(p=e.context.options.emailAndPassword)!=null&&p.onPasswordReset){const g=await e.context.internalAdapter.findUserById(a);g&&await e.context.options.emailAndPassword.onPasswordReset({user:g},e.request)}return(y=e.context.options.emailAndPassword)!=null&&y.revokeSessionsOnPasswordReset&&await e.context.internalAdapter.deleteSessions(a),e.json({status:!0})});M("/change-password",{method:"POST",body:x({newPassword:w().meta({description:"The new password to set"}),currentPassword:w().meta({description:"The current password is required"}),revokeOtherSessions:Ne().meta({description:"Must be a boolean value"}).optional()}),use:[me],metadata:{openapi:{description:"Change the password of the user",responses:{200:{description:"Password successfully changed",content:{"application/json":{schema:{type:"object",properties:{token:{type:"string",nullable:!0,description:"New session token if other sessions were revoked"},user:{type:"object",properties:{id:{type:"string",description:"The unique identifier of the user"},email:{type:"string",format:"email",description:"The email address of the user"},name:{type:"string",description:"The name of the user"},image:{type:"string",format:"uri",nullable:!0,description:"The profile image URL of the user"},emailVerified:{type:"boolean",description:"Whether the email has been verified"},createdAt:{type:"string",format:"date-time",description:"When the user was created"},updatedAt:{type:"string",format:"date-time",description:"When the user was last updated"}},required:["id","email","name","emailVerified","createdAt","updatedAt"]}},required:["user"]}}}}}}}},async e=>{const{newPassword:t,currentPassword:r,revokeOtherSessions:n}=e.body,o=e.context.session,s=e.context.password.config.minPasswordLength;if(t.length<s)throw e.context.logger.error("Password is too short"),new b("BAD_REQUEST",{message:$.PASSWORD_TOO_SHORT});const i=e.context.password.config.maxPasswordLength;if(t.length>i)throw e.context.logger.error("Password is too long"),new b("BAD_REQUEST",{message:$.PASSWORD_TOO_LONG});const c=(await e.context.internalAdapter.findAccounts(o.user.id)).find(f=>f.providerId==="credential"&&f.password);if(!c||!c.password)throw new b("BAD_REQUEST",{message:$.CREDENTIAL_ACCOUNT_NOT_FOUND});const u=await e.context.password.hash(t);if(!await e.context.password.verify({hash:c.password,password:r}))throw new b("BAD_REQUEST",{message:$.INVALID_PASSWORD});await e.context.internalAdapter.updateAccount(c.id,{password:u});let l=null;if(n){await e.context.internalAdapter.deleteSessions(o.user.id);const f=await e.context.internalAdapter.createSession(o.user.id,e);if(!f)throw new b("INTERNAL_SERVER_ERROR",{message:$.FAILED_TO_GET_SESSION});await Ee(e,{session:f,user:o.user}),l=f.token}return e.json({token:l,user:{id:o.user.id,email:o.user.email,name:o.user.name,image:o.user.image,emailVerified:o.user.emailVerified,createdAt:o.user.createdAt,updatedAt:o.user.updatedAt}})});M("/set-password",{method:"POST",body:x({newPassword:w().meta({description:"The new password to set is required"})}),metadata:{SERVER_ONLY:!0},use:[me]},async e=>{const{newPassword:t}=e.body,r=e.context.session,n=e.context.password.config.minPasswordLength;if(t.length<n)throw e.context.logger.error("Password is too short"),new b("BAD_REQUEST",{message:$.PASSWORD_TOO_SHORT});const o=e.context.password.config.maxPasswordLength;if(t.length>o)throw e.context.logger.error("Password is too long"),new b("BAD_REQUEST",{message:$.PASSWORD_TOO_LONG});const i=(await e.context.internalAdapter.findAccounts(r.user.id)).find(c=>c.providerId==="credential"&&c.password),a=await e.context.password.hash(t);if(!i)return await e.context.internalAdapter.linkAccount({userId:r.user.id,providerId:"credential",accountId:r.user.id,password:a},e),e.json({status:!0});throw new b("BAD_REQUEST",{message:"user already has a password"})});M("/delete-user",{method:"POST",use:[me],body:x({callbackURL:w().meta({description:"The callback URL to redirect to after the user is deleted"}).optional(),password:w().meta({description:"The password of the user is required to delete the user"}).optional(),token:w().meta({description:"The token to delete the user is required"}).optional()}),metadata:{openapi:{description:"Delete the user",responses:{200:{description:"User deletion processed successfully",content:{"application/json":{schema:{type:"object",properties:{success:{type:"boolean",description:"Indicates if the operation was successful"},message:{type:"string",enum:["User deleted","Verification email sent"],description:"Status message of the deletion process"}},required:["success","message"]}}}}}}}},async e=>{var o,s,i,a,c,u;if(!((s=(o=e.context.options.user)==null?void 0:o.deleteUser)!=null&&s.enabled))throw e.context.logger.error("Delete user is disabled. Enable it in the options",{session:e.context.session}),new b("NOT_FOUND");const t=e.context.session;if(e.body.password){const l=(await e.context.internalAdapter.findAccounts(t.user.id)).find(h=>h.providerId==="credential"&&h.password);if(!l||!l.password)throw new b("BAD_REQUEST",{message:$.CREDENTIAL_ACCOUNT_NOT_FOUND});if(!await e.context.password.verify({hash:l.password,password:e.body.password}))throw new b("BAD_REQUEST",{message:$.INVALID_PASSWORD})}if(e.body.token)return await Wl({...e,query:{token:e.body.token}}),e.json({success:!0,message:"User deleted"});if((i=e.context.options.user.deleteUser)!=null&&i.sendDeleteAccountVerification){const d=fr(32,"0-9","a-z");await e.context.internalAdapter.createVerificationValue({value:t.user.id,identifier:`delete-account-${d}`,expiresAt:new Date(Date.now()+(((a=e.context.options.user.deleteUser)==null?void 0:a.deleteTokenExpiresIn)||3600*24)*1e3)},e);const l=`${e.context.baseURL}/delete-user/callback?token=${d}&callbackURL=${e.body.callbackURL||"/"}`;return await e.context.options.user.deleteUser.sendDeleteAccountVerification({user:t.user,url:l,token:d},e.request),e.json({success:!0,message:"Verification email sent"})}if(!e.body.password&&e.context.sessionConfig.freshAge!==0){const d=t.session.createdAt.getTime(),l=e.context.sessionConfig.freshAge*1e3;if(Date.now()-d>l*1e3)throw new b("BAD_REQUEST",{message:$.SESSION_EXPIRED})}const r=(c=e.context.options.user.deleteUser)==null?void 0:c.beforeDelete;r&&await r(t.user,e.request),await e.context.internalAdapter.deleteUser(t.user.id),await e.context.internalAdapter.deleteSessions(t.user.id),await e.context.internalAdapter.deleteAccounts(t.user.id),Xe(e);const n=(u=e.context.options.user.deleteUser)==null?void 0:u.afterDelete;return n&&await n(t.user,e.request),e.json({success:!0,message:"User deleted"})});const Wl=M("/delete-user/callback",{method:"GET",query:x({token:w().meta({description:"The token to verify the deletion request"}),callbackURL:w().meta({description:"The URL to redirect to after deletion"}).optional()}),use:[Dr(e=>e.query.callbackURL)],metadata:{openapi:{description:"Callback to complete user deletion with verification token",responses:{200:{description:"User successfully deleted",content:{"application/json":{schema:{type:"object",properties:{success:{type:"boolean",description:"Indicates if the deletion was successful"},message:{type:"string",enum:["User deleted"],description:"Confirmation message"}},required:["success","message"]}}}}}}}},async e=>{var s,i,a,c;if(!((i=(s=e.context.options.user)==null?void 0:s.deleteUser)!=null&&i.enabled))throw e.context.logger.error("Delete user is disabled. Enable it in the options"),new b("NOT_FOUND");const t=await Ae(e);if(!t)throw new b("NOT_FOUND",{message:$.FAILED_TO_GET_USER_INFO});const r=await e.context.internalAdapter.findVerificationValue(`delete-account-${e.query.token}`);if(!r||r.expiresAt<new Date)throw new b("NOT_FOUND",{message:$.INVALID_TOKEN});if(r.value!==t.user.id)throw new b("NOT_FOUND",{message:$.INVALID_TOKEN});const n=(a=e.context.options.user.deleteUser)==null?void 0:a.beforeDelete;n&&await n(t.user,e.request),await e.context.internalAdapter.deleteUser(t.user.id),await e.context.internalAdapter.deleteSessions(t.user.id),await e.context.internalAdapter.deleteAccounts(t.user.id),await e.context.internalAdapter.deleteVerificationValue(r.id),Xe(e);const o=(c=e.context.options.user.deleteUser)==null?void 0:c.afterDelete;if(o&&await o(t.user,e.request),e.query.callbackURL)throw e.redirect(e.query.callbackURL||"/");return e.json({success:!0,message:"User deleted"})});M("/change-email",{method:"POST",body:x({newEmail:Ar().meta({description:"The new email address to set must be a valid email address"}),callbackURL:w().meta({description:"The URL to redirect to after email verification"}).optional()}),use:[me],metadata:{openapi:{responses:{200:{description:"Email change request processed successfully",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean",description:"Indicates if the request was successful"},message:{type:"string",enum:["Email updated","Verification email sent"],description:"Status message of the email change process",nullable:!0}},required:["status"]}}}}}}}},async e=>{var s,i,a,c,u;if(!((i=(s=e.context.options.user)==null?void 0:s.changeEmail)!=null&&i.enabled))throw e.context.logger.error("Change email is disabled."),new b("BAD_REQUEST",{message:"Change email is disabled"});const t=e.body.newEmail.toLowerCase();if(t===e.context.session.user.email)throw e.context.logger.error("Email is the same"),new b("BAD_REQUEST",{message:"Email is the same"});if(await e.context.internalAdapter.findUserByEmail(t))throw e.context.logger.error("Email already exists"),new b("BAD_REQUEST",{message:"Couldn't update your email"});if(e.context.session.user.emailVerified!==!0){if(await e.context.internalAdapter.findUserByEmail(t))throw new b("UNPROCESSABLE_ENTITY",{message:$.USER_ALREADY_EXISTS});if(await e.context.internalAdapter.updateUserByEmail(e.context.session.user.email,{email:t},e),await Ee(e,{session:e.context.session.session,user:{...e.context.session.user,email:t}}),(a=e.context.options.emailVerification)!=null&&a.sendVerificationEmail){const l=await et(e.context.secret,t,void 0,(c=e.context.options.emailVerification)==null?void 0:c.expiresIn),f=`${e.context.baseURL}/verify-email?token=${l}&callbackURL=${e.body.callbackURL||"/"}`;await e.context.options.emailVerification.sendVerificationEmail({user:{...e.context.session.user,email:t},url:f,token:l},e.request)}return e.json({status:!0})}if(!e.context.options.user.changeEmail.sendChangeEmailVerification)throw e.context.logger.error("Verification email isn't enabled."),new b("BAD_REQUEST",{message:"Verification email isn't enabled"});const n=await et(e.context.secret,e.context.session.user.email,t,(u=e.context.options.emailVerification)==null?void 0:u.expiresIn),o=`${e.context.baseURL}/verify-email?token=${n}&callbackURL=${e.body.callbackURL||"/"}`;return await e.context.options.user.changeEmail.sendChangeEmailVerification({user:e.context.session.user,newEmail:t,url:o,token:n},e.request),e.json({status:!0})});function Hl(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}const Kl=(e="Unknown")=>`<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Authentication Error</title>
    <style>
        :root {
            --bg-color: #f8f9fa;
            --text-color: #212529;
            --accent-color: #000000;
            --error-color: #dc3545;
            --border-color: #e9ecef;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            line-height: 1.5;
        }
        .error-container {
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            padding: 2.5rem;
            text-align: center;
            max-width: 90%;
            width: 400px;
        }
        h1 {
            color: var(--error-color);
            font-size: 1.75rem;
            margin-bottom: 1rem;
            font-weight: 600;
        }
        p {
            margin-bottom: 1.5rem;
            color: #495057;
        }
        .btn {
            background-color: var(--accent-color);
            color: #ffffff;
            text-decoration: none;
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            transition: all 0.3s ease;
            display: inline-block;
            font-weight: 500;
            border: 2px solid var(--accent-color);
        }
        .btn:hover {
            background-color: #131721;
        }
        .error-code {
            font-size: 0.875rem;
            color: #6c757d;
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--border-color);
        }
        .icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }
    </style>
</head>
<body>
    <div class="error-container">
        <div class="icon">⚠️</div>
        <h1>Better Auth Error</h1>
        <p>We encountered an issue while processing your request. Please try again or contact the application owner if the problem persists.</p>
        <a href="/" id="returnLink" class="btn">Return to Application</a>
        <div class="error-code">Error Code: <span id="errorCode">${Hl(e)}</span></div>
    </div>
</body>
</html>`;M("/error",{method:"GET",metadata:{...Pr,openapi:{description:"Displays an error page",responses:{200:{description:"Success",content:{"text/html":{schema:{type:"string",description:"The HTML content of the error page"}}}}}}}},async e=>{var r;const t=new URL(((r=e.request)==null?void 0:r.url)||"").searchParams.get("error")||"Unknown";return new Response(Kl(t),{headers:{"Content-Type":"text/html"}})});M("/ok",{method:"GET",metadata:{...Pr,openapi:{description:"Check if the API is working",responses:{200:{description:"API is working",content:{"application/json":{schema:{type:"object",properties:{ok:{type:"boolean",description:"Indicates if the API is working"}},required:["ok"]}}}}}}}},async e=>e.json({ok:!0}));M("/list-accounts",{method:"GET",use:[me],metadata:{openapi:{description:"List all accounts linked to the user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"array",items:{type:"object",properties:{id:{type:"string"},provider:{type:"string"},createdAt:{type:"string",format:"date-time"},updatedAt:{type:"string",format:"date-time"}},accountId:{type:"string"},scopes:{type:"array",items:{type:"string"}}},required:["id","provider","createdAt","updatedAt","accountId","scopes"]}}}}}}}},async e=>{const t=e.context.session,r=await e.context.internalAdapter.findAccounts(t.user.id);return e.json(r.map(n=>{var o;return{id:n.id,provider:n.providerId,createdAt:n.createdAt,updatedAt:n.updatedAt,accountId:n.accountId,scopes:((o=n.scope)==null?void 0:o.split(","))||[]}}))});M("/link-social",{method:"POST",requireHeaders:!0,body:x({callbackURL:w().meta({description:"The URL to redirect to after the user has signed in"}).optional(),provider:rs,idToken:x({token:w(),nonce:w().optional(),accessToken:w().optional(),refreshToken:w().optional(),scopes:lt(w()).optional()}).optional(),requestSignUp:Ne().optional(),scopes:lt(w()).meta({description:"Additional scopes to request from the provider"}).optional(),errorCallbackURL:w().meta({description:"The URL to redirect to if there is an error during the link process"}).optional()}),use:[me],metadata:{openapi:{description:"Link a social account to the user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{url:{type:"string",description:"The authorization URL to redirect the user to"},redirect:{type:"boolean",description:"Indicates if the user should be redirected to the authorization URL"},status:{type:"boolean"}},required:["redirect"]}}}}}}}},async e=>{var s,i,a,c,u,d,l,f,h,p,y;const t=e.context.session,r=e.context.socialProviders.find(g=>g.id===e.body.provider);if(!r)throw e.context.logger.error("Provider not found. Make sure to add the provider in your auth config",{provider:e.body.provider}),new b("NOT_FOUND",{message:$.PROVIDER_NOT_FOUND});if(e.body.idToken){if(!r.verifyIdToken)throw e.context.logger.error("Provider does not support id token verification",{provider:e.body.provider}),new b("NOT_FOUND",{message:$.ID_TOKEN_NOT_SUPPORTED});const{token:g,nonce:A}=e.body.idToken;if(!await r.verifyIdToken(g,A))throw e.context.logger.error("Invalid id token",{provider:e.body.provider}),new b("UNAUTHORIZED",{message:$.INVALID_TOKEN});const E=await r.getUserInfo({idToken:g,accessToken:e.body.idToken.accessToken,refreshToken:e.body.idToken.refreshToken});if(!E||!(E!=null&&E.user))throw e.context.logger.error("Failed to get user info",{provider:e.body.provider}),new b("UNAUTHORIZED",{message:$.FAILED_TO_GET_USER_INFO});if(!E.user.email)throw e.context.logger.error("User email not found",{provider:e.body.provider}),new b("UNAUTHORIZED",{message:$.USER_EMAIL_NOT_FOUND});if((await e.context.internalAdapter.findAccounts(t.user.id)).find(j=>j.providerId===r.id&&j.accountId===E.user.id))return e.json({redirect:!1,url:"",status:!0});const k=(i=(s=e.context.options.account)==null?void 0:s.accountLinking)==null?void 0:i.trustedProviders;if(!(k==null?void 0:k.includes(r.id))&&!E.user.emailVerified||((c=(a=e.context.options.account)==null?void 0:a.accountLinking)==null?void 0:c.enabled)===!1)throw new b("UNAUTHORIZED",{message:"Account not linked - linking not allowed"});if(E.user.email!==t.user.email&&((d=(u=e.context.options.account)==null?void 0:u.accountLinking)==null?void 0:d.allowDifferentEmails)!==!0)throw new b("UNAUTHORIZED",{message:"Account not linked - different emails not allowed"});try{await e.context.internalAdapter.createAccount({userId:t.user.id,providerId:r.id,accountId:E.user.id.toString(),accessToken:e.body.idToken.accessToken,idToken:g,refreshToken:e.body.idToken.refreshToken,scope:(l=e.body.idToken.scopes)==null?void 0:l.join(",")},e)}catch{throw new b("EXPECTATION_FAILED",{message:"Account not linked - unable to create account"})}if(((h=(f=e.context.options.account)==null?void 0:f.accountLinking)==null?void 0:h.updateUserInfoOnLink)===!0)try{await e.context.internalAdapter.updateUser(t.user.id,{name:(p=E.user)==null?void 0:p.name,image:(y=E.user)==null?void 0:y.image})}catch(j){console.warn("Could not update user - "+j.toString())}return e.json({redirect:!1,url:"",status:!0})}const n=await Yo(e,{userId:t.user.id,email:t.user.email}),o=await r.createAuthorizationURL({state:n.state,codeVerifier:n.codeVerifier,redirectURI:`${e.context.baseURL}/callback/${r.id}`,scopes:e.body.scopes});return e.json({url:o.toString(),redirect:!0})});M("/unlink-account",{method:"POST",body:x({providerId:w(),accountId:w().optional()}),use:[ml],metadata:{openapi:{description:"Unlink an account",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean"}}}}}}}}}},async e=>{var s,i;const{providerId:t,accountId:r}=e.body,n=await e.context.internalAdapter.findAccounts(e.context.session.user.id);if(n.length===1&&!((i=(s=e.context.options.account)==null?void 0:s.accountLinking)!=null&&i.allowUnlinkingAll))throw new b("BAD_REQUEST",{message:$.FAILED_TO_UNLINK_LAST_ACCOUNT});const o=n.find(a=>r?a.accountId===r&&a.providerId===t:a.providerId===t);if(!o)throw new b("BAD_REQUEST",{message:$.ACCOUNT_NOT_FOUND});return await e.context.internalAdapter.deleteAccount(o.id),e.json({status:!0})});const Jl=M("/get-access-token",{method:"POST",body:x({providerId:w().meta({description:"The provider ID for the OAuth provider"}),accountId:w().meta({description:"The account ID associated with the refresh token"}).optional(),userId:w().meta({description:"The user ID associated with the account"}).optional()}),metadata:{openapi:{description:"Get a valid access token, doing a refresh if needed",responses:{200:{description:"A Valid access token",content:{"application/json":{schema:{type:"object",properties:{tokenType:{type:"string"},idToken:{type:"string"},accessToken:{type:"string"},refreshToken:{type:"string"},accessTokenExpiresAt:{type:"string",format:"date-time"},refreshTokenExpiresAt:{type:"string",format:"date-time"}}}}}},400:{description:"Invalid refresh token or provider configuration"}}}}},async e=>{var d,l;const{providerId:t,accountId:r,userId:n}=e.body,o=e.request,s=await Ae(e);if(o&&!s)throw e.error("UNAUTHORIZED");let i=((d=s==null?void 0:s.user)==null?void 0:d.id)||n;if(!i)throw new b("BAD_REQUEST",{message:"Either userId or session is required"});if(!e.context.socialProviders.find(f=>f.id===t))throw new b("BAD_REQUEST",{message:`Provider ${t} is not supported.`});const c=(await e.context.internalAdapter.findAccounts(i)).find(f=>r?f.id===r&&f.providerId===t:f.providerId===t);if(!c)throw new b("BAD_REQUEST",{message:"Account not found"});const u=e.context.socialProviders.find(f=>f.id===t);if(!u)throw new b("BAD_REQUEST",{message:`Provider ${t} not found.`});try{let f=null;const h=c.accessTokenExpiresAt&&new Date(c.accessTokenExpiresAt).getTime()-Date.now()<5e3;c.refreshToken&&h&&u.refreshAccessToken&&(f=await u.refreshAccessToken(c.refreshToken),await e.context.internalAdapter.updateAccount(c.id,{accessToken:await ie(f.accessToken,e.context),accessTokenExpiresAt:f.accessTokenExpiresAt,refreshToken:await ie(f.refreshToken,e.context),refreshTokenExpiresAt:f.refreshTokenExpiresAt}));const p={accessToken:await wl((f==null?void 0:f.accessToken)??c.accessToken??"",e.context),accessTokenExpiresAt:(f==null?void 0:f.accessTokenExpiresAt)??c.accessTokenExpiresAt??void 0,scopes:((l=c.scope)==null?void 0:l.split(","))??[],idToken:(f==null?void 0:f.idToken)??c.idToken??void 0};return e.json(p)}catch(f){throw new b("BAD_REQUEST",{message:"Failed to get a valid access token",cause:f})}});M("/refresh-token",{method:"POST",body:x({providerId:w().meta({description:"The provider ID for the OAuth provider"}),accountId:w().meta({description:"The account ID associated with the refresh token"}).optional(),userId:w().meta({description:"The user ID associated with the account"}).optional()}),metadata:{openapi:{description:"Refresh the access token using a refresh token",responses:{200:{description:"Access token refreshed successfully",content:{"application/json":{schema:{type:"object",properties:{tokenType:{type:"string"},idToken:{type:"string"},accessToken:{type:"string"},refreshToken:{type:"string"},accessTokenExpiresAt:{type:"string",format:"date-time"},refreshTokenExpiresAt:{type:"string",format:"date-time"}}}}}},400:{description:"Invalid refresh token or provider configuration"}}}}},async e=>{var d;const{providerId:t,accountId:r,userId:n}=e.body,o=e.request,s=await Ae(e);if(o&&!s)throw e.error("UNAUTHORIZED");let i=((d=s==null?void 0:s.user)==null?void 0:d.id)||n;if(!i)throw new b("BAD_REQUEST",{message:"Either userId or session is required"});const c=(await e.context.internalAdapter.findAccounts(i)).find(l=>r?l.id===r&&l.providerId===t:l.providerId===t);if(!c)throw new b("BAD_REQUEST",{message:"Account not found"});const u=e.context.socialProviders.find(l=>l.id===t);if(!u)throw new b("BAD_REQUEST",{message:`Provider ${t} not found.`});if(!u.refreshAccessToken)throw new b("BAD_REQUEST",{message:`Provider ${t} does not support token refreshing.`});try{const l=await u.refreshAccessToken(c.refreshToken);return await e.context.internalAdapter.updateAccount(c.id,{accessToken:await ie(l.accessToken,e.context),refreshToken:await ie(l.refreshToken,e.context),accessTokenExpiresAt:l.accessTokenExpiresAt,refreshTokenExpiresAt:l.refreshTokenExpiresAt}),e.json(l)}catch(l){throw new b("BAD_REQUEST",{message:"Failed to refresh access token",cause:l})}});M("/account-info",{method:"POST",use:[me],metadata:{openapi:{description:"Get the account info provided by the provider",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{user:{type:"object",properties:{id:{type:"string"},name:{type:"string"},email:{type:"string"},image:{type:"string"},emailVerified:{type:"boolean"}},required:["id","emailVerified"]},data:{type:"object",properties:{},additionalProperties:!0}},required:["user","data"],additionalProperties:!1}}}}}}},body:x({accountId:w().meta({description:"The provider given account id for which to get the account info"})})},async e=>{const t=await e.context.internalAdapter.findAccount(e.body.accountId);if(!t||t.userId!==e.context.session.user.id)throw new b("BAD_REQUEST",{message:"Account not found"});const r=e.context.socialProviders.find(s=>s.id===t.providerId);if(!r)throw new b("INTERNAL_SERVER_ERROR",{message:`Provider account provider is ${t.providerId} but it is not configured`});const n=await Jl({...e,body:{accountId:t.id,providerId:t.providerId},returnHeaders:!1});if(!n.accessToken)throw new b("BAD_REQUEST",{message:"Access token not found"});const o=await r.getUserInfo({...n,accessToken:n.accessToken});return e.json(o)});const Fl={proto:/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,constructor:/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,protoShort:/"__proto__"\s*:/,constructorShort:/"constructor"\s*:/},Gl=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/,Sn={true:!0,false:!1,null:null,undefined:void 0,nan:Number.NaN,infinity:Number.POSITIVE_INFINITY,"-infinity":Number.NEGATIVE_INFINITY},Ql=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})(?:\.(\d{1,7}))?(?:Z|([+-])(\d{2}):(\d{2}))$/;function Yl(e){return e instanceof Date&&!isNaN(e.getTime())}function Xl(e){const t=Ql.exec(e);if(!t)return null;const[,r,n,o,s,i,a,c,u,d,l]=t;let f=new Date(Date.UTC(parseInt(r,10),parseInt(n,10)-1,parseInt(o,10),parseInt(s,10),parseInt(i,10),parseInt(a,10),c?parseInt(c.padEnd(3,"0"),10):0));if(u){const h=(parseInt(d,10)*60+parseInt(l,10))*(u==="+"?-1:1);f.setUTCMinutes(f.getUTCMinutes()+h)}return Yl(f)?f:null}function ef(e,t={}){const{strict:r=!1,warnings:n=!1,reviver:o,parseDates:s=!0}=t;if(typeof e!="string")return e;const i=e.trim();if(i[0]==='"'&&i.endsWith('"')&&!i.slice(1,-1).includes('"'))return i.slice(1,-1);const a=i.toLowerCase();if(a.length<=9&&a in Sn)return Sn[a];if(!Gl.test(i)){if(r)throw new SyntaxError("[better-json] Invalid JSON");return e}if(Object.entries(Fl).some(([u,d])=>{const l=d.test(i);return l&&n&&console.warn(`[better-json] Detected potential prototype pollution attempt using ${u} pattern`),l})&&r)throw new Error("[better-json] Potential prototype pollution attempt detected");try{return JSON.parse(i,(d,l)=>{if(d==="__proto__"||d==="constructor"&&l&&typeof l=="object"&&"prototype"in l){n&&console.warn(`[better-json] Dropping "${d}" key to prevent prototype pollution`);return}if(s&&typeof l=="string"){const f=Xl(l);if(f)return f}return o?o(d,l):l})}catch(u){if(r)throw u;return e}}function tf(e,t={strict:!0}){return ef(e,t)}Ze(async()=>({}));Ze({use:[me]},async e=>({session:e.context.session}));const ns=w(),rf=ft(["pending","accepted","rejected","canceled"]).default("pending");x({id:w().default(ze),name:w(),slug:w(),logo:w().nullish().optional(),metadata:Gc(w(),or()).or(w().transform(e=>JSON.parse(e))).optional(),createdAt:re()});x({id:w().default(ze),organizationId:w(),userId:qt(),role:ns,createdAt:re().default(()=>new Date)});x({id:w().default(ze),organizationId:w(),email:w(),role:ns,status:rf,teamId:w().optional(),inviterId:w(),expiresAt:re()});x({id:w().default(ze),name:w().min(1),organizationId:w(),createdAt:re(),updatedAt:re().optional()});x({id:w().default(ze),teamId:w(),userId:w(),createdAt:re().default(()=>new Date)});const In=["admin","member","owner"];io([ft(In),lt(ft(In))]);x({id:w(),publicKey:w(),privateKey:w(),createdAt:re()});var nf=()=>({id:"polar-client",$InferServerPlugin:{}});let de=[],ke=0;const vt=4;let os=e=>{let t=[],r={get(){return r.lc||r.listen(()=>{})(),r.value},lc:0,listen(n){return r.lc=t.push(n),()=>{for(let s=ke+vt;s<de.length;)de[s]===n?de.splice(s,vt):s+=vt;let o=t.indexOf(n);~o&&(t.splice(o,1),--r.lc||r.off())}},notify(n,o){let s=!de.length;for(let i of t)de.push(i,r.value,n,o);if(s){for(ke=0;ke<de.length;ke+=vt)de[ke](de[ke+1],de[ke+2],de[ke+3]);de.length=0}},off(){},set(n){let o=r.value;o!==n&&(r.value=n,r.notify(o))},subscribe(n){let o=r.listen(n);return n(r.value),o},value:e};return r};const of=5,Et=6,At=10;let sf=(e,t,r,n)=>(e.events=e.events||{},e.events[r+At]||(e.events[r+At]=n(o=>{e.events[r].reduceRight((s,i)=>(i(s),s),{shared:{},...o})})),e.events[r]=e.events[r]||[],e.events[r].push(t),()=>{let o=e.events[r],s=o.indexOf(t);o.splice(s,1),o.length||(delete e.events[r],e.events[r+At](),delete e.events[r+At])}),af=1e3,cf=(e,t)=>sf(e,n=>{let o=t(n);o&&e.events[Et].push(o)},of,n=>{let o=e.listen;e.listen=(...i)=>(!e.lc&&!e.active&&(e.active=!0,n()),o(...i));let s=e.off;return e.events[Et]=[],e.off=()=>{s(),setTimeout(()=>{if(e.active&&!e.lc){e.active=!1;for(let i of e.events[Et])i();e.events[Et]=[]}},af)},()=>{e.listen=o,e.off=s}});function uf(e,t,r){let n=new Set(t).add(void 0);return e.listen((o,s,i)=>{n.has(i)&&r(o,s,i)})}const df=typeof window>"u",lf=(e,t,r,n)=>{const o=os({data:null,error:null,isPending:!0,isRefetching:!1,refetch:()=>s()}),s=()=>{const a=typeof n=="function"?n({data:o.get().data,error:o.get().error,isPending:o.get().isPending}):n;return r(t,{...a,async onSuccess(c){var u;o.set({data:c.data,error:null,isPending:!1,isRefetching:!1,refetch:o.value.refetch}),await((u=a==null?void 0:a.onSuccess)==null?void 0:u.call(a,c))},async onError(c){var f,h;const{request:u}=c,d=typeof u.retry=="number"?u.retry:(f=u.retry)==null?void 0:f.attempts,l=u.retryAttempt||0;d&&l<d||(o.set({error:c.error,data:null,isPending:!1,isRefetching:!1,refetch:o.value.refetch}),await((h=a==null?void 0:a.onError)==null?void 0:h.call(a,c)))},async onRequest(c){var d;const u=o.get();o.set({isPending:u.data===null,data:u.data,error:null,isRefetching:!0,refetch:o.value.refetch}),await((d=a==null?void 0:a.onRequest)==null?void 0:d.call(a,c))}})};e=Array.isArray(e)?e:[e];let i=!1;for(const a of e)a.subscribe(()=>{df||(i?s():cf(o,()=>(setTimeout(()=>{s()},0),i=!0,()=>{o.off(),a.off()})))});return o},ff={id:"redirect",name:"Redirect",hooks:{onSuccess(e){var t,r;if((t=e.data)!=null&&t.url&&((r=e.data)!=null&&r.redirect)&&typeof window<"u"&&window.location&&window.location)try{window.location.href=e.data.url}catch{}}}};function hf(e){const t=os(!1);return{session:lf(t,"/get-session",e,{method:"GET"}),$sessionSignal:t}}const pf=e=>{var E,_,U,k,V,j,C;const t="credentials"in Request.prototype,r=sl(e==null?void 0:e.baseURL,e==null?void 0:e.basePath),n=((E=e==null?void 0:e.plugins)==null?void 0:E.flatMap(T=>T.fetchPlugins).filter(T=>T!==void 0))||[],o={id:"lifecycle-hooks",name:"lifecycle-hooks",hooks:{onSuccess:(_=e==null?void 0:e.fetchOptions)==null?void 0:_.onSuccess,onError:(U=e==null?void 0:e.fetchOptions)==null?void 0:U.onError,onRequest:(k=e==null?void 0:e.fetchOptions)==null?void 0:k.onRequest,onResponse:(V=e==null?void 0:e.fetchOptions)==null?void 0:V.onResponse}},{onSuccess:s,onError:i,onRequest:a,onResponse:c,...u}=(e==null?void 0:e.fetchOptions)||{},d=Yd({baseURL:r,...t?{credentials:"include"}:{},method:"GET",jsonParser(T){return T?tf(T,{strict:!1}):null},customFetchImpl:async(T,z)=>{try{return await fetch(T,z)}catch{return Response.error()}},...u,plugins:[o,...u.plugins||[],...e!=null&&e.disableDefaultFetchPlugins?[]:[ff],...n]}),{$sessionSignal:l,session:f}=hf(d),h=(e==null?void 0:e.plugins)||[];let p={},y={$sessionSignal:l,session:f},g={"/sign-out":"POST","/revoke-sessions":"POST","/revoke-other-sessions":"POST","/delete-user":"POST"};const A=[{signal:"$sessionSignal",matcher(T){return T==="/sign-out"||T==="/update-user"||T.startsWith("/sign-in")||T.startsWith("/sign-up")||T==="/delete-user"||T==="/verify-email"}}];for(const T of h)T.getAtoms&&Object.assign(y,(j=T.getAtoms)==null?void 0:j.call(T,d)),T.pathMethods&&Object.assign(g,T.pathMethods),T.atomListeners&&A.push(...T.atomListeners);const v={notify:T=>{y[T].set(!y[T].get())},listen:(T,z)=>{y[T].subscribe(z)},atoms:y};for(const T of h)T.getActions&&Object.assign(p,(C=T.getActions)==null?void 0:C.call(T,d,v,e));return{pluginsActions:p,pluginsAtoms:y,pluginPathMethods:g,atomListeners:A,$fetch:d,$store:v}};function mf(e,t,r){const n=t[e],{fetchOptions:o,query:s,...i}=r||{};return n||(o!=null&&o.method?o.method:i&&Object.keys(i).length>0?"POST":"GET")}function gf(e,t,r,n,o){function s(i=[]){return new Proxy(function(){},{get(a,c){const u=[...i,c];let d=e;for(const l of u)if(d&&typeof d=="object"&&l in d)d=d[l];else{d=void 0;break}return typeof d=="function"?d:s(u)},apply:async(a,c,u)=>{const d="/"+i.map(v=>v.replace(/[A-Z]/g,E=>`-${E.toLowerCase()}`)).join("/"),l=u[0]||{},f=u[1]||{},{query:h,fetchOptions:p,...y}=l,g={...f,...p},A=mf(d,r,l);return await t(d,{...g,body:A==="GET"?void 0:{...y,...(g==null?void 0:g.body)||{}},query:h||(g==null?void 0:g.query),method:A,async onSuccess(v){var k;await((k=g==null?void 0:g.onSuccess)==null?void 0:k.call(g,v));const E=o==null?void 0:o.find(V=>V.matcher(d));if(!E)return;const _=n[E.signal];if(!_)return;const U=_.get();setTimeout(()=>{_.set(!U)},10)}})}})}return s()}function wf(e,t={}){let r=Wt.useRef(e.get());const{keys:n,deps:o=[e,n]}=t;let s=Wt.useCallback(a=>{const c=u=>{r.current!==u&&(r.current=u,a())};return c(e.value),n!=null&&n.length?uf(e,n,c):e.listen(c)},o),i=()=>r.current;return Wt.useSyncExternalStore(s,i,i)}function yf(e){return`use${_f(e)}`}function _f(e){return e.charAt(0).toUpperCase()+e.slice(1)}function bf(e){const{pluginPathMethods:t,pluginsActions:r,pluginsAtoms:n,$fetch:o,$store:s,atomListeners:i}=pf(e);let a={};for(const[d,l]of Object.entries(n))a[yf(d)]=()=>wf(l);const c={...r,...a,$fetch:o,$store:s};return gf(c,o,t,n,i)}const Rf=bf({plugins:[nf()]});export{Tf as A,kf as C,Sf as a,If as b,Rf as c};
